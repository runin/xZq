var LotteryEgg=(function(h){var b=0,e=0,m=h("body"),n="requesting",k=null,f={countUrl:domain_url+"comedian/querylc",countCallback:"callbackComedianQuerylc",lotteryUrl:domain_url+"comedian/lottery",lotteryCallback:"callbackComedianLottery",awardUrl:domain_url+"comedian/award/",awardCallback:"callbackComedianAward"};var c=function(){m.delegate(".btn-close","click",function(o){o.preventDefault();h(this).closest(".modal").addClass("none")}).delegate(".btn-lottery","click",function(o){o.preventDefault();g.open()}).delegate(".btn-comeon","click",function(o){o.preventDefault();g.open()})};var i=function(){if(this.$dialog){this.$dialog.removeClass("none")}else{this.$dialog=h(this.tpl());m.append(this.$dialog)}d()};var l=function(){h(".modal").addClass("none")};var d=function(){var o=h(window).height(),p=h(window).width(),q=h(window).scrollTop()+o*0.06;h(".modal").each(function(){h(this).css({width:p,height:o}).find(".btn-close").css({right:p*0.06-15,top:q-15})});h(".dialog").each(function(){if(h(this).hasClass("relocated")){return}h(this).css({width:p*0.88,height:o*0.88,left:p*0.06,right:p*0.06,top:q,bottom:o*0.06});var r=h(this).find(".box");if(r.length>0){r.css("height",o*0.38)}})};var g={$dialog:null,BROKEN_CLS:"broken",ANIMATED_CLS:"animated",LOTTERIED_CLS:"lotteried",init:function(o){f=h.extend({},f,o);return this},open:function(){var o=this,p=this.$dialog;l();i.call(this);if(!p){this.event()}this.reset();this.$dialog.removeClass("none");var q=this.$dialog.find(".btn-hammer").addClass(this.ANIMATED_CLS);setTimeout(function(){q.removeClass(o.ANIMATED_CLS)},800);showLoading(o.$dialog);h.ajax({type:"GET",async:false,url:f.countUrl,data:{tsuid:stationUuid,yp:openid},dataType:"jsonp",jsonp:"callback",jsonpCallback:f.countCallback,complete:function(){hideLoading(o.$dialog)},success:function(r){b=r.lc;g.update(r.lc)}})},shake:function(){W.addEventListener("shake",g.shake_listener,false)},unshake:function(){W.removeEventListener("shake",g.shake_listener,false)},shake_listener:function(){var o=g.$dialog;if(o.hasClass("none")){return}o.find(".btn-hammer").trigger("click")},event:function(){var o=this;this.$dialog.find(".btn-hammer").click(function(q){var p=h(this);q.preventDefault();if(o.$dialog.hasClass(o.LOTTERIED_CLS)){return false}o.$dialog.addClass(o.LOTTERIED_CLS);p.addClass(o.ANIMATED_CLS);setTimeout(function(){o.$dialog.addClass(o.BROKEN_CLS)},400);setTimeout(function(){p.removeClass(o.ANIMATED_CLS)},800);window.callbackComedianLottery=function(r){};showLoading(o.$dialog);h.ajax({type:"GET",async:false,url:f.lotteryUrl,data:{tsuid:stationUuid,tcuid:channelUuid,serviceNo:serviceNo,yp:openid},dataType:"jsonp",jsonp:"callback",jsonpCallback:f.lotteryCallback,complete:function(){hideLoading(o.$dialog)},success:function(r){if(r.code==0){o.update(r.lc);o.animate(r)}else{setTimeout(function(){alert(r.message);o.reset()},400)}}})});this.shake()},animate:function(p){var o=this;setTimeout(function(){o.$dialog.addClass(o.ANIMATED_CLS)},400);setTimeout(function(){j.open(p)},1100)},update:function(o){b=o;h(".s-lc").text(o)},reset:function(){this.$dialog.removeClass(this.BROKEN_CLS).removeClass(this.ANIMATED_CLS).removeClass(this.LOTTERIED_CLS)},tpl:function(){var o=simpleTpl();o._('<section class="modal" id="lottery-dialog">')._('<a href="#" class="btn-close" data-collect="true" data-collect-flag="ah-lotterydialog-closebtn" data-collect-desc="抽奖弹层-关闭按钮"></a>')._('<div class="dialog lottery-dialog">')._('<div class="hammer">')._("<p>举起你的双手，让我们一起摇摆吧！</p>")._('<a href="#" class="btn-hammer" data-collect="true" data-collect-flag="ah-lotterydialog-hammerbtn" data-collect-desc="抽奖弹层-锤子砸奖"></a>')._("</div>")._('<div class="ctrl">')._('<div class="list"><ul></ul></div>')._('<a href="#" class="btn btn-result none" data-collect="true" data-collect-flag="ah-lotterydialog-resultbtn" data-collect-desc="抽奖弹层-查看战绩">查看战绩</a>')._('<p>你还有<strong class="s-lc"></strong>次抽奖机会</p>')._("</div>")._('<div class="light"></div>')._('<p class="dialog-copyright none">本活动最终解释权归安徽卫视 《超级笑星》 栏目所有</p>')._("</div>")._("</section>");return o.toString()}};var j={pt:0,$dialog:null,SUCCESS_CLS:"award-succ-dialog",REQUEST_CLS:"requesting",open:function(p){var o=this.$dialog;l();i.call(this);if(!o){this.event()}this.scroll_enable();this.pt=p.pt;e=p.puid;this.$dialog.find(".s-award").text(" "+p.pn+" "+(p.pt==2?"":(p.co+p.pu)));this.$dialog.find(".prize").html('<img src="'+p.pi+'" />').addClass("p"+p.pt);this.$dialog.find(".mobile").val(p.ph||"");this.$dialog.find(".name").val(p.rn||"");var q=this.$dialog.find(".address").val(p.ad||"");if(p.pt==2){q.addClass("none")}else{q.removeClass("none")}this.$dialog.removeClass(this.SUCCESS_CLS)},scroll_enable:function(){if(this.iscroll){this.iscroll.scrollTo(0,0);this.iscroll.enable()}},scroll_disable:function(){if(this.iscroll){this.iscroll.scrollTo(0,0);this.iscroll.disable()}},enable:function(){this.$dialog.find(".btn-award").removeClass(this.REQUEST_CLS)},disable:function(){this.$dialog.find(".btn-award").addClass(this.REQUEST_CLS)},succ:function(){this.scroll_disable();g.update(b);this.$dialog.addClass(this.SUCCESS_CLS);if(b<=0){this.$dialog.find(".btn-again").addClass("none")}else{this.$dialog.find(".btn-again").removeClass("none")}},check:function(){var s=this,r=s.$dialog.find(".mobile"),q=h.trim(r.val()),u=s.$dialog.find(".name"),p=h.trim(u.val()),t=s.$dialog.find(".address"),o=h.trim(t.val());if(!p){a.open(u);return false}else{if(!q){a.open(r);return false}else{if(s.pt==1&&!o){a.open(t);return false}}}if(p.length>20){alert("姓名太太太长了！");u.focus();return false}if(!/^\d{11}$/.test(q)){alert("这手机号，可打不通...");r.focus();return false}if(s.pt==1&&(o.length<5||o.length>60)){alert("地址长度为5~60个字符");t.focus();return false}return true},event:function(){var o=this;this.$dialog.find(".btn-award").click(function(s){s.preventDefault();if(!o.check()){return false}var r=h.trim(o.$dialog.find(".mobile").val()),q=h.trim(o.$dialog.find(".name").val()),p=h.trim(o.$dialog.find(".address").val());o.disable();window.callbackComedianAward=function(t){};showLoading(o.$dialog);h.ajax({type:"GET",async:false,url:f.awardUrl,data:{puid:e,ph:r,rn:encodeURIComponent(q),ad:o.pt==1?encodeURIComponent(p):"",yp:openid},dataType:"jsonp",jsonp:"callback",jsonpCallback:f.awardCallback,complete:function(){hideLoading(o.$dialog)},success:function(t){o.enable();if(t.code==0){o.succ();return}alert(t.message)}})});this.$dialog.find(".btn-again").click(function(p){p.preventDefault();o.$dialog.removeClass(o.SUCCESS_CLS);g.open()});this.$dialog.find(".btn-close").click(function(p){p.preventDefault();if(!o.check()){return false}});if(is_android()){this.iscroll=new IScroll(this.$dialog.find(".dialog")[0],{mouseWheel:true,preventDefaultException:{tagName:/^(A|INPUT|TEXTAREA|BUTTON|SELECT)$/},});this.$dialog.find(".dialog-inner").css("padding-bottom","70%");this.$dialog.find("input").focus(function(){if(o.iscroll){o.iscroll.refresh();o.iscroll.scrollToElement(h(this)[0])}})}},tpl:function(){var o=simpleTpl();o._('<section class="modal iscroll" id="award-dialog">')._('<a href="#" class="btn-close" data-collect="true" data-collect-flag="ah-awarddialog-closebtn" data-collect-desc="领奖弹层-关闭按钮"></a>')._('<div class="dialog award-dialog">')._('<div class="dialog-inner">')._('<div class="box">')._('<div class="prize"></div>')._("</div>")._('<div class="ctrl">')._('<h2>运气太好了，您获得<strong class="s-award"></strong></h2>')._('<div class="content">')._("<p>请填写您的姓名及联系方式，以便顺利领奖</p>")._('<input type="text" class="name" placeholder="姓名" />')._('<input type="number" class="mobile" placeholder="手机号码" />')._('<input type="text" class="address" placeholder="地址" />')._("</div>")._('<a href="#" class="btn btn-award" data-collect="true" data-collect-flag="ah-awarddialog-awardbtn" data-collect-desc="领奖弹层-领奖按钮">确定</a>')._("</div>")._('<div class="ctrl award-succ">')._("<h2>实物奖品将会由工作人员联系您进行发放。</h2>")._('<h3>您还有<strong class="s-lc"></strong>次抽奖机会</h3>')._('<a href="#" class="btn btn-again" data-collect="true" data-collect-flag="ah-awarddialog-againbtn" data-collect-desc="领奖弹层-再来一次">再来一次</a>')._('<a href="#" class="btn btn-result none" data-collect="true" data-collect-flag="ah-awarddialog-resultbtn" data-collect-desc="领奖弹层-查看战绩">查看战绩</a>')._("</div>")._("</div>")._('<p class="dialog-copyright none">本活动最终解释权归安徽卫视 《超级笑星》 栏目所有</p>')._("</div>")._("</section>");return o.toString()}};var a={$dialog:null,open:function(o){i.call(this);this.event()},close:function(){this.$dialog&&this.$dialog.addClass("none")},event:function(){var o=this;this.$dialog.find(".btn-confirm").click(function(p){p.preventDefault();o.close()})},tpl:function(){var o=simpleTpl();o._('<section class="modal" id="confirm-dialog">')._('<div class="dialog confirm-dialog relocated">')._('<div class="content">资料填写不全，将被视为自愿放弃奖品。</div>')._('<div class="ctrl">')._('<a href="#" class="btn btn-confirm">返回填写</a>')._("</div>")._("</div>")._("</section>");return o.toString()}};c();return g})(Zepto);