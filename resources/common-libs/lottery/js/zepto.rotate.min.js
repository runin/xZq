(function(e){var g,f,d=document.getElementsByTagName("head")[0].style,c="transformProperty WebkitTransform OTransform msTransform MozTransform".split(" ");for(var b=0;b<c.length;b++){if(d[c[b]]!==undefined){g=c[b]}}if(g){f=g.replace(/[tT]ransform/,"TransformOrigin");if(f[0]=="T"){f[0]="t"}}e.extend(e.fn,{rotate:function(l){if(this.length===0||typeof l=="undefined"){return}if(typeof l=="number"){l={angle:l}}var k=[];for(var j=0,n=this.length;j<n;j++){var h=this.get(j);if(!h.Wilq32||!h.Wilq32.PhotoEffect){var a=e.extend(true,{},l);var m=new Wilq32.PhotoEffect(h,a)._rootObj;k.push(e(m))}else{h.Wilq32.PhotoEffect._handleRotation(l)}}return k},getRotateAngle:function(){var a=[];for(var j=0,k=this.length;j<k;j++){var h=this.get(j);if(h.Wilq32&&h.Wilq32.PhotoEffect){a[j]=h.Wilq32.PhotoEffect._angle}}return a},stopRotate:function(){for(var h=0,j=this.length;h<j;h++){var a=this.get(h);if(a.Wilq32&&a.Wilq32.PhotoEffect){clearTimeout(a.Wilq32.PhotoEffect._timer)}}}});Wilq32=window.Wilq32||{};Wilq32.PhotoEffect=(function(){if(g){return function(a,h){a.Wilq32={PhotoEffect:this};this._img=this._rootObj=this._eventObj=a;this._handleRotation(h)}}else{return function(h,i){this._img=h;this._onLoadDelegate=[i];this._rootObj=document.createElement("span");this._rootObj.style.display="inline-block";this._rootObj.Wilq32={PhotoEffect:this};h.parentNode.insertBefore(this._rootObj,h);if(h.complete){this._Loader()}else{var a=this;Zepto(this._img).bind("load",function(){a._Loader()})}}}})();Wilq32.PhotoEffect.prototype={_setupParameters:function(a){this._parameters=this._parameters||{};if(typeof this._angle!=="number"){this._angle=0}if(typeof a.angle==="number"){this._angle=a.angle}this._parameters.animateTo=(typeof a.animateTo==="number")?(a.animateTo):(this._angle);this._parameters.step=a.step||this._parameters.step||null;this._parameters.easing=a.easing||this._parameters.easing||this._defaultEasing;this._parameters.duration=a.duration||this._parameters.duration||1000;this._parameters.callback=a.callback||this._parameters.callback||this._emptyFunction;this._parameters.center=a.center||this._parameters.center||["50%","50%"];if(typeof this._parameters.center[0]=="string"){this._rotationCenterX=(parseInt(this._parameters.center[0],10)/100)*this._imgWidth*this._aspectW}else{this._rotationCenterX=this._parameters.center[0]}if(typeof this._parameters.center[1]=="string"){this._rotationCenterY=(parseInt(this._parameters.center[1],10)/100)*this._imgHeight*this._aspectH}else{this._rotationCenterY=this._parameters.center[1]}if(a.bind&&a.bind!=this._parameters.bind){this._BindEvents(a.bind)}},_emptyFunction:function(){},_defaultEasing:function(h,i,a,k,j){return -k*((i=i/j-1)*i*i*i-1)+a},_handleRotation:function(a,h){if(!g&&!this._img.complete&&!h){this._onLoadDelegate.push(a);return}this._setupParameters(a);if(this._angle==this._parameters.animateTo){this._rotate(this._angle)}else{this._animateStart()}},_BindEvents:function(j){if(j&&this._eventObj){if(this._parameters.bind){var i=this._parameters.bind;for(var h in i){if(i.hasOwnProperty(h)){Zepto(this._eventObj).unbind(h,i[h])}}}this._parameters.bind=j;for(var h in j){if(j.hasOwnProperty(h)){Zepto(this._eventObj).bind(h,j[h])}}}},_Loader:(function(){return function(){this._rootObj.setAttribute("id",this._img.getAttribute("id"));this._rootObj.className=this._img.className;this._imgWidth=this._img.naturalWidth;this._imgHeight=this._img.naturalHeight;var h=Math.sqrt((this._imgHeight)*(this._imgHeight)+(this._imgWidth)*(this._imgWidth));this._width=h*3;this._height=h*3;this._aspectW=this._img.offsetWidth/this._img.naturalWidth;this._aspectH=this._img.offsetHeight/this._img.naturalHeight;this._img.parentNode.removeChild(this._img);this._canvas=document.createElement("canvas");this._canvas.setAttribute("width",this._width);this._canvas.style.position="relative";this._canvas.style.left=-this._img.height*this._aspectW+"px";this._canvas.style.top=-this._img.width*this._aspectH+"px";this._canvas.Wilq32=this._rootObj.Wilq32;this._rootObj.appendChild(this._canvas);this._rootObj.style.width=this._img.width*this._aspectW+"px";this._rootObj.style.height=this._img.height*this._aspectH+"px";this._eventObj=this._canvas;this._cnv=this._canvas.getContext("2d");var a;while(a=this._onLoadDelegate.shift()){this._handleRotation(a,true)}}})(),_animateStart:function(){if(this._timer){clearTimeout(this._timer)}this._animateStartTime=+new Date;this._animateStartAngle=this._angle;this._animate()},_animate:function(){var j=+new Date;var i=j-this._animateStartTime>this._parameters.duration;if(i&&!this._parameters.animatedGif){clearTimeout(this._timer)}else{if(this._canvas||this._vimage||this._img){var h=this._parameters.easing(0,j-this._animateStartTime,this._animateStartAngle,this._parameters.animateTo-this._animateStartAngle,this._parameters.duration);this._rotate((~~(h*10))/10)}if(this._parameters.step){this._parameters.step(this._angle)}var a=this;this._timer=setTimeout(function(){a._animate.call(a)},10)}if(this._parameters.callback&&i){this._angle=this._parameters.animateTo;this._rotate(this._angle);this._parameters.callback.call(this._rootObj)}},_rotate:(function(){var a=Math.PI/180;if(g){return function(h){this._angle=h;this._img.style[g]="rotate("+(h%360)+"deg)";this._img.style[f]=this._parameters.center.join(" ")}}else{return function(h){this._angle=h;h=(h%360)*a;this._canvas.width=this._width;this._canvas.height=this._height;this._cnv.translate(this._imgWidth*this._aspectW,this._imgHeight*this._aspectH);this._cnv.translate(this._rotationCenterX,this._rotationCenterY);this._cnv.rotate(h);this._cnv.translate(-this._rotationCenterX,-this._rotationCenterY);this._cnv.scale(this._aspectW,this._aspectH);this._cnv.drawImage(this._img,0,0)}}})()}})(Zepto);