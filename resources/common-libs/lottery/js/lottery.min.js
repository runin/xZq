(function(a){a.fn.lottery=function(d){var f={colors:["#FFE327","#FFFF98"],images:[],image_size:45,image_radius:98,btn_needle:"",canvas_size:270,outside_stroke_width:10,inside_stroke_width:1,stroke_color:"#ED4344",text_size:16,text_color:"#ED4344",texts:[],text_radius:105,duration:8500,cycles:2};var d=a.extend({},f,d),c=a(this).get(0);var b=function(){if(c.getContext){var w=c.getContext("2d"),q=1.5*Math.PI,n=d.canvas_size/2,m=d.canvas_size/2,j=20,u=(d.canvas_size-d.outside_stroke_width)/2,h=Math.PI*2/d.texts.length,p=[];w.clearRect(0,0,500,500);for(var o=0,r=d.texts.length;o<r;o++){var l=q+o*h;w.fillStyle=d.colors[o%2];w.strokeStyle=d.stroke_color;w.beginPath();w.arc(n,m,u,l,l+h,false);w.lineWidth=d.outside_stroke_width;w.fill();w.stroke();w.arc(n,m,j,l+h,l,true);w.lineWidth=d.inside_stroke_width;w.closePath();w.fill();w.stroke();w.save();w.fillStyle=d.text_color;w.font=d.text_size+"px 'Microsoft YaHei'";w.save();w.translate(n+Math.cos(l+h/2)*d.text_radius,m+Math.sin(l+h/2)*d.text_radius);w.rotate(l+h/2+Math.PI/2);var v=d.texts[o];w.fillText(v,-w.measureText(v).width/2,0);w.restore();var k=new Image(),t=n+Math.cos(l+h/2)*d.image_radius,s=m+Math.sin(l+h/2)*d.image_radius;p.push({x:t,y:s});k.src=d.images[o];k.onload=(function(x,C,A,z,y,B){return function(){x.save();var i=g(B.width,B.height);x.translate(z[y].x,z[y].y);x.rotate(C+A/2+Math.PI/2);x.drawImage(B,-i.width/2,0,i.width,i.height);x.restore()}})(w,l,h,p,o,k);w.restore()}}};var g=function(m,h){var j=d.image_size,k=d.image_size,i={width:j,height:k};if(m>d.image_size||h>d.image_size){var l=m/h;if(l<=1){i.width=Math.round(m*j/h)}else{i.height=Math.round(h*j/m)}}return i};var e=function(){var j=a(d.btn_needle),h=d.texts.length,i=Math.PI*2/h;if(j.length==0){return}j.click(function(p){p.preventDefault();var n=Math.ceil(Math.random()*(h-1)+1),m=360/h,k=m/5,o=m*(n-1)+k,l=m*n-k,q=Math.floor(Math.random()*(l-o)+o);j.stopRotate();j.rotate({angle:0,duration:d.duration,animateTo:q+d.cycles*360,callback:function(){var r=Math.floor((q%360)/(i*180/Math.PI));alert(d.texts[r]);window.location.reload()}})})};b();e()}})(Zepto);