function hex_md5(a){return rstr2hex(rstr_md5(str2rstr_utf8(a)))}function hex_hmac_md5(a,b){return rstr2hex(rstr_hmac_md5(str2rstr_utf8(a),str2rstr_utf8(b)))}function md5_vm_test(){return"900150983cd24fb0d6963f7d28e17f72"==hex_md5("abc").toLowerCase()}function rstr_md5(a){return binl2rstr(binl_md5(rstr2binl(a),8*a.length))}function rstr_hmac_md5(a,b){var c=rstr2binl(a);c.length>16&&(c=binl_md5(c,8*a.length));for(var d=Array(16),e=Array(16),f=0;16>f;f++)d[f]=909522486^c[f],e[f]=1549556828^c[f];var g=binl_md5(d.concat(rstr2binl(b)),512+8*b.length);return binl2rstr(binl_md5(e.concat(g),640))}function rstr2hex(a){try{}catch(b){hexcase=0}for(var c,d=hexcase?"0123456789ABCDEF":"0123456789abcdef",e="",f=0;f<a.length;f++)c=a.charCodeAt(f),e+=d.charAt(c>>>4&15)+d.charAt(15&c);return e}function str2rstr_utf8(a){for(var b,c,d="",e=-1;++e<a.length;)b=a.charCodeAt(e),c=e+1<a.length?a.charCodeAt(e+1):0,b>=55296&&56319>=b&&c>=56320&&57343>=c&&(b=65536+((1023&b)<<10)+(1023&c),e++),127>=b?d+=String.fromCharCode(b):2047>=b?d+=String.fromCharCode(192|b>>>6&31,128|63&b):65535>=b?d+=String.fromCharCode(224|b>>>12&15,128|b>>>6&63,128|63&b):2097151>=b&&(d+=String.fromCharCode(240|b>>>18&7,128|b>>>12&63,128|b>>>6&63,128|63&b));return d}function rstr2binl(a){for(var b=Array(a.length>>2),c=0;c<b.length;c++)b[c]=0;for(var c=0;c<8*a.length;c+=8)b[c>>5]|=(255&a.charCodeAt(c/8))<<c%32;return b}function binl2rstr(a){for(var b="",c=0;c<32*a.length;c+=8)b+=String.fromCharCode(a[c>>5]>>>c%32&255);return b}function binl_md5(a,b){a[b>>5]|=128<<b%32,a[(b+64>>>9<<4)+14]=b;for(var c=1732584193,d=-271733879,e=-1732584194,f=271733878,g=0;g<a.length;g+=16){var h=c,i=d,j=e,k=f;c=md5_ff(c,d,e,f,a[g+0],7,-680876936),f=md5_ff(f,c,d,e,a[g+1],12,-389564586),e=md5_ff(e,f,c,d,a[g+2],17,606105819),d=md5_ff(d,e,f,c,a[g+3],22,-1044525330),c=md5_ff(c,d,e,f,a[g+4],7,-176418897),f=md5_ff(f,c,d,e,a[g+5],12,1200080426),e=md5_ff(e,f,c,d,a[g+6],17,-1473231341),d=md5_ff(d,e,f,c,a[g+7],22,-45705983),c=md5_ff(c,d,e,f,a[g+8],7,1770035416),f=md5_ff(f,c,d,e,a[g+9],12,-1958414417),e=md5_ff(e,f,c,d,a[g+10],17,-42063),d=md5_ff(d,e,f,c,a[g+11],22,-1990404162),c=md5_ff(c,d,e,f,a[g+12],7,1804603682),f=md5_ff(f,c,d,e,a[g+13],12,-40341101),e=md5_ff(e,f,c,d,a[g+14],17,-1502002290),d=md5_ff(d,e,f,c,a[g+15],22,1236535329),c=md5_gg(c,d,e,f,a[g+1],5,-165796510),f=md5_gg(f,c,d,e,a[g+6],9,-1069501632),e=md5_gg(e,f,c,d,a[g+11],14,643717713),d=md5_gg(d,e,f,c,a[g+0],20,-373897302),c=md5_gg(c,d,e,f,a[g+5],5,-701558691),f=md5_gg(f,c,d,e,a[g+10],9,38016083),e=md5_gg(e,f,c,d,a[g+15],14,-660478335),d=md5_gg(d,e,f,c,a[g+4],20,-405537848),c=md5_gg(c,d,e,f,a[g+9],5,568446438),f=md5_gg(f,c,d,e,a[g+14],9,-1019803690),e=md5_gg(e,f,c,d,a[g+3],14,-187363961),d=md5_gg(d,e,f,c,a[g+8],20,1163531501),c=md5_gg(c,d,e,f,a[g+13],5,-1444681467),f=md5_gg(f,c,d,e,a[g+2],9,-51403784),e=md5_gg(e,f,c,d,a[g+7],14,1735328473),d=md5_gg(d,e,f,c,a[g+12],20,-1926607734),c=md5_hh(c,d,e,f,a[g+5],4,-378558),f=md5_hh(f,c,d,e,a[g+8],11,-2022574463),e=md5_hh(e,f,c,d,a[g+11],16,1839030562),d=md5_hh(d,e,f,c,a[g+14],23,-35309556),c=md5_hh(c,d,e,f,a[g+1],4,-1530992060),f=md5_hh(f,c,d,e,a[g+4],11,1272893353),e=md5_hh(e,f,c,d,a[g+7],16,-155497632),d=md5_hh(d,e,f,c,a[g+10],23,-1094730640),c=md5_hh(c,d,e,f,a[g+13],4,681279174),f=md5_hh(f,c,d,e,a[g+0],11,-358537222),e=md5_hh(e,f,c,d,a[g+3],16,-722521979),d=md5_hh(d,e,f,c,a[g+6],23,76029189),c=md5_hh(c,d,e,f,a[g+9],4,-640364487),f=md5_hh(f,c,d,e,a[g+12],11,-421815835),e=md5_hh(e,f,c,d,a[g+15],16,530742520),d=md5_hh(d,e,f,c,a[g+2],23,-995338651),c=md5_ii(c,d,e,f,a[g+0],6,-198630844),f=md5_ii(f,c,d,e,a[g+7],10,1126891415),e=md5_ii(e,f,c,d,a[g+14],15,-1416354905),d=md5_ii(d,e,f,c,a[g+5],21,-57434055),c=md5_ii(c,d,e,f,a[g+12],6,1700485571),f=md5_ii(f,c,d,e,a[g+3],10,-1894986606),e=md5_ii(e,f,c,d,a[g+10],15,-1051523),d=md5_ii(d,e,f,c,a[g+1],21,-2054922799),c=md5_ii(c,d,e,f,a[g+8],6,1873313359),f=md5_ii(f,c,d,e,a[g+15],10,-30611744),e=md5_ii(e,f,c,d,a[g+6],15,-1560198380),d=md5_ii(d,e,f,c,a[g+13],21,1309151649),c=md5_ii(c,d,e,f,a[g+4],6,-145523070),f=md5_ii(f,c,d,e,a[g+11],10,-1120210379),e=md5_ii(e,f,c,d,a[g+2],15,718787259),d=md5_ii(d,e,f,c,a[g+9],21,-343485551),c=safe_add(c,h),d=safe_add(d,i),e=safe_add(e,j),f=safe_add(f,k)}return Array(c,d,e,f)}function md5_cmn(a,b,c,d,e,f){return safe_add(bit_rol(safe_add(safe_add(b,a),safe_add(d,f)),e),c)}function md5_ff(a,b,c,d,e,f,g){return md5_cmn(b&c|~b&d,a,b,e,f,g)}function md5_gg(a,b,c,d,e,f,g){return md5_cmn(b&d|c&~d,a,b,e,f,g)}function md5_hh(a,b,c,d,e,f,g){return md5_cmn(b^c^d,a,b,e,f,g)}function md5_ii(a,b,c,d,e,f,g){return md5_cmn(c^(b|~d),a,b,e,f,g)}function safe_add(a,b){var c=(65535&a)+(65535&b),d=(a>>16)+(b>>16)+(c>>16);return d<<16|65535&c}function bit_rol(a,b){return a<<b|a>>>32-b}function recordUserPage(a,b,c){recordUserLog(a,b,"",c,"true")}var hexcase=0,hex_sha1=function(a){function b(a){return f(g(e(a),8*a.length))}function c(a){var b,c="";for(var d in a)b=a.charCodeAt(d),c+=(b>>4&15).toString(16)+(15&b).toString(16);return c}function d(b){for(var c,d,e="",f=-1;++f<b.length;)c=b.charCodeAt(f),d=f+1<b.length?b.charCodeAt(f+1):0,c>=55296&&56319>=c&&d>=56320&&57343>=d&&(c=65536+((1023&c)<<10)+(1023&d),f++),127>=c?e+=a(c):2047>=c?e+=a(192|c>>6&31,128|63&c):65535>=c?e+=a(224|c>>12&15,128|c>>6&63,128|63&c):2097151>=c&&(e+=a(240|c>>18&7,128|c>>12&63,128|c>>6&63,128|63&c));return e}function e(a){for(var b=[],c=0;c<8*a.length;c+=8)b[c>>5]|=(255&a.charCodeAt(c/8))<<24-c%32;return b}function f(b){for(var c="",d=0;d<32*b.length;d+=8)c+=a(b[d>>5]>>24-d%32&255);return c}function g(a,b){a[b>>5]|=128<<24-b%32,a[(b+64>>9<<4)+15]=b;for(var c=[],d=1732584193,e=-271733879,f=-1732584194,g=271733878,l=-1009589776,m=0;m<a.length;m+=16){for(var n=d,o=e,p=f,q=g,r=l,s=0;80>s;s++){16>s?c[s]=a[m+s]:c[s]=k(c[s-3]^c[s-8]^c[s-14]^c[s-16],1);var t=j(j(k(d,5),h(s,e,f,g)),j(j(l,c[s]),i(s)));l=g,g=f,f=k(e,30),e=d,d=t}d=j(d,n),e=j(e,o),f=j(f,p),g=j(g,q),l=j(l,r)}return[d,e,f,g,l]}function h(a,b,c,d){return 20>a?b&c|~b&d:40>a?b^c^d:60>a?b&c|b&d|c&d:b^c^d}function i(a){return 20>a?1518500249:40>a?1859775393:60>a?-1894007588:-899497514}function j(a,b){var c=(65535&a)+(65535&b),d=(a>>16)+(b>>16)+(c>>16);return d<<16|65535&c}function k(a,b){return a<<b|a>>>32-b}return a=String.fromCharCode,function(a){return c(b(d(a)))}}(),__ns=function(fullNs){for(var nsArray=fullNs.split("."),evalStr="",ns="",i=0,l=nsArray.length;l>i;i++)0!==i&&(ns+="."),ns+=nsArray[i],evalStr+="( typeof "+ns+' === "undefined" && ('+ns+" = {}) );";""!==evalStr&&eval(evalStr)},__noop=function(){},W=W||window;__ns("H");var getQueryString=function(a){var b=decodeURIComponent(location.search.slice(1));if(""!=b){for(var c,d=b.split("&"),e=0,f=d.length;f>e;e++)if(c=d[e].split("="),c[0]===a)return c[1];return""}return""},from=getQueryString("from"),recordUserLog=function(a,b,c,d,e){$.ajax({type:"get",async:!1,url:domain_url+"userlog",dataType:"jsonp",jsonp:"callback",jsonpCallback:"callbackDataHandler",data:{openId:a,operateDesc:encodeURIComponent(b),operateDomId:c,loadingTime:d,from:from,flag:e}})},recordUserOperate=function(a,b,c){recordUserLog(a,b,c,"","false")},callbackUserSaveHandler=function(a){};$(function(){recordUserPage(openid,$("title").html(),""),$("body").delegate("*[data-collect='true']","click",function(a){a.preventDefault(),"true"==$(this).attr("data-stoppropagation")&&a.stopPropagation(),recordUserOperate(openid,$(this).attr("data-collect-desc"),$(this).attr("data-collect-flag"));var b=$(this).attr("href");b&&"#"!==b&&(from&&(b=add_param(b,"from",from,!0)),setTimeout(function(){window.location.href=b},5))})});var getUrl=function(){var a=window.location.href;if(-1!=a.indexOf("http://yao.qq.com/tv/entry?redirect_uri=")){var b=a.indexOf("=");a=a.substr(b)}var c=getQueryString("uid"),d=getQueryString("auid");return c?(a=a,a=add_param(a,"toShare",null,!0)):d?(a=a,a=add_param(a,"toShare",null,!0)):a=share_page?a.replace(/[^\/]*\.html/i,share_page):a.replace(/[^\/]*\.html/i,"index.html"),a=add_param(a,"resopenid",hex_md5(openid),!0),a=add_param(a,"from","share",!0),a=add_param(a,"openid",null,!0),a=add_param(a,"headimgurl",null,!0),a=add_param(a,"nickname",null,!0)},add_param=function(a,b,c,d){(null==a||0==a.length)&&(a=document.location.href);var e=a.split("?"),f="";if(e.length>1)for(var g=e[1].split("&"),h=0;h<g.length;h++){var i=g[h].split("=");d&&i[0]==b||(""==f?f="?":f+="&",f+=i[0]+"="+i[1])}return null!==c&&(""==f?f="?":f+="&",f+=b+"="+c),e[0]+f},add_yao_prefix=function(a){return"http://yao.qq.com/tv/entry?redirect_uri="+encodeURIComponent(a)};$(function(){$.ajax({type:"get",async:!1,url:domain_url+"api/common/versioncheck",dataType:"jsonp",jsonp:"callback",jsonpCallback:"commonApiVersionHandler",success:function(a){if(!a.result){var b=a.redirect;if(-1!=b.indexOf("http://yao.qq.com/tv/entry?redirect_uri=")){var c=b.indexOf("=");b=b.substr(c+1)}return void(location.href=decodeURIComponent(b))}share_img=share_img?share_img:a.si,share_title=share_title?share_title:a.st,share_desc=share_desc?share_desc:a.sd,window.shaketv&&shaketv.wxShare(share_img,share_title,share_desc,getUrl()),window.callbackMpJsapiTicketHandler=function(a){},$.ajax({type:"GET",url:domain_url+"api/mp/auth/jsapiticket",data:{mpappid:mpappid},async:!0,dataType:"jsonp",jsonpCallback:"callbackMpJsapiTicketHandler",success:function(a){if(a.result){var b="da7d7ce1f499c4795d7181ff5d045760",c=Math.round((new Date).getTime()/1e3),d=window.location.href.split("#")[0],e=hex_sha1("jsapi_ticket="+a.ticket+"&noncestr="+b+"&timestamp="+c+"&url="+d);wx.config({appId:mpappid,timestamp:c,nonceStr:b,signature:e,jsApiList:["onMenuShareAppMessage","onMenuShareTimeline","onMenuShareQQ","onMenuShareWeibo","onMenuShareQZone"]}),wx.ready(function(){wx.onMenuShareTimeline({title:share_title,link:getUrl(),imgUrl:share_img}),wx.onMenuShareAppMessage({title:share_title,desc:share_desc,link:getUrl(),imgUrl:share_img}),wx.onMenuShareQQ({title:share_title,desc:share_desc,link:getUrl(),imgUrl:share_img}),wx.onMenuShareWeibo({title:share_title,desc:share_desc,link:getUrl(),imgUrl:share_img}),wx.onMenuShareQZone({title:share_title,desc:share_desc,link:getUrl(),imgUrl:share_img})})}},error:function(a,b){}})},error:function(){}})});var getResult=function(a,b,c,d,e,f,g){d&&showLoading(e);var a=domain_url+a;"undefined"!=typeof isDev&&isDev.length>0&&(a=add_param(a,"dev",isDev,!0)),$.ajax({type:"GET",async:"undefined"==typeof f?!1:f,url:a,data:b,dataType:"jsonp",jsonp:c,complete:function(){d&&hideLoading(e)},success:function(a){},error:function(){$.isFunction(g)&&g()}})},simpleTpl=function(a){return a=$.isArray(a)?a.join(""):a||"",{store:a,_:function(){var a=this;return $.each(arguments,function(b,c){a.store+=c}),this},toString:function(){return this.store}}},showLoading=function(a){var b=simpleTpl(),a=a||$("body"),c=a?a.find(".spinner"):$("body").children(".spinner");if(c.length>0)c.show();else{b._('<div class="spinner">')._('<div class="spinner-wrapper">')._('<div class="spinner-container container1">')._('<div class="circle1"></div>')._('<div class="circle2"></div>')._('<div class="circle3"></div>')._('<div class="circle4"></div>')._("</div>")._('<div class="spinner-container container2">')._('<div class="circle1"></div>')._('<div class="circle2"></div>')._('<div class="circle3"></div>')._('<div class="circle4"></div>')._("</div>")._('<div class="spinner-container container3">')._('<div class="circle1"></div>')._('<div class="circle2"></div>')._('<div class="circle3"></div>')._('<div class="circle4"></div>')._("</div>")._("</div>")._("</div>");var d=$(window).width(),e=$(window).height(),f=50;c=$(b.toString()).css({left:(d-f)/2,top:(e-f)/2}),a.append(c)}},hideLoading=function(a){a?a.find(".spinner").hide():$("body").children(".spinner").hide(),$(".copyright").removeClass("hidden")},showNewLoading=function(a,b){var c=simpleTpl(),d=146,e=$(window).width(),f=$(window).height(),a=a||$("body"),g=a?a.find("#spinner"):$("body").children("#spinner"),b=b||"努力加载中...";g.length>0&&g.remove(),c._('<div id="spinner" class="spinner">')._('<div class="new-spinner">')._('<div class="new-overlay"></div>')._('<div class="new-spinner-inner">')._('<p class="new-spinner-spinner"></p>')._('<p class="new-spinner-text">'+b+"</p>")._("</div>")._("</div>")._("</div>")._("</div>"),g=$(c.toString()).css({top:(f-d)/2,left:(e-d)/2}),a.append(g)},hideNewLoading=function(a){a?a.find(".spinner").remove():$("body").children(".spinner").remove()};!function(a){a.openid=$.fn.cookie(mpappid+"_openid"),a.headimgurl=$.fn.cookie(mpappid+"_headimgurl"),a.nickname=$.fn.cookie(mpappid+"_nickname"),a.expires_in={expires:30},a.Authorize=function(a){this.mpappid=a&&a.mpappid||mpappid,this.serviceNo=a&&a.serviceNo||serviceNo,this.scope="snsapi_userinfo",this.redirect_uri=domain_url+"api/mp/auth/snsapi_userinfo",this.callBackPage=a&&a.callBackPage||"",this.param=""},Authorize.prototype.authorize=function(a){window.location.href="https://open.weixin.qq.com/connect/oauth2/authorize?appid="+this.mpappid+"&redirect_uri="+encodeURIComponent(this.redirect_uri+"?callBackPage="+this.callBackPage+"&param="+this.param)+"&response_type=code&scope="+this.scope+"&state="+this.serviceNo+"#wechat_redirect",a&&a()},Authorize.prototype.getQueryParam=function(a){var b=decodeURIComponent(location.search.slice(1));if(""!=b){for(var c,d=b.split("&"),e=0,f=d.length;f>e;e++)if(c=d[e].split("="),c[0]===a)return c[1];return""}return""},Authorize.prototype.getParam=function(){for(var a,b={},c=decodeURIComponent(location.search.slice(1)).split("&"),d=0,e=c.length;e>d;d++)a=c[d].split("="),b[a[0]]=a[1];this.param=encodeURIComponent(JSON.stringify(b))},Authorize.prototype.init=function(a){this.getParam();var b=this;openid&&nickname?($.fn.cookie(mpappid+"_openid",openid,expires_in),a&&setTimeout(function(){a()},50)):(openid=b.getQueryParam("openid"),openid&&$.fn.cookie(mpappid+"_openid",openid,expires_in),openid||b.authorize(function(){})),headimgurl?$.fn.cookie(mpappid+"_headimgurl",headimgurl,expires_in):(headimgurl=b.getQueryParam("headimgurl"),headimgurl&&$.fn.cookie(mpappid+"_headimgurl",headimgurl,expires_in)),nickname?$.fn.cookie(mpappid+"_nickname",nickname,expires_in):(nickname=b.getQueryParam("nickname"),nickname&&$.fn.cookie(mpappid+"_nickname",nickname,expires_in))},(new Authorize).init()}(window),function(a,b){function c(a){function c(a,b){return Math.floor(a+Math.random()*(b-a))}this.itemArr=[],window.corpsItem=function(a,d,e,f){this.classify=e,this.speed=e.speed+2*Math.random();var g=e.rotation+Math.random()/100;c(0,10)%2==0&&(g=-g),this.rotation=g,this.tt=PIXI.Texture.fromImage(d),this.dude=new PIXI.Sprite(this.tt),f&&(this.dude.visible=!1),this.px=c(40,b(window).width()-40),this.py=-100,this.dude.position.x=this.px,this.dude.position.y=this.py,this.dude.anchor.x=.5,this.dude.anchor.y=.5,a.stage.addChild(this.dude)},corpsItem.prototype.calculateTarget=function(b){var c=a.BucketDude.width,d=a.BucketDude.height,e=(this.dude.width,a.BucketDude.x),f=a.BucketDude.y,g=this.dude.position.x,h=this.dude.position.y,i=e+c/2,j=e-c/2;0>h||i>g&&g>j&&Math.abs(h-(f-d/2))<5&&b&&b(!0,this)},corpsItem.prototype.setSpecialEffects=function(b){for(var c=0;c<a.Corps.length;c++)a.Corps[c].dude.visible=!1,a.Corps[c].ishit=!0;window.smallCorpsSpecial=[];for(var c=0,d=30;d>c;c++){var e=new corpsItem(a,a.noCloud.url,a.smallCloud,!0);e.dude.position.x=a.BucketDude.position.x,e.dude.position.y=a.BucketDude.position.y;var f=Math.random(),g=f>.3?5*Math.random():5;e.angle=2*Math.PI*Math.random(),e.dx=g*Math.sin(e.angle),e.dy=g*Math.cos(e.angle)-4,e.setPlace=function(){this.dude.position.x+=this.dx/3.5,this.dude.position.y+=this.dy/3.5},smallCorpsSpecial.push(e)}setTimeout(function(){b&&b()},1e3)};for(var d=0,e=a.bigCloud.count;e>d;d++)this.itemArr.push(new corpsItem(a,a.bigCloud.url,a.bigCloud));for(d=0,e=a.smallCloud.count;e>d;d++)this.itemArr.push(new corpsItem(a,a.smallCloud.url,a.smallCloud));for(d=0,e=a.boom.count;e>d;d++)this.itemArr.push(new corpsItem(a,a.boom.url,a.boom));for(d=0,e=a.noCloud.count;e>d;d++)this.itemArr.push(new corpsItem(a,a.noCloud.url,a.noCloud));for(d=0,e=a.mcCloud.count;e>d;d++)this.itemArr.push(new corpsItem(a,a.mcCloud.url,a.mcCloud))}function d(a){var b=this,c=PIXI.loader.add("images/icon-bag.png").load(function(){b.Bucket=PIXI.Texture.fromImage("images/icon-bag.png"),a.BucketDude=new PIXI.Sprite(b.Bucket),a.BucketDude.scale.set(.6),a.BucketDude.anchor.x=.5,a.BucketDude.anchor.y=.5,a.BucketDude.position.x=a.renderer.width/2,a.BucketDude.position.y=a.renderer.height-a.BucketDude.height/2-5,a.stage.addChild(a.BucketDude),b.BucketDude=a.BucketDude,b.dragging(a),c.resources["images/icon-bag.png"]=null})}a.Game=function(){this.score=0,this.maxScore=0,this.gameTime=10,this.dowmCorps=[],this.getScoreCallBack=null},Game.prototype.init=function(){this.initParm(),this.initMove()},Game.prototype.initParm=function(){this.stage_main=b("#stage_main"),this.renderer=PIXI.autoDetectRenderer(b(window).width(),b(window).height()),this.stage=new PIXI.Container},Game.prototype.initMove=function(){this.setBg(),this.pop(),this.initBucket(),this.downCountFn(),this.stage_main.append(this.renderer.view)},Game.prototype.setBg=function(){this.stage_main.css({width:this.renderer.width,height:this.renderer.height}),this.background=PIXI.Sprite.fromImage("./images/bg-game.jpg"),this.background.width=this.renderer.width,this.background.height=this.renderer.height,this.stage.addChild(this.background)},Game.prototype.pop=function(){this.popIcon=PIXI.Texture.fromImage("./images/icon-pop.png"),this.popdude=new PIXI.Sprite(this.popIcon),this.popdude.scale.set(.1),this.popdude.anchor.x=.5,this.popdude.anchor.y=.5,this.popdude.position.x=this.renderer.width/2,this.popdude.position.y=.2*this.renderer.height,this.stage.addChild(this.popdude)},Game.prototype.initBucket=function(){this.Bucket=new d(this)},Game.prototype.initCorps=function(){this.setEachCorpsNum(this),this.Corps=new c(this).getCorps()},Game.prototype.setEachCorpsNum=function(a){function c(){var c=b(window).height();a.noCloud.speed=a.noCloud.speed*c/568,a.bigCloud.speed=a.bigCloud.speed*c/568,a.smallCloud.speed=a.smallCloud.speed*c/568,a.mcCloud.speed=a.mcCloud.speed*c/568,a.boom.speed=a.boom.speed*c/568}this.noCloud={name:"noCloud",count:1,url:"images/icon-pop-small.png",rotation:.01,speed:4,score:1,percent:.4,setCount:function(){this.count=Math.ceil(a.maxScore*this.percent/this.score)}},this.bigCloud={name:"bigCloud",count:1,url:"images/icon-pop-middle2.png",rotation:.01,speed:5,score:5,percent:.3,setCount:function(){this.count=Math.ceil(a.maxScore*this.percent/this.score)}},this.smallCloud={name:"smallCloud",count:1,url:"images/icon-pop-middle.png",rotation:.01,speed:6,score:5,percent:.2,setCount:function(){this.count=Math.ceil(a.maxScore*this.percent/this.score)}},this.mcCloud={name:"mcCloud",count:1,url:"images/icon-pop-mc.png",rotation:.01,speed:7,score:10,percent:.1,setCount:function(){this.count=Math.ceil(a.maxScore*this.percent/this.score)}},this.boom={name:"boom",count:1,url:"images/icon-boom.png",rotation:.01,speed:8,score:-5,percent:.3,setCount:function(){this.count=-Math.ceil(a.maxScore*this.percent/this.score)}},this.maxScore<=99?(this.noCloud.count=46,this.bigCloud.count=4,this.smallCloud.count=4,this.mcCloud.count=1):this.maxScore<=199?(this.noCloud.count=24,this.bigCloud.count=13,this.smallCloud.count=14,this.mcCloud.count=4):this.maxScore<=299?(this.noCloud.count=9,this.bigCloud.count=17,this.smallCloud.count=17,this.mcCloud.count=12):this.maxScore>299&&(this.noCloud.count=7,this.bigCloud.count=16,this.smallCloud.count=16,this.mcCloud.count=16),this.boom.setCount();var a=this;c()},Game.prototype.reStart=function(a){this.stage_main.empty(),this.isEnd=!1,this.pCount=null,this.score=0,this.maxScore=0,this.gameTime=10,this.dowmCorps=[],this.getScoreCallBack=null,this.popdude.visible=!0,this.popdude.visible=!0,this.Corps=[],this.Bucket=[],this.renderer=null,this.stage=null,this.BucketDude=null,this.background=null,this.noCloud=null,this.bigCloud=null,this.smallCloud=null,this.mcCloud=null,this.boom=null,this.popIcon=null,this.popdude=null,this.downContainer=null,this.downCount=null,this.downText=null,window.corpsItem=null,window.GameDownCount&&clearInterval(window.GameDownCount),this.start(a||this.object)},Game.prototype.start=function(a){function c(){h.pCount>.5||(h.pCount||(h.pCount=.1),h.pCount+=.02,h.popdude.scale.set(h.pCount>=.5?.5:h.pCount),h.pCount>=.5&&(d(),setTimeout(function(){h.popdude.visible=!1},1e3)))}function d(){window.GameDownCount=setInterval(function(){var a=m();if(0!=a)n.push(a),l=a,k++;else if(k==h.Corps.length-1&&l.dude.position.y>i){for(var b=!0,c=n.length-20;c<n.length;c++)n[c].dude.position.y<i&&(b=!1);b&&h.end()}},300)}function e(){function a(a,b){return Math.floor(a+Math.random()*(b-a))}var b=[],c=0,d=h.Corps.length-1;return{getCorps:function(){for(var e=a(c,d),f=!1,g=h.Corps.length;g>0;){if(g--,-1==b.indexOf(e)){f=!0,b.push(e);break}e=a(c,d)}return f?h.Corps[e]:!1},clear:function(){b=null}}}function f(){if(0==h.popdude.visible)for(var a=0;a<n.length;a++)if(n[a]&&1!=n[a].isCompleter){if(n[a].dude.position.y+=n[a].speed,n[a].dude.rotation+=n[a].rotation,window.smallCorpsSpecial){h.Bucket.removeChild();for(var b=0;b<window.smallCorpsSpecial.length;b++){var c=smallCorpsSpecial[b];c.setPlace(),c.dude.rotation+=c.rotation,c.dude.visible=!0}}n[a].calculateTarget(function(a,b){if(a&&!b.ishit){if(b.ishit=!0,"boom"==b.classify.name)return void b.setSpecialEffects(function(){h.end()});b.dude.visible=!1,0==h.score&&h.Bucket.addChild(),h.score+=b.classify.score,h.score<10?h.downText.text="0"+h.score+"分":h.downText.text=h.score+"分",h.score>99&&(h.downText.position.x=j-63),h.getScoreCallBack&&h.getScoreCallBack(h.score)}}),n[a].dude.position.y>i&&(n[a].dude.visible=!1,n[a].isCompleter=!0)}}function g(){h.isEnd||(c(),f(),window.game_re=requestAnimationFrame(g),h.renderer.render(h.stage))}var h=this;this.object=b.extend({maxScore:199,getScoreCallBack:null},a||{}),b.extend(this,a),this.gameTimeTemp=this.gameTime;var i=b(window).height(),j=b(window).width();this.init(),this.initCorps();var k=1,l=null;window.CorpsObj=e();var m=CorpsObj.getCorps,n=[];n.push(m()),h.isEnd=!1,g(),a&&a.callBack&&a.callBack(h)},Game.prototype.end=function(a){this.isEnd=!0;for(var b=0;b<this.Corps.length;b++)this.Corps[b].dude.visible=!1;this.Corps=[],a&&a.getScoreCallBack&&a.getScoreCallBack(this.score),this.endCallBack&&this.endCallBack(this.score),window.GameDownCount&&clearInterval(window.GameDownCount),window.cancelAnimationFrame(window.game_re),window.smallCorpsSpecial=null,window.CorpsObj.clear()},Game.prototype.getScore=function(){return this.score},Game.prototype.downCountFn=function(){this.downContainer=new PIXI.Container;var a=PIXI.Texture.fromImage("images/bg_contain.png");this.downCount=new PIXI.Sprite(a),this.downCount.scale.set(.8),this.downCount.position.x=b(window).width()-75,this.downCount.position.y=10,this.downCount.anchor.x=0,this.downCount.anchor.y=0,this.downContainer.addChild(this.downCount),this.downText=new PIXI.Text("0"+this.score+"分"),this.downText.style.align="center",this.downText.width=90,this.downText.height=40,this.downText.scale.set(.7),this.downText.position.x=b(window).width()-58,this.downText.position.y=34,this.downText.anchor.x=0,this.downText.anchor.y=0,this.downContainer.addChild(this.downText),this.stage.addChild(this.downContainer)},c.prototype.getCorps=function(){return this.itemArr},d.prototype.getBucket=function(){return this.BucketDude},d.prototype.dragging=function(a){function b(a){this.data=a.data,this.dragging=!0}function c(){this.dragging=!1,this.data=null}function d(){if(this.dragging){var b=this.data.getLocalPosition(this.parent),c=b.x;c<a.BucketDude.width/2&&(c=a.BucketDude.width/2),c>a.renderer.width-a.BucketDude.width/2&&(c=a.renderer.width-a.BucketDude.width/2),this.position.x=c}}a.BucketDude.interactive=!0,a.BucketDude.buttonMode=!0,a.BucketDude.on("mousedown",b).on("touchstart",b).on("mouseup",c).on("mouseupoutside",c).on("touchend",c).on("touchendoutside",c).on("mousemove",d).on("touchmove",d)},d.prototype.addChild=function(){var a=PIXI.Texture.fromImage("images/icon-pop-small.png"),b=new PIXI.Sprite(a);b.scale.set(1.5),b.anchor.x=0,b.anchor.y=0,b.position.x=-this.BucketDude.width+50,b.position.y=-this.BucketDude.height,this.sms=b,this.BucketDude.addChild(this.sms);var a=PIXI.Texture.fromImage("images/icon-pop-small.png"),b=new PIXI.Sprite(a);b.scale.set(1.5),b.anchor.x=0,b.anchor.y=0,b.position.x=-this.BucketDude.width+100,b.position.y=-this.BucketDude.height,this.sms2=b,this.BucketDude.addChild(this.sms2);var a=PIXI.Texture.fromImage("images/icon-bag.png"),b=new PIXI.Sprite(a);b.anchor.x=.5,b.anchor.y=.5,this.sms3=b,this.BucketDude.addChild(this.sms3)},d.prototype.removeChild=function(){this.BucketDude.removeChildren()}}(window,Zepto),function(a){H.loading={percent:0,$stage:a("#stage_loading"),$loadingBar:a("#loading_bar"),init:function(){this.resize(),PIXI.loader.add(gameConfig.assetsToLoader),PIXI.loader.load(function(){H.loading.$loadingBar.find("p").html("加载完成"),setTimeout(function(){H.loading.$stage.addClass("none"),H.index.init(),H.record.init(),H.info.init(),H.rule.init(),H.rank.init()},200)})},resize:function(){var b=a(window).height();this.$stage.css("height",b),this.$stage.removeClass("none"),this.$loadingBar.css("top",(b-70)/2).removeClass("none"),this.$stage.css("opacity",1)}},H.index={$stage:a("#stage_index"),$stages:a(".stage"),$play:a("#stage_index .play-btn"),$ruleDialog:a("#rule_dialog"),$rankDialog:a("#rank_dialog"),$bgm:a("#bgm"),game:null,awardList:null,lastScore:0,isRestart:!1,init:function(){this.resize(),this.bindBtns(),getResult("api/lottery/leftLotteryCount",{oi:openid},"callbackLotteryleftLotteryCountHandler")},start:function(){showNewLoading(),getResult("api/lottery/prizes",{at:5},"callbackLotteryPrizesHandler")},initAward:function(a){this.awardList=a.pa},startGame:function(b){this.$bgm[0].play(),this.isRestart?H.index.game.reStart({maxScore:b}):(H.index.$stage.animate({opacity:0},1300,"ease"),a("#stage_main").removeClass("none"),a(".crop-animate-wrapper").html(a(".crop.valid").last()[0]),setTimeout(function(){a(".crop-animate-wrapper .crop").css({"-webkit-transform":"translate(0px,-400px)"}),setTimeout(function(){H.index.$stage.addClass("none"),H.index.game=new Game,H.index.game.start({maxScore:b,endCallBack:function(a){H.index.endGame(a)}})},1e3)},300))},restartGame:function(){this.isRestart=!0,getResult("api/lottery/luck",{oi:openid},"callbackLotteryLuckHandler")},endGame:function(b){this.lastScore=b,a(".crop-animate-wrapper .crop").removeClass("valid").css({"-webkit-transform":"translate(0px,-0px)","background-image":"url(./images/icon-corn-disabled.png)"}),H.index.$stage.append(a(".crop-animate-wrapper .crop")[0]),showNewLoading(),getResult("api/lottery/award",{oi:openid,nn:encodeURIComponent(nickname),hi:headimgurl,pv:b},"callbackLotteryAwardHandler"),H.index.$stage.append(a(".crop-animate-wrapper .crop")[0])},show:function(){this.$stage.removeClass("none"),this.$stage.animate({opacity:1},1300,"ease")},updateLotteryCount:function(b){if(a("#stage_index .crop").css("background-image","url(./images/icon-corn-disabled.png)").removeClass("valid"),b.lc>0){this.$play.removeClass("disabled"),this.$play.find("img").attr("src","./images/icon-play.png");for(var c=0;c<b.lc&&a("#stage_index .crop").eq(c).length>0;c++)a("#stage_index .crop").eq(c).css("background-image","url(./images/icon-corn.png)").addClass("valid");a(".again").removeClass("none")}else this.$play.addClass("disabled"),this.$play.find("img").attr("src","./images/icon-play-disabled.png"),a(".again").addClass("back").removeClass("none"),a(".again").css("background-image","url(./images/btn-again-back.png)")},resize:function(){var b=a(window).width(),c=a(window).height(),d=640,e=1009,f=d/b,g=e/c;this.$stages.css({width:b,height:c}),a(".stage-item").each(function(){var b=a(this).attr("data-width")/f,c=a(this).attr("data-height")/g;a(this).css({left:a(this).attr("data-left")/f,top:a(this).attr("data-top")/g,width:b,height:c}),a(this).attr("data-src")&&a(this).css({"background-image":"url("+a(this).attr("data-src")+")","background-size":b+"px "+c+"px"})}),this.$stage.css({"background-image":"url(./images/bg-index.jpg)","background-size":b+"px "+c+"px"}),H.rule.$ruleDialog.find(".content").css("height",.7*c-120-20);var h=H.rank.$rankDialog.find(".dialog").css("height");H.rank.$rankDialog.find(".dialog").css("top",(c-parseInt(h))/2);var h=H.info.$infoDialog.find(".dialog").css("height");H.info.$infoDialog.find(".dialog").css("top",(c-parseInt(h))/2);var i=H.win.$ticket.css("height");H.win.$ticket.css("line-height",i),a("#stage_main").css({width:b,height:c,"background-image":"url(./images/bg-game.jpg)","background-size":b+"px "+c+"px"}),this.show()},bindBtns:function(){this.$play.tap(function(){return a(this).hasClass("disabled")?void alert("今天的游戏次数已经用完啦~"):void H.index.start()}),a(".again").tap(function(){a(this).hasClass("back")?(a("#stage_main").addClass("none"),H.index.show()):H.index.restartGame(),a(this).parent(".dialog-wrapper").addClass("none")})}},H.win={$dialog:a("#win_dialog"),$error:a("#error_dialog"),$ticket:a("#win_dialog .ticket"),$tt:a("#win_dialog .tt"),$pd:a("#win_dialog .pd"),show:function(b){a(".again").addClass("none"),b.tt&&b.pd?(this.$tt.html(b.aw),this.$pd.html(b.pd)):(this.$tt.html("恭喜你，"),this.$pd.html("获得"+b.pn+"1"+b.pu)),this.$ticket.html("兑换码："+b.cc),this.$dialog.removeClass("none"),getResult("api/lottery/leftLotteryCount",{oi:openid},"callbackLotteryleftLotteryCountHandler")},collectError:function(){this.$error.find(".last-scroe").html(H.index.lastScore),this.$error.removeClass("none")},collect:function(a){var b="",c=0;b=a>=100&&199>=a?"100-199":a>=200&&299>=a?"200-299":"300-399";for(var d in H.index.awardList)H.index.awardList[d].tp==b&&(c=d);H.index.awardList[c]?getResult("api/lottery/collect",{oi:openid,pu:H.index.awardList[c].id},"callbackLotteryCollectHandler"):this.collectError()}},H.lost={$dialog:a("#lost_dialog"),show:function(){a(".again").addClass("none"),this.$dialog.removeClass("none"),getResult("api/lottery/leftLotteryCount",{oi:openid},"callbackLotteryleftLotteryCountHandler")}},H.record={$stage:a("#stage_record"),$open:a("#stage_index .record-btn"),$back:a("#stage_record .back-btn"),$list:a("#stage_record .record-list"),init:function(){this.resize(),this.bindBtns()},show:function(){this.$stage.removeClass("none"),this.$stage.animate({opacity:1},1300,"ease"),getResult("api/lottery/record",{oi:openid,pt:11},"callbackLotteryRecordHandler")},fillList:function(a){if(a.result){var b="";for(var c in a.rl){var d=a.rl[c].sa.split(" "),e=a.rl[c].ea.split(" "),f="";f=d[0]&&e[0]?"有效期："+d[0]+" ~ "+e[0]:"",b+="<li><p>"+a.rl[c].pn+'</p><p class="record-code">兑换码：'+a.rl[c].cc+'</p><p class="deadline">'+f+"</p></li>"}this.$list.html(b)}else b='<li class="placehoder"><p>&nbsp;</p><p class="record-code">暂无中奖纪录哦</p></li>',this.$list.html(b)},bindBtns:function(){this.$back.tap(function(){H.record.$stage.addClass("none"),H.record.$stage.css("opacity",0),H.index.show()}),this.$open.tap(function(){H.index.$stage.addClass("none"),H.index.$stage.css("opacity",0),H.record.show()})},resize:function(){this.$stage.css({height:"auto","min-height":a(window).height()})}},H.rule={isLoaded:!1,$ruleDialog:a("#rule_dialog"),$ruleOpen:a("#stage_index .rule"),init:function(){this.$ruleDialog.find(".icon-close").tap(function(){H.rule.hideDialog()}),this.$ruleOpen.tap(function(){H.rule.show()})},show:function(){this.isLoaded?this.showDialog():(showNewLoading(),getResult("api/common/rule",null,"commonApiRuleHandler"))},showDialog:function(){H.rule.$ruleDialog.removeClass("none"),H.rule.$ruleDialog.find(".dialog").addClass("r-rule")},hideDialog:function(){H.rule.$ruleDialog.find(".dialog").addClass("g-rule"),setTimeout(function(){H.rule.$ruleDialog.addClass("none"),H.rule.$ruleDialog.find(".dialog").removeClass("g-rule").removeClass("r-rule")},500)}},H.info={$infoDialog:a("#info_dialog"),$submit:a("#submit"),init:function(){this.$infoDialog.find(".icon-close").tap(function(){
H.info.hideDialog()}),this.$submit.tap(function(){var b=a("#token").val(),c=a.trim(a("#name").val()),d=a.trim(a("#tel").val());return d?/^(13[0-9]|14[0-9]|15[0-9]|18[0-9])\d{8}$/i.test(d)?c.length<=0?void alert("请填写姓名"):void getResult("api/user/edit",{oi:openid,tk:b,nn:encodeURIComponent(nickname),hi:headimgurl,ph:d,rn:encodeURIComponent(c)},"callbackUserEditHandler"):void alert("这个手机号可打不通..."):void alert("手机号码不能为空")}),getResult("api/user/info",{oi:openid},"callbackUserInfoHandler")},show:function(){this.$infoDialog.removeClass("none")},hideDialog:function(){H.info.$infoDialog.find(".dialog").addClass("g-rule"),setTimeout(function(){H.info.$infoDialog.addClass("none"),H.info.$infoDialog.find(".dialog").removeClass("g-rule").removeClass("r-rule")},500)},fillUserData:function(b){a("#token").val(b.tk),a("#name").val(b.rn?b.rn:""),a("#tel").val(b.ph?b.ph:"")}},H.rank={$rankDialog:a("#rank_dialog"),$rankOpen:a("#stage_index .rank-btn"),$avatar:a("#rank_dialog .rank-self-avatar img"),$name:a("#rank_dialog .rank-self-detail h2"),$score:a("#rank_dialog .rank-self-detail .detail-score"),$rank:a("#rank_dialog .rank-self-detail .detail-rank"),$list:a("#rank_dialog .rank-list ul"),$info:a("#rank_dialog .rank-userinfo-btn a"),init:function(){this.$rankDialog.find(".icon-close").tap(function(){H.rank.hideDialog()}),this.$rankOpen.tap(function(){H.rank.show()}),this.$info.tap(function(){H.rank.$rankDialog.addClass("none").removeClass("g-rule").removeClass("r-rule"),H.info.show()})},show:function(){showNewLoading(),getResult("api/lottery/integral/total/rank/self",{oi:openid},"callbackIntegralTotalRankSelfRoundHandler"),getResult("api/lottery/integral/total/rank/top10",{oi:openid},"callbackIntegralTotalRankTop10Handler")},showDialog:function(){H.rank.$rankDialog.removeClass("none"),H.rank.$rankDialog.find(".dialog").addClass("r-rule")},hideDialog:function(){H.rank.$rankDialog.find(".dialog").addClass("g-rule"),setTimeout(function(){H.rank.$rankDialog.addClass("none"),H.rank.$rankDialog.find(".dialog").removeClass("g-rule").removeClass("r-rule")},500)}},W.commonApiRuleHandler=function(a){hideNewLoading(),0==a.code?(H.rule.isLoaded=!0,H.rule.$ruleDialog.find(".content").html(a.rule),H.rule.showDialog()):H.rule.hideDialog()},W.callbackIntegralTotalRankTop10Handler=function(a){if(a.result){var b=simpleTpl();for(var c in a.top10)b._("<li>")._('<span class="list-num">')._(a.top10[c].rk)._("</span>")._('<span class="list-name">')._(a.top10[c].nn?a.top10[c].nn:"匿名用户")._("</span>")._('<span class="list-count">')._(a.top10[c]["in"])._("</span>")._("</li>");H.rank.$list.html(b.toString())}},W.callbackIntegralTotalRankSelfRoundHandler=function(a){hideNewLoading(),a.result&&(H.rank.$avatar.attr("src",headimgurl?headimgurl:"./images/icon-avatar.png"),H.rank.$name.text(nickname),H.rank.$score.text("我的积分："+(a["in"]?a["in"]:0)),H.rank.$rank.text("我的排名："+(a.rk?a.rk:"100+")),H.rank.showDialog())},W.callbackLotteryleftLotteryCountHandler=function(a){a.result&&H.index.updateLotteryCount(a)},W.callbackLotteryPrizesHandler=function(a){a.result?(H.index.initAward(a),getResult("api/lottery/luck",{oi:openid},"callbackLotteryLuckHandler")):(hideNewLoading(),alert("网络错误，请刷新重试"))},W.callbackLotteryLuckHandler=function(a){hideNewLoading(),a.result?H.index.startGame(a.pv):alert("网络错误，请刷新重试")},W.callbackLotteryAwardHandler=function(a){hideNewLoading(),a.result&&H.index.lastScore>99?H.win.collect(H.index.lastScore):H.lost.show()},W.callbackLotteryCollectHandler=function(a){0==a.result?H.win.show(a):H.win.collectError()},W.callbackLotteryRecordHandler=function(a){H.record.fillList(a)},W.callbackUserInfoHandler=function(a){a.result&&H.info.fillUserData(a)},W.callbackUserEditHandler=function(a){a.result?(alert("填写成功！"),H.info.hideDialog()):alert("网络错误，请刷新重试")},H.loading.init()}(Zepto);