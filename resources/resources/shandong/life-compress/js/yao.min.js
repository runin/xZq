!function(a){H.yao={$home_box:a(".home-box"),$audio_a:a("#audio-a"),$textb:a(".textb"),nowTime:null,isCanShake:!1,times:0,isToLottey:!0,lotteryTime:getRandomArbitrary(1,3),yaoBg:[],repeat_load:!0,index:0,pal:[],dec:0,type:2,wxCheck:!1,isError:!1,allRecordTime:Math.ceil(4e3*Math.random()+1e3),PVTime:Math.ceil(2e4*Math.random()+1e4),first:!0,canJump:!0,isTimeOver:!1,init:function(){var a=this;a.event(),a.current_time(),a.shake(),a.refreshDec(),a.jump()},refreshDec:function(){var a=Math.ceil(3e5*Math.random()+18e4);setInterval(function(){getResult({url:"api/common/time",loading:!1,jsonpCallback:"commonApiTimeHandler",timeout:11e3,success:function(a){if(a.t){var b=(new Date).getTime();H.yao.dec=b-a.t}}})},a)},event:function(){var b=H.yao;a("#test").click(function(a){a.preventDefault(),b.wxCheck=!0,b.lotteryTime=1,b.shake_listener()}),a(".back-btn").click(function(c){c.preventDefault(),b.btn_animate(a(this)),toUrl("index.html")})},jump:function(){getResult({url:"api/common/promotion",data:{oi:openid},jsonpCallback:"commonApiPromotionHandler",success:function(b){0==b.code&&b.desc&&b.url?(a(".ddtj").text(b.desc||""),a("#ddtj").click(function(){showLoading(),location.href=b.url}),a("#ddtj").removeClass("visibility")):a("#ddtj").remove()}})},account_num:function(){getResult({url:"api/common/servicedaypv",jsonpCallback:"commonApiSDPVHander",success:function(b){0==b.code&&(a(".count label").html(b.c),a(".count").removeClass("hidden"),setInterval(function(){var b=getRandomArbitrary(33,99);b=1*a(".count label").html()+b,a(".count label").html(b)},3e3))}})},initCount:function(){setTimeout(function(){H.yao.account_num()},this.PVTime)},shake:function(){W.addEventListener("shake",H.yao.shake_listener,!1)},imgMath:function(){var b=H.yao;if(b.yaoBg.length>0){var c=Math.floor(Math.random()*b.yaoBg.length);a("body").css("backgroundImage","url('"+b.yaoBg[c]+"')")}},shake_listener:function(){var b=H.yao;b.isCanShake&&(b.isCanShake=!1,2==b.type&&(b.times++,b.times%b.lotteryTime!=0&&(b.isToLottey=!1),b.$home_box.hasClass("yao")||(b.$audio_a.get(0).play(),b.canJump=!1,b.imgMath(),a(".m-t-b").css({"-webkit-transition":"-webkit-transform .2s ease","-webkit-transform":"translate(0px,-100px)"}),a(".m-f-b").css({"-webkit-transition":"-webkit-transform .2s ease","-webkit-transform":"translate(0px,100px)"}),setTimeout(function(){b.canJump=!0,a(".m-t-b").css({"-webkit-transform":"translate(0px,0px)","-webkit-transition":"-webkit-transform .5s ease"}),a(".m-f-b").css({"-webkit-transform":"translate(0px,0px)","-webkit-transition":"-webkit-transform .5s ease"})},1200),b.$home_box.addClass("yao")),recordUserOperate(openid,"摇奖","shakeLottery"),recordUserPage(openid,"摇奖",0),openid&&"null"!=openid&&0!=b.isToLottey?setTimeout(function(){b.drawlottery()},1500):setTimeout(function(){b.fill(null)},1500),b.isToLottey=!0))},current_time:function(){var a=H.yao;getResult({url:"api/lottery/round",loading:!0,jsonpCallback:"callbackLotteryRoundHandler",timeout:11e3,success:function(b){if(1==b.result){a.nowTime=timeTransform(b.sctm);var c=(new Date).getTime(),d=b.sctm;a.dec=c-d,a.currentPrizeAct(b)}else a.repeat_load?(a.repeat_load=!1,setTimeout(function(){a.current_time()},500)):(a.wxCheck=!1,a.isToLottey=!1)},error:function(b,c){a.wxCheck=!1,a.isToLottey=!1}})},downloadImg:function(){for(var b=simpleTpl(),c=H.yao,d=0;d<c.yaoBg.length;d++)b._('<img src="'+c.yaoBg[d]+'" style="width:0px;heigth:0px;">');a("body").append(b.toString())},currentPrizeAct:function(b){var c=b.la,d=0,e=H.yao.nowTime,f=(a(".time-tips"),[]),g=H.yao,h=e.split(" ")[0];if(c&&c.length>0)for(var i=0;i<c.length;i++)c[i].pd==h&&f.push(c[i]);if(g.pal=f,d=f.length,!(f.length>0))return void g.change();if(comptime(f[d-1].pd+" "+f[d-1].et,e)>=0)return g.type=3,void g.change();if(comptime(f[0].pd+" "+f[0].st,e)<0)return void g.beforeShowCountdown(f[0]);g.wxConfig();for(var i=0;i<f.length;i++){var j=f[i].pd+" "+f[i].st,k=f[i].pd+" "+f[i].et;if(g.index=i,hidenewLoading(),comptime(e,j)<0&&comptime(e,k)>=0)return g.initCount(),f[i].bi.length>0&&(g.yaoBg=f[i].bi.split(",")),void g.nowCountdown(f[i]);if(comptime(e,j)>0)return void g.beforeShowCountdown(f[i])}},beforeShowCountdown:function(b){var c=H.yao,d=b.pd+" "+b.st;c.type=1,a(".items-count").addClass("none"),a(".loading").removeClass("none"),c.countdown_domShow(d,"距摇奖开启还有")},nowCountdown:function(a){var b=H.yao,c=a.pd+" "+a.et;b.type=2,b.countdown_domShow(c,"距摇奖结束还有"),b.index++,b.isCanShake=!0},countdown_domShow:function(b,c){var d=H.yao,e=timestamp(b);e+=d.dec,a(".detail-countdown").attr("etime",e),a(".countdown-tip").html(c),d.count_down(),a(".items-count").removeClass("none"),a(".loading").addClass("none"),a(".countdown").removeClass("none"),d.isTimeOver=!1},count_down:function(){a(".detail-countdown").each(function(){var b=H.yao;a(this).countDown({etpl:'%H%<label class="dian">:</label>%M%<label class="dian">:</label>%S%<label class="dian"></label>',stpl:'%H%<label class="dian">:</label>%M%<label class="dian">:</label>%S%<label class="dian"></label>',sdtpl:"",otpl:"",otCallback:function(){var c=a(".loading"),d=a(".items-count");if(b.canJump){if(!b.isTimeOver)if(b.isTimeOver=!0,d.addClass("none"),c.removeClass("none"),1==b.type)b.nowCountdown(b.pal[b.index]);else if(2==b.type){if(b.isCanShake=!1,b.index>=b.pal.length)return b.change(),void(b.type=3);b.beforeShowCountdown(b.pal[b.index])}}else d.addClass("none"),c.removeClass("none")},sdCallback:function(){b.isTimeOver=!1}})})},change:function(){var b=H.yao;a(".items-count").addClass("none"),a(".loading").removeClass("none"),a(".countdown").removeClass("none").html("本期摇奖已结束，请等待下期!"),b.$textb.addClass("visibility"),toUrl("end.html")},drawlottery:function(){recordUserOperate(openid,"调用抽奖接口","doLottery");var a=H.yao,b=(new Date).getTime()+"";a.lotteryTime=getRandomArbitrary(1,3),a.times=0,a.isCanShake=!1,getResult({url:"api/lottery/exec/luck",data:{matk:matk,sn:b},jsonpCallback:"callbackLotteryLuckHandler",timeout:11e3,complete:function(){b=(new Date).getTime()+""},success:function(c){return c.flow&&1==c.flow?(a.lotteryTime=getRandomArbitrary(3,6),a.times=0,b=(new Date).getTime()+"",void a.fill(null)):void(c.result&&c.sn==b?a.fill(c):a.fill(null))},error:function(){a.fill(null)}})},fill:function(b){var c=H.yao;if(c.$home_box.removeClass("yao"),null==b||0==b.result||0==b.pt)return c.$audio_a.get(0).pause(),void c.not_winning(b);c.$audio_a.get(0).pause(),a("#audio-b").get(0).play();var d=H.dialog;switch(b.pt){case 1:d.swLottery.open(b);break;case 4:d.redLottery.open(b);break;case 7:d.kjLottery.open(b);break;case 9:d.wlLottery.open(b);break;default:c.not_winning()}},not_winning:function(b){var c=H.yao;if(c.canJump=!0,c.isCanShake=!0,"undefined"==typeof thanks_tips||0==thanks_tips.length)var d="不纯不抢，继续来战，加油吧~";else var d=thanks_tips[getRandomArbitrary(0,thanks_tips.length)];a(".thanks-tips").html(d).addClass("show"),setTimeout(function(){a(".thanks-tips").removeClass("show"),setTimeout(function(){a(".thanks-tips").empty()},300)},1300)},btn_animate:function(a){a.addClass("flipInY"),setTimeout(function(){a.removeClass("flipInY")},200)},wxConfig:function(){getResult({url:"mp/jsapiticket",data:{appId:shaketv_appid},jsonpCallback:"callbackJsapiTicketHandler",timeout:15e3,success:function(a){if(0==a.code){var b=window.location.href.split("#")[0],c="df51d5cc9bc24d5e86d4ff92a9507361",d=Math.round((new Date).getTime()/1e3),e=hex_sha1("jsapi_ticket="+a.ticket+"&noncestr="+c+"&timestamp="+d+"&url="+b);wx.config({debug:!1,appId:shaketv_appid,timestamp:d,nonceStr:c,signature:e,jsApiList:["addCard","checkJsApi"]})}},error:function(){}})}}}(Zepto),$(function(){H.yao.init();var a=H.yao;wx.ready(function(){wx.checkJsApi({jsApiList:["addCard"],success:function(b){var c=b.checkResult.addCard;c&&!a.isError&&(a.wxCheck=!0)}})}),wx.error(function(b){a.isError=!0})});