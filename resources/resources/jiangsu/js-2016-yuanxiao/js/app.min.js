!function(a){a.fn.tmpl=function(b){var c=a(this[0]).html().trim();if(b)for(k in b)c=c.replace(new RegExp("\\${"+k+"}","g"),b[k]);return c}}(Zepto);var str2date=function(a){return a=a.replace(/-/g,"/"),new Date(a)},timestamp=function(a){return str2date(a).getTime()},dateformat=function(date,format){var z={M:date.getMonth()+1,d:date.getDate(),h:date.getHours(),m:date.getMinutes(),s:date.getSeconds()};return format=format.replace(/(M+|d+|h+|m+|s+)/g,function(v){return((v.length>1?"0":"")+eval("z."+v.slice(-1))).slice(-2)}),format.replace(/(y+)/g,function(a){return date.getFullYear().toString().slice(-a.length)})},showTime=function(a,b){var c=Math.round(a%6e4/100);c=subNum(dateNum(Math.round(c/1e3*100)));var d=subNum(dateNum(Math.floor(a%36e5/6e4))),e=subNum(dateNum(Math.floor(a%864e5/36e5))),f=subNum(dateNum(Math.floor(a/864e5)));return b.replace(/%S%/,c).replace(/%M%/,d).replace(/%H%/,e).replace(/%D%/,f)},subNum=function(a){return numF=a.toString().substring(0,1),numS=a.toString().substring(1,a.length),a="<label>"+numF+"</label><label>"+numS+"</label>"},dateNum=function(a){return 10>a?"0"+a:a},preloadimages=function(a){function b(){d++,d==a.length&&e(c)}for(var c=[],d=0,e=function(){},a="object"!=typeof a?[a]:a,f=0;f<a.length;f++)c[f]=new Image,c[f].src=a[f],c[f].onload=function(){b()},c[f].onerror=function(){b()};return{done:function(a){e=a||e}}},xssEscape=function(a){return a=a.replace("&","&amp;"),a=a.replace("<","&lt;"),a=a.replace(">","&gt;"),a=a.replace('"',"&quot;")};!function(a){H.loader={$loadingBar:a("#loading_bar"),init:function(){this.resize(),a.html5Loader({stopExecution:!0,filesToLoad:"./js/files-tmp.js",onUpdate:function(a){},onComplete:function(){H.loader.$loadingBar.text(""),H.loader.finish()}})},finish:function(){setTimeout(function(){H.router.init()},2500)},resize:function(){var b=a(window).width(),c=a(window).height();a("#cover .cover-top").css({width:b,height:.5*c,"background-size":b+"px "+.5*c+"px"}),a("#cover .cover-bottom").css({width:b,height:.5*c+1,"background-size":b+"px "+(.5*c+1)+"px"}),a("#page_wrapper").css({width:2*b}),a("#index").css({width:b,height:c,"background-size":b+"px "+c+"px"}),a("#yao").css({width:b,height:c}),a("#cover").removeClass("none"),a(".my-avatar").attr("src",headimgurl),a(".my-nickname").text(nickname?nickname:"匿名"),a(".can-tap").bind("touchstart",function(){a(this).addClass("taped")}),a(".can-tap").bind("touchend",function(){a(this).removeClass("taped")})}},a(function(){H.loader.init()})}(Zepto),function(a){H.router={curUrl:"cover",curSlide:"index",init:function(){H.index.resize(),H.card.init();var a=getQueryString("send");a?H.cardAccept.init():H.countdown.init()},slideTo:function(b){H.router.curSlide=b;var c=a(window).width();return"yao"==b?(a(".page-wrapper").css({"-webkit-transform":"translate("+-1*c+"px, 0px)"}),a("#comment_input").attr("disabled","disabled"),a(".guide").addClass("none")):"index"==b&&(a(".page-wrapper").css({"-webkit-transform":"translate(0px, 0px)"}),setTimeout(function(){a("#comment_input").removeAttr("disabled");var b=localStorage.getItem(openid+LS_KEY_GUIDE);b||a("#guide_unlock").removeClass("none")},1e3)),!1}}}(Zepto),function(a){H.countdown={timeOffset:0,roundData:null,currentRound:0,interval:null,intervalStart:0,intervalEnd:0,allBeginTime:0,curPercent:0,isSliding:!1,isFirstRounding:!0,isYaoActive:!1,serverOffset:0,$barCountdown:a("#bar_countdown .bar-blink-wrapper"),$barBlink:a("#bar_countdown .bar-blink"),$timeLeft:a("#tips_timeleft"),$yaoHour:a("#yao_countdown_hour"),$yaoHour2:a("#yao_countdown_hour2"),$yaoMin:a("#yao_countdown_min"),$yaoMin2:a("#yao_countdown_min2"),$yaoSec:a("#yao_countdown_sec"),$yaoSec2:a("#yao_countdown_sec2"),$btnYao:a("#btn_yao"),$indexBar:a("#index .index-countdown"),init:function(){H.index.init(),getResult("api/common/time",null,"commonApiTimeHandler",null,null,null,15e3,function(){a("#cover").addClass("none"),a(".page-wrapper").removeClass("none"),H.guide.init(),H.countdown.end(),a(".bar-tips-dialog p").text("距下轮摇奖开始还有5分钟")})},initCountDown:function(b){var c=new Date;this.timeOffset=b.sctm-c.getTime(),this.roundData=b.la,this.currentRound=this.getCurrentRound(),this.currentRound>=0?this.updateCountDown():this.end(),a.isFunction(W.roundLoaded)&&W.roundLoaded()},updateCountDown:function(){var b=this.roundData[this.currentRound].pd+" "+this.roundData[this.currentRound].st,c=this.roundData[this.currentRound].pd+" "+this.roundData[this.currentRound].et;this.intervalStart=timestamp(b),this.intervalEnd=timestamp(c),clearInterval(this.interval),this.interval=setInterval(function(){var b=(new Date).getTime()+H.countdown.timeOffset,c=isNaN(H.countdown.intervalStart)?0:H.countdown.intervalStart-b,d=isNaN(H.countdown.intervalEnd)?0:H.countdown.intervalEnd-b;if(c>=0){if(H.countdown.currentRound<=0)var e=6e5;else var e=H.countdown.intervalStart-timestamp(H.countdown.roundData[H.countdown.currentRound-1].pd+" "+H.countdown.roundData[H.countdown.currentRound-1].et);a.isFunction(W.roundToStart)&&W.roundToStart(c,e)}else d>=0?a.isFunction(W.rounding)&&W.rounding(d):H.countdown.startNextRound()},100)},startNextRound:function(){return this.currentRound++,this.currentRound>=this.roundData.length?void this.end():void this.updateCountDown()},getCurrentRound:function(){var a=(new Date).getTime()+this.timeOffset;for(var b in this.roundData){var c=this.roundData[b].pd+" "+this.roundData[b].et;if(a<timestamp(c))return b}return-1},end:function(){a.isFunction(W.roundAllEnd)&&W.roundAllEnd()},showYaoTime:function(a){var b=Math.round(a%6e4/100);b=dateNum(Math.round(b/1e3*100)).toString();var c=dateNum(Math.floor(a%36e5/6e4)).toString(),d=dateNum(Math.floor(a%864e5/36e5)).toString();dateNum(Math.floor(a/864e5)).toString();"60"==b&&(b="59"),H.countdown.$yaoHour.text(d.substring(0,1)),H.countdown.$yaoHour2.text(d.substring(1,d.length)),H.countdown.$yaoMin.text(c.substring(0,1)),H.countdown.$yaoMin2.text(c.substring(1,c.length)),H.countdown.$yaoSec.text(b.substring(0,1)),H.countdown.$yaoSec2.text(b.substring(1,b.length))}},W.commonApiTimeHandler=function(b){H.countdown.serverOffset=(new Date).getTime()-b.t,a("#cover").addClass("none"),a(".page-wrapper").removeClass("none"),H.guide.init()},W.callbackLotteryRoundHandler=function(a){1==a.result?H.countdown.initCountDown(a):H.countdown.end()},W.roundLoaded=function(){H.countdown.isYaoActive=!1,H.yao.init()},W.roundToStart=function(a,b){if(H.countdown.isYaoActive=!1,H.countdown.isFirstRounding=!0,"yao"==H.router.curSlide&&(H.router.slideTo("index"),H.countdown.$barCountdown.css({width:"8%"})),a>b)var c=0;else var c=(b-a)/b;c+=.01,c-H.countdown.curPercent>.05&&(.08>c&&(c=.08),c>1&&(c=1),H.countdown.curPercent=c,H.countdown.$barCountdown.css({width:100*H.countdown.curPercent+"%"}),c>.96?H.countdown.$barBlink.addClass("none"):H.countdown.$barBlink.removeClass("none")),H.countdown.$timeLeft.html(showTime(a,"%H%:%M%:%S%")),H.countdown.$btnYao.removeClass("dh-wobble"),H.countdown.$indexBar.removeClass("active")},W.rounding=function(a){H.countdown.isYaoActive=!0,"index"==H.router.curSlide&&H.countdown.isFirstRounding&&(H.countdown.isFirstRounding=!1,H.router.slideTo("yao")),H.countdown.$barCountdown.css({width:"100%"}),H.countdown.$barBlink.addClass("none"),H.countdown.curPercent=0,H.countdown.showYaoTime(a),H.countdown.$btnYao.addClass("dh-wobble"),H.countdown.$indexBar.addClass("active")},W.roundAllEnd=function(){H.countdown.isYaoActive=!1,H.index.$countDownTips.find(".bar-tips-dialog p").html("本期抽奖已经全部结束了"),"yao"==H.router.curSlide&&(H.router.slideTo("index"),H.countdown.$barCountdown.css({width:"8%"})),H.countdown.$btnYao.removeClass("dh-wobble"),H.countdown.$indexBar.removeClass("active")}}(Zepto),function(a){H.guide={$guides:a(".guide"),$guide1:a("#guide_unlock"),$unlock:a("#guide_unlock .icon"),$unlockTips:a("#guide_unlock .tips"),unlockWidth:0,unlockHeight:0,unlockLeft:0,unlockTop:0,$guide2:a("#guide_vip"),$door:a("#guide_vip .icon"),$doorTips:a("#guide_vip .tips"),doorWidth:0,doorHeight:0,doorLeft:0,doorTop:0,$guide3:a("#guide_countdown"),$countdown:a("#guide_countdown .icon"),$countdownTips:a("#guide_countdown .tips"),countDownWidth:0,countDownHeight:0,countDownLeft:0,countDownTop:0,init:function(){var a=localStorage.getItem(openid+LS_KEY_GUIDE);a?H.welcome.init():(H.guide.show(),H.guide.bindBtns())},show:function(){H.guide.$guide1.removeClass("none")},bindBtns:function(){H.guide.$guide1.tap(function(){a(this).addClass("none"),H.guide.$guide2.removeClass("none")}),H.guide.$guide2.tap(function(){a(this).addClass("none"),H.guide.$guide3.removeClass("none")}),H.guide.$guide3.tap(function(){a(this).addClass("none"),localStorage.setItem(openid+LS_KEY_GUIDE,!0),H.welcome.init()})},resize:function(){var b=a(window).height();H.guide.$door.css({width:H.guide.doorWidth,height:H.guide.doorHeight,left:H.guide.doorLeft,top:H.guide.doorTop}),H.guide.$doorTips.css({top:H.guide.doorTop}),H.guide.$countdown.css({width:H.guide.countDownWidth,height:H.guide.countDownHeight,left:H.guide.countDownLeft,top:H.guide.countDownTop-.02*b}),H.guide.$countdownTips.css({top:H.guide.countDownTop+H.guide.countDownHeight}),H.guide.$unlock.css({width:H.guide.unlockWidth,height:H.guide.unlockHeight,left:H.guide.unlockLeft,top:H.guide.unlockTop}),H.guide.$unlockTips.css({top:H.guide.unlockTop+H.guide.unlockHeight-30})}}}(Zepto),function(a){H.welcome={$dialogWrapper:a("#welcome_dialog"),$dialog:a("#welcome_dialog .dialog"),$bg:a("#welcome_dialog .welcome-dialog-bg"),$btnOk:a("#welcome_dialog .welcome-btn"),fanStep:0,init:function(){H.welcome.resize(),H.welcome.bindBtn();var a=localStorage.getItem(openid+LS_KEY_FIRST_VISIT_PV_PREFIX);a?H.welcome.allBeigin():getResult("api/common/servicepv",null,"commonApiSPVHander")},allBeigin:function(){H.welcome.initShare(),H.card.beginCountdown(),H.zhibo.init(),getResult("api/lottery/round",{},"callbackLotteryRoundHandler",null,null,null,15e3,function(){H.countdown.end(),a(".bar-tips-dialog p").text("距下轮摇奖开始还有5分钟")})},openFan:function(){H.welcome.fanStep+1<8&&(a("#welcome_dialog .welcome-fan").removeClass("s"+H.welcome.fanStep),H.welcome.fanStep++,a("#welcome_dialog .welcome-fan").addClass("s"+H.welcome.fanStep),setTimeout(function(){H.welcome.openFan()},100))},initShare:function(){var a=localStorage.getItem(openid+LS_KEY_FIRST_VISIT_PV_PREFIX);H.share.commonShare(a)},bindBtn:function(){H.welcome.$btnOk.tap(function(){H.welcome.$dialog.removeClass("bounceInDown").addClass("bounceOutUp"),H.welcome.$bg.removeClass("bounceInDown").addClass("bounceOutUp"),setTimeout(function(){H.welcome.$dialogWrapper.addClass("none"),H.welcome.$bg.removeClass("bounceOutUp"),H.welcome.$dialog.removeClass("bounceOutUp"),H.welcome.allBeigin()},500)})},show:function(b){b.c>=0&&(localStorage.setItem(openid+LS_KEY_FIRST_VISIT_PV_PREFIX,b.c),a("#welcome_dialog .gold").text(b.c),H.welcome.$dialogWrapper.removeClass("none"),H.welcome.$dialog.addClass("transparent"),H.welcome.$bg.addClass("transparent"),setTimeout(function(){H.welcome.$dialog.removeClass("transparent"),H.welcome.$dialog.addClass("bounceInDown"),H.welcome.$bg.removeClass("transparent"),H.welcome.$bg.addClass("bounceInDown")},100),H.welcome.initShare())},resize:function(){var b=a(window).width(),c=a(window).height(),d=640/730,e=640/606,f=640/723,g=723/88,h=640/425,i=640/259,j=640/238,k=640/69,l=723/595,m=b/e,n=b/f,o=b/h,p=b/i,q=b/j,r=b/k;a("#welcome_dialog .dialog").css({width:m,height:n,"background-size":m+"px "+n+"px",top:(c-n/d)/2}),a("#welcome_dialog .welcome-dialog-bg").css({top:(c-n/d)/2,width:m,height:n/2,"background-size":m+"px "+n/2+"px"}),a("#welcome_dialog .welcome-fan").css({width:o,height:p,top:n/g,left:(b-o)/2,"background-size":o+"px "+p+"px"}),a("#welcome_dialog .welcome-btn").css({width:q,height:r,top:n/l,left:(b-q)/2,"background-size":q+"px "+r+"px"});var s=n/g+p,t=n/l-s;a("#welcome_dialog .welcome-text").css({width:o,height:t,top:s,left:(b-o)/2,"padding-top":(t-42)/2})}},W.commonApiSPVHander=function(a){0==a.code&&H.welcome.show(a)}}(Zepto),function(a){H.cardSend={$dialogWrapper:a("#card_send_dialog"),$dialog:a("#card_send_dialog .dialog"),$btnClose:a("#card_send_dialog .btn-close"),$btnSend:a("#card_send_btn"),$guide:a("#card_send_guide"),$video:a("#card_send_dialog .video-wrapper"),$didi:a("#card_send_dialog .card-gift"),$switcher:a("#card_send_dialog .card-record-switcher"),$voiceInput:a("#card_send_dialog .card-voice-input"),$textInput:a("#card_send_dialog .card-input"),$input:a("#card_send_dialog .card-input input"),$preview:a("#card_send_dialog .card-voice-preview"),$reset:a("#card_send_dialog .card-record-reset"),cardData:null,curType:"text",recordBegin:0,lastDuration:0,curServerId:0,init:function(){this.bindBtns()},show:function(a){H.cardSend.cardData=a,H.cardSend.$dialogWrapper.removeClass("none"),H.cardSend.$dialog.addClass("transparent"),setTimeout(function(){H.cardSend.$dialog.removeClass("transparent"),H.cardSend.$dialog.addClass("scaleIn")},100),H.card.initVideoEvents(a.cd,a.ulli,H.cardSend.$video)},bindBtns:function(){H.cardSend.$btnClose.tap(function(){H.share.commonShare(),H.cardSend.$dialog.removeClass("scaleIn").addClass("scaleOut"),setTimeout(function(){H.card.closeVideo(H.cardSend.$video),H.cardSend.reset(),H.cardSend.$dialogWrapper.addClass("none"),H.cardSend.$dialog.removeClass("scaleOut")},400)}),H.cardSend.$btnSend.tap(function(){if("voice"==H.cardSend.curType){if(0==H.cardSend.curServerId)return showTips("请说出您的祝福^ ^"),!1;showLoading(null,"贺卡制作中"),H.share.cardShare(H.cardSend.cardData.cd,H.cardSend.cardData.ulli,null,H.cardSend.curServerId,H.cardSend.cardData.ct,Math.ceil(H.cardSend.lastDuration/1e3)),setTimeout(function(){hideLoading(),H.cardSend.done(),getResult("api/greetingcard/make",{oi:openid,mu:H.cardSend.cardData.ud,vi:H.cardSend.curServerId,vd:Math.ceil(H.cardSend.lastDuration/1e3),gt:null,nn:nickname,hi:headimgurl},"callbackGreetingcardMakeHandler")},1e3)}else{var b=a.trim(H.cardSend.$input.val());if(0==b.length)return showTips("请写下您的祝福^ ^"),!1;if(b.length>100)return showTips("祝福请不要太长哦，贺卡塞不下啦^ ^"),!1;showLoading(null,"贺卡制作中"),H.share.cardShare(H.cardSend.cardData.cd,H.cardSend.cardData.ulli,b,null,H.cardSend.cardData.ct,null),setTimeout(function(){hideLoading(),H.cardSend.done(),getResult("api/greetingcard/make",{oi:openid,mu:H.cardSend.cardData.ud,vi:null,gt:b,nn:nickname,hi:headimgurl},"callbackGreetingcardMakeHandler")},1e3)}}),H.cardSend.$guide.tap(function(){a(this).addClass("none"),a("#card_send_guide .cloud-wrapper .cloud-text").addClass("none").removeClass("fadeIn")}),H.cardSend.$switcher.tap(function(){a(this).hasClass("active")?(H.cardSend.curType="text",a(this).removeClass("active"),a(this).find("img").attr("src","./images/icon-record.png"),H.cardSend.$voiceInput.addClass("none"),H.cardSend.$textInput.removeClass("none")):(H.cardSend.curType="voice",a(this).addClass("active"),a(this).find("img").attr("src","./images/icon-keyboard.png"),H.cardSend.$voiceInput.removeClass("none"),H.cardSend.$textInput.addClass("none"))}),H.cardSend.$voiceInput.bind("touchstart",function(){return a(this).addClass("recording"),H.cardSend.recordBegin=(new Date).getTime(),H.voice.$tips.removeClass("none"),wx.startRecord(),!1}),H.cardSend.$voiceInput.bind("touchend",function(){return a(this).removeClass("recording"),H.voice.$tips.addClass("none"),wx.stopRecord({success:function(a){H.cardSend.lastDuration=(new Date).getTime()-H.cardSend.recordBegin,H.cardSend.uploadVoice(a.localId)}}),!1}),H.cardSend.$preview.tap(function(){var b=a(this).attr("data-vid");H.voice.playVoice(b)}),H.cardSend.$reset.tap(function(){return H.cardSend.reset(),!1})},reset:function(){H.cardSend.$textInput.addClass("none"),H.cardSend.$voiceInput.removeClass("none"),H.cardSend.$preview.addClass("none"),H.cardSend.$switcher.find("img").attr("src","./images/icon-keyboard.png"),H.cardSend.$switcher.removeClass("none").addClass("active"),H.cardSend.$input.val("")},uploadVoice:function(a){wx.uploadVoice({localId:a,isShowProgressTips:1,success:function(a){H.cardSend.curServerId=a.serverId,H.cardSend.previewVoice(a.serverId)}})},previewVoice:function(a){H.cardSend.$voiceInput.addClass("none"),H.cardSend.$switcher.addClass("none"),H.cardSend.$preview.removeClass("none"),H.cardSend.$preview.find(".comment-duration").html(Math.ceil(H.cardSend.lastDuration/1e3)+'"'),H.cardSend.$preview.attr("data-vid",a)},done:function(b){a("#card_send_guide").removeClass("none"),a("#card_send_guide .cloud-wrapper").addClass("floating"),setTimeout(function(){a("#card_send_guide .cloud-wrapper .cloud-text").removeClass("none").addClass("fadeIn")},400)},resize:function(b){var c=740/864,d=71/864;a("#card_send_dialog .card-send-btn").css({top:b*c,height:b*d})}},W.callbackGreetingcardMakeHandler=function(a){},H.cardSend.init()}(Zepto),function(a){H.cardAccept={$dialogWrapper:a("#card_accept_dialog"),$dialog:a("#card_accept_dialog .dialog"),$video:a("#card_accept_dialog .video-wrapper"),$didi:a("#card_accept_dialog .card-gift"),$voice:a("#card_accept_dialog .card-voice-preview"),$text:a("#card_accept_dialog .card-text p"),$ok:a("#card_accept_dialog .card-send-btn"),$header:a("#card_accept_dialog .headerimg"),$nickname:a("#card_accept_dialog .nickname"),$bigText:a("#card_accept_dialog .text-show"),$more:a("#card_accept_dialog .card-text-more"),$duration:a("#card_accept_dialog .comment-duration"),cardData:null,didiData:null,init:function(){this.bindBtns();var a=getQueryString("send");if(a){var b=localStorage.getItem(openid+LS_KEY_DIDI);b?H.cardAccept.fill():getResult("api/lottery/luck4Collect",{oi:openid},"callbackLotteryLuck4CollectHandler",null,null,null,15e3,function(){H.cardAccept.fill()})}},fill:function(){var b=localStorage.getItem("last_nn"),c=localStorage.getItem("last_hd"),d=localStorage.getItem("last_vi"),e=localStorage.getItem("last_co"),f=localStorage.getItem("last_te"),g=localStorage.getItem("last_voi"),h=getQueryString("du");localStorage.removeItem("last_nn"),localStorage.removeItem("last_hd"),localStorage.removeItem("last_vi"),localStorage.removeItem("last_co"),localStorage.removeItem("last_te"),localStorage.removeItem("last_voi");H.cardAccept.cardData;H.cardAccept.$header.attr("src",c),H.cardAccept.$nickname.text(b?xssEscape(decodeURIComponent(b)):"匿名"),H.cardAccept.$duration.text(h?h+'"':""),H.card.initVideoEvents(d,e,H.cardAccept.$video),g?(H.cardAccept.$voice.attr("data-vid",g).removeClass("none"),H.cardAccept.$voice.tap(function(){var b=a(this).attr("data-vid");H.voice.playVoice(b)})):(H.cardAccept.$text.text(xssEscape(decodeURIComponent(f))),a("#card_accept_dialog .card-text-wrapper").removeClass("none")),H.cardAccept.show()},initDidi:function(a){H.cardAccept.$ok.find("img").attr("src","./images/btn-didi.png"),H.cardAccept.$ok.addClass("didi")},show:function(){H.cardAccept.$dialogWrapper.removeClass("none"),H.cardAccept.$dialog.addClass("transparent"),setTimeout(function(){H.cardAccept.$dialog.removeClass("transparent"),H.cardAccept.$dialog.addClass("bounceInDown")},100)},didiDone:function(){H.cardAccept.$ok.find("img").attr("src","./images/btn-join.png"),H.cardAccept.$ok.removeClass("didi"),localStorage.setItem(openid+LS_KEY_DIDI,!0)},bindBtns:function(){H.cardAccept.$ok.tap(function(){if(a(this).hasClass("didi")){var b=H.cardAccept.didiData;b.pi="./images/default-didi.jpg",b.pd="didi",H.award.show(b,"accept")}else H.cardAccept.$dialog.removeClass("bounceInDown").addClass("bounceOutUp"),setTimeout(function(){H.card.closeVideo(H.cardAccept.$video),H.cardAccept.$dialogWrapper.addClass("none"),H.cardAccept.$dialog.removeClass("bounceOutUp"),H.countdown.init()},500)}),H.cardAccept.$text.tap(function(){H.cardAccept.$bigText.hasClass("none")?(H.cardAccept.$more.addClass("rotate"),H.cardAccept.$bigText.removeClass("none")):(H.cardAccept.$more.removeClass("rotate"),H.cardAccept.$bigText.addClass("none"))}),H.cardAccept.$more.tap(function(){H.cardAccept.$bigText.hasClass("none")?(H.cardAccept.$more.addClass("rotate"),H.cardAccept.$bigText.removeClass("none")):(H.cardAccept.$more.removeClass("rotate"),H.cardAccept.$bigText.addClass("none"))})},resize:function(b){var c=740/864,d=71/864,e=.27;a("#card_accept_dialog .card-send-btn").css({top:b*c,height:b*d}),H.cardAccept.$bigText.css({"max-height":b*e})}},W.callbackLotteryLuck4CollectHandler=function(a){a.result&&(H.cardAccept.didiData=a,H.cardAccept.initDidi()),H.cardAccept.fill()}}(Zepto),function(a){H.cardView={$dialogBigWrapper:a("#card_view_dialog_big"),$dialogSmallWrapper:a("#card_view_dialog_small"),$dialogBig:a("#card_view_dialog_big .dialog"),$dialogSmall:a("#card_view_dialog_small .dialog"),$videoSmall:a("#card_view_dialog_small .video-wrapper"),$videoBig:a("#card_view_dialog_big .video-wrapper"),$titleBig:a("#card_view_dialog_big .card-title"),$actorBig:a("#card_view_dialog_big .card-text"),$friendLi:a("#card_view_dialog_big .card-friend-list ul li img"),$actorSmall:a("#card_view_dialog_small .card-text"),$titleSmall:a("#card_view_dialog_small .card-title"),$btnBigClose:a("#card_view_dialog_big .btn-close"),$btnSmallClose:a("#card_view_dialog_small .btn-close"),$btnMakeBig:a("#card_big_make_btn"),$btnMakeSmall:a("#card_small_make_btn"),cardData:null,init:function(){this.bindBtns()},show:function(a){if(H.cardView.cardData=a,a.fl){for(var b in a.fl)H.cardView.$friendLi.eq(b).attr("src",a.fl[b].hi?a.fl[b].hi:"./images/avatar.jpg");H.cardView.$titleBig.text(a.tt),H.cardView.$actorBig.text(a.ct),H.cardView.$dialogBigWrapper.removeClass("none"),H.cardView.$dialogBig.addClass("transparent"),setTimeout(function(){H.cardView.$dialogBig.removeClass("transparent");var a=H.card.getTapIndex(H.card.lastX,H.card.lastY);H.cardView.$dialogBig.playKeyframe({name:"bigcard-"+a+"-open",duration:300,timingFunction:"ease",complete:function(){}})},100),H.card.initVideoEvents(a.cd,a.ulli,H.cardView.$videoBig)}else H.cardView.$titleSmall.text(a.tt),H.cardView.$actorSmall.text(a.ct),H.cardView.$dialogSmallWrapper.removeClass("none"),H.cardView.$dialogSmall.addClass("transparent"),setTimeout(function(){H.cardView.$dialogSmall.removeClass("transparent");var a=H.card.getTapIndex(H.card.lastX,H.card.lastY);H.cardView.$dialogSmall.playKeyframe({name:"smallcard-"+a+"-open",duration:300,timingFunction:"ease",complete:function(){}})},100),H.card.initVideoEvents(a.cd,a.ulli,H.cardView.$videoSmall)},showLiukong:function(a){H.cardView.show(H.card.cardData.ml[a])},bindBtns:function(){H.cardView.$btnBigClose.tap(function(){var a=H.card.getTapIndex(H.card.lastX,H.card.lastY);H.cardView.$dialogBig.playKeyframe({name:"smallcard-"+a+"-close",duration:300,timingFunction:"ease",complete:function(){H.card.closeVideo(H.cardView.$videoBig),setTimeout(function(){H.cardView.$dialogBigWrapper.addClass("none"),H.cardView.$dialogBig.css({"-webkit-animation":"none",animation:"none"})},100)}})}),H.cardView.$btnSmallClose.tap(function(){var a=H.card.getTapIndex(H.card.lastX,H.card.lastY);H.cardView.$dialogSmall.playKeyframe({name:"smallcard-"+a+"-close",duration:300,timingFunction:"ease",complete:function(){H.card.closeVideo(H.cardView.$videoSmall),setTimeout(function(){H.cardView.$dialogSmallWrapper.addClass("none"),H.cardView.$dialogSmall.css({"-webkit-animation":"none",animation:"none"})},100)}})}),H.cardView.$btnMakeBig.tap(function(){H.cardView.$dialogBigWrapper.addClass("none"),H.cardView.$dialogBig.css({"-webkit-animation":"none",animation:"none"}),H.cardSend.show(H.cardView.cardData),H.card.closeVideo(H.cardView.$videoBig)}),H.cardView.$btnMakeSmall.tap(function(){H.cardView.$dialogSmallWrapper.addClass("none"),H.cardView.$dialogSmall.css({"-webkit-animation":"none",animation:"none"}),H.cardSend.show(H.cardView.cardData),H.card.closeVideo(H.cardView.$videoSmall)})},resize:function(b,c,d,e,f){var g=742/864,h=71/864,i=.734375,j=560/702,k=71/702;a("#card_view_dialog_big .card-make-btn").css({top:c*g,height:c*h}),a("#card_view_dialog_big .card-friend-list ul").css({width:b*i}),a("#card_view_dialog_big .card-friend-list ul li").css({width:b*i/4-4,height:b*i/4-4}),a("#card_view_dialog_small .card-make-btn").css({top:d*j,height:d*k});var l=c*g-e-f-(b*i/4-4)-50;a("#card_view_dialog_big .card-title").css({height:l/2-12,"line-height":l/2-12+"px",margin:"8px 0 4px"}),a("#card_view_dialog_big .card-text").css({height:l/2-12,"line-height":l/2-12+"px",margin:"4px 0 8px"});var m=d*j-e-f-20;a("#card_view_dialog_small .card-title").css({height:m/2-12,"line-height":m/2-12+"px",margin:"8px 0 4px"}),a("#card_view_dialog_small .card-text").css({height:m/2-12,"line-height":m/2-12+"px",margin:"4px 0 8px"})}},H.cardView.init()}(Zepto),function(a){H.cardGet={$dialogWrapper:a("#card_get_dialog"),$dialog:a("#card_get_dialog .dialog"),$btnGet:a("#card_get_dialog .card-get-btn"),$cover:a("#card_get_dialog .card-get-cover"),$title:a("#card_get_dialog .card-title"),$actor:a("#card_get_dialog .card-text"),cardData:null,isReturn:!0,init:function(){this.bindBtns()},show:function(a){H.cardGet.$dialogWrapper.hasClass("none")&&(H.cardGet.cardData=a,H.cardGet.$cover.attr("src",a.ulli),H.cardGet.$title.text(a.tt),H.cardGet.$actor.text(a.ct),H.cardGet.$dialogWrapper.removeClass("none"),H.cardGet.$dialog.addClass("transparent"),setTimeout(function(){H.cardGet.$dialog.removeClass("transparent"),H.cardGet.$dialog.addClass("bounceInDown")},100))},close:function(){H.cardGet.$dialog.playKeyframe({name:"bigcard-2-close",duration:300,timingFunction:"ease",complete:function(){setTimeout(function(){H.cardGet.$dialogWrapper.addClass("none"),H.cardGet.$dialog.css({"-webkit-animation":"none",animation:"none"}),H.card.beginCountdown()},100)}})},bindBtns:function(){H.cardGet.$btnGet.tap(function(){H.cardGet.isReturn&&(H.cardGet.isReturn=!1,showLoading(null,"贺卡领取中"),getResult("api/greetingcard/material/gain",{oi:openid,mu:H.cardGet.cardData.ud},"callbackGreetingcardMaterialGainHandler"))})},success:function(){localStorage.setItem(openid+LS_KEY_CARD_PREFIX+H.cardGet.cardData.ud,"true"),H.card.addCard(H.cardGet.cardData.ud),H.cardGet.close()},resize:function(b,c,d){var e=560/702,f=71/702;a("#card_get_dialog .card-get-btn").css({top:b*e,height:b*f});var g=b*e-c-d-20;a("#card_get_dialog .card-title").css({height:g/2-12,"line-height":g/2-12+"px",margin:"8px auto 4px"}),a("#card_get_dialog .card-text").css({height:g/2-12,"line-height":g/2-12+"px",margin:"4px auto 8px"})}},W.callbackGreetingcardMaterialGainHandler=function(a){hideLoading(),H.cardGet.isReturn=!0,1==a.result&&H.cardGet.success()},H.cardGet.init()}(Zepto),function(a){H.cardUnlock={$dialogWrapper:a("#card_unlock_dialog"),$dialog:a("#card_unlock_dialog .dialog"),$btnClose:a("#card_unlock_dialog .btn-close"),$btnSend:a("#card_unlock_dialog .card-get-btn"),$cover:a("#card_unlock_dialog .card-cover"),$guide:a("#card_unlock_guide"),$title:a("#card_unlock_dialog .card-title"),$text:a("#card_unlock_dialog .card-text"),cardData:null,init:function(){this.bindBtns()},show:function(a){H.cardUnlock.cardData=a,H.cardUnlock.$cover.attr("src",a.lli),H.cardUnlock.$title.text(a.tt),H.cardUnlock.$text.text(a.ct),H.cardUnlock.$dialogWrapper.removeClass("none"),H.cardUnlock.$dialog.addClass("transparent"),setTimeout(function(){H.cardUnlock.$dialog.removeClass("transparent");var a=H.card.getTapIndex(H.card.lastX,H.card.lastY);H.cardUnlock.$dialog.playKeyframe({name:"smallcard-"+a+"-open",duration:300,timingFunction:"ease",complete:function(){H.share.unlockShare(H.cardUnlock.cardData,4)}})},100)},showLiukong:function(a){H.cardUnlock.show(H.card.cardData.ml[a])},bindBtns:function(){H.cardUnlock.$btnClose.tap(function(){var a=H.card.getTapIndex(H.card.lastX,H.card.lastY);H.cardUnlock.$dialog.playKeyframe({name:"smallcard-"+a+"-close",duration:300,timingFunction:"ease",complete:function(){H.share.commonShare(),setTimeout(function(){H.cardUnlock.$dialogWrapper.addClass("none"),H.cardUnlock.$dialog.css({"-webkit-animation":"none",animation:"none"})},100)}})}),H.cardUnlock.$btnSend.tap(function(){localStorage.setItem(openid+LS_KEY_UNLOCKING_PREFIX+H.cardUnlock.cardData.ud,!0),H.card.unLockingCards.push(H.cardUnlock.cardData.ud),a("#card_unlock_guide").removeClass("none"),a("#card_unlock_guide .cloud-wrapper").addClass("floating"),setTimeout(function(){a("#card_unlock_guide .cloud-wrapper .cloud-text").removeClass("none").addClass("fadeIn")},400)}),H.cardUnlock.$guide.tap(function(){a(this).addClass("none"),a("#card_unlock_guide .cloud-wrapper .cloud-text").addClass("none").removeClass("fadeIn")})},resize:function(b,c,d){var e=560/702,f=71/702;a("#card_unlock_dialog .card-get-btn").css({top:b*e,height:b*f});var g=b*e-c-d-20;a("#card_unlock_dialog .card-title").css({height:g/2-12,"line-height":g/2-12+"px",margin:"8px 0 4px"}),a("#card_unlock_dialog .card-text").css({height:g/2-12,"line-height":g/2-12+"px",margin:"4px 0 8px"})}},H.cardUnlock.init()}(Zepto),function(a){H.cardUnlocking={$dialogWrapper:a("#card_unlocking_dialog"),$dialog:a("#card_unlocking_dialog .dialog"),$friendLi:a("#card_unlocking_dialog .card-friend-list ul li"),$cover:a("#card_unlocking_dialog .card-cover"),$title:a("#card_unlocking_dialog .card-title"),$text:a("#card_unlocking_dialog .card-text"),$guide:a("#card_unlock_guide"),$btnClose:a("#card_unlocking_dialog .btn-close"),$btnSend:a("#card_unlocking_dialog .card-unlocking-btn"),$locking:a("#card_unlocking_dialog .locking"),$tips:a("#card_unlocking_dialog .card-friend-tips"),cardData:null,init:function(){this.bindBtns()},show:function(a){H.cardUnlocking.cardData=a;for(var b in H.cardUnlocking.$friendLi)H.cardUnlocking.$friendLi.eq(b).html(parseInt(b)+1);for(var b in a.fl)H.cardUnlocking.$friendLi.eq(b).html('<img src="'+(a.fl[b].hi?a.fl[b].hi:"./images/avatar.jpg")+'" />');var c=a.uu-a.fl.length;H.cardUnlocking.$locking.attr("src","./images/big-unlock-"+c+".png"),H.cardUnlocking.$tips.text("还差"+c+"人，盼你们如南方人盼暖气"),H.cardUnlocking.$cover.attr("src",a.lli),H.cardUnlocking.$title.text(a.tt),H.cardUnlocking.$text.text(a.ct),H.cardUnlocking.$dialogWrapper.removeClass("none"),H.cardUnlocking.$dialog.addClass("transparent"),setTimeout(function(){H.cardUnlocking.$dialog.removeClass("transparent");var a=H.card.getTapIndex(H.card.lastX,H.card.lastY);H.cardUnlocking.$dialog.playKeyframe({name:"bigcard-"+a+"-open",duration:300,timingFunction:"ease",complete:function(){H.share.unlockShare(H.cardUnlocking.cardData,c)}})},100)},bindBtns:function(){H.cardUnlocking.$btnClose.tap(function(){var a=H.card.getTapIndex(H.card.lastX,H.card.lastY);H.cardUnlocking.$dialog.playKeyframe({name:"bigcard-"+a+"-close",duration:300,timingFunction:"ease",complete:function(){H.share.commonShare(),setTimeout(function(){H.cardUnlocking.$dialogWrapper.addClass("none"),H.cardUnlocking.$dialog.css({"-webkit-animation":"none",animation:"none"})},100)}})}),H.cardUnlocking.$btnSend.tap(function(){localStorage.setItem(openid+LS_KEY_UNLOCKING_PREFIX+H.cardUnlocking.cardData.ud,!0),H.card.unLockingCards.push(H.cardUnlocking.cardData.ud),a("#card_unlock_guide").removeClass("none"),a("#card_unlock_guide .cloud-wrapper").addClass("floating"),setTimeout(function(){a("#card_unlock_guide .cloud-wrapper .cloud-text").removeClass("none").addClass("fadeIn")},400)}),H.cardUnlocking.$guide.tap(function(){a(this).addClass("none"),a("#card_unlock_guide .cloud-wrapper .cloud-text").addClass("none").removeClass("fadeIn")})},resize:function(b,c,d,e){var f=740/864,g=71/864,h=.734375;a("#card_unlocking_dialog .card-unlocking-btn").css({top:c*f,height:c*g}),a("#card_unlocking_dialog .card-friend-list ul").css({width:b*h}),a("#card_unlocking_dialog .card-friend-list ul li").css({width:b*h/4-4,height:b*h/4-4,"line-height":b*h/4-4+"px"});var i=c*f-d-e-(b*h/4-4)-50;a("#card_unlocking_dialog .card-title").css({height:i/2-12,"line-height":i/2-12+"px",margin:"8px 0 4px"}),a("#card_unlocking_dialog .card-text").css({height:i/2-12,"line-height":i/2-12+"px",margin:"4px 0 8px"})}},H.cardUnlocking.init()}(Zepto),function(a){H.card={$cardList:a("#card_list"),$cardTmpl:a("#tmpl_card_item"),$videoTmpl:a("#tmpl_video"),cardData:null,unLockingCards:[],videoWidth:0,videoHeight:0,lastX:0,lastY:0,card2Left:0,card3Left:0,cardX:0,cardY:0,cardWidth:0,videoCounter:0,init:function(){H.card.resize()},getCards:function(){getResult("api/greetingcard/material/all",null,"callbackGreetingcardMaterialAllHandler",null,null,null,15e3,function(){
H.card.initDefaultCards()})},initCards:function(a){H.card.cardData=a,H.card.fillCards(!0),H.card.initUnlockingCards(),H.card.unlockCountdown(),H.vip.init()},initDefaultCards:function(a){H.card.cardData=callbackGreetingcardMaterialAllHandlerData,H.card.fillCards(!1)},fillCards:function(a){var b=H.card.cardData.ml,c="";for(var d in b){var e=localStorage.getItem(openid+LS_KEY_CARD_PREFIX+b[d].ud);H.card.isActiveCard(d,e)&&(c+=e&&0!=e?H.card.$cardTmpl.tmpl({index:d,lockClass:"unlocked",id:b[d].ud,img:b[d].ulsi,unlock:b[d].ulsi,title:b[d].tt}):H.card.$cardTmpl.tmpl({index:d,lockClass:"locked",id:b[d].ud,img:b[d].lsi,unlock:b[d].ulsi,title:b[d].tt}))}H.card.$cardList.html(c),H.card.initSlick(),a?H.card.bindCardEvents():H.card.bindLiukongEvents()},addCard:function(a){var b=H.card.cardData.ml,c=0;for(var d in b)if(b[d].ud==a){c=d;break}jQuery(".index-cards-content-inner").length>0&&(jQuery(".index-cards-content-inner").slick("slickAdd",H.card.$cardTmpl.tmpl({lockClass:"unlocked",id:b[c].ud,img:b[c].ulsi,title:b[c].tt})),jQuery(".index-cards-content-inner").slick("slickGoTo",99)),H.card.arrowResize(),H.card.bindCardEvents()},isActiveCard:function(a,b){var c=H.card.cardData.ml[a];if(b)return!0;var d=(new Date).getTime()-H.countdown.serverOffset;return d>timestamp(c.uet)?!0:!1},initSlick:function(){jQuery(".index-cards-content-inner").slick({infinite:!0,slidesToShow:3,slidesToScroll:3,swipe:!0,infinite:!1}),H.card.arrowResize()},bindCardEvents:function(){a(".index-cards-item").unbind("tap").tap(function(b){showLoading(null,"努力加载中"),getResult("api/greetingcard/material/get",{oi:openid,mu:a(this).attr("data-id")},"callbackGreetingcardMaterialGetHandler")}),a(".index-cards-item").bind("touchstart",function(a){return H.card.lastX=a.touches[0].pageX,H.card.lastY=a.touches[0].pageY,!0})},bindLiukongEvents:function(){a(".index-cards-item").unbind("tap").tap(function(b){var c=a(this).attr("data-index"),d=a(this).attr("data-id"),e=localStorage.getItem(openid+LS_KEY_CARD_PREFIX+d);e?H.cardView.showLiukong(c):H.cardUnlock.showLiukong(c)}),a(".index-cards-item").bind("touchstart",function(a){return H.card.lastX=a.touches[0].pageX,H.card.lastY=a.touches[0].pageY,!0})},getTapIndex:function(a,b){return a<H.card.card2Left?0:a>H.card.card3Left?2:1},openCard:function(b){0==b.gs?b.fl?H.cardUnlocking.show(b):H.cardUnlock.show(b):(localStorage.setItem(openid+LS_KEY_CARD_PREFIX+b.ud,!0),a('.index-cards-item[data-id="'+b.ud+'"] img').attr("src",b.ulsi),H.cardView.show(b))},arrowResize:function(){var b=a(window).width(),c=a(window).height(),d=40,e=640/42;a("#index .index-cards .slick-arrow").css({width:b/d,height:c/e,"margin-top":(H.index.cardItemHeight-c/e)/2})},beginCountdown:function(){var a=(new Date).getTime()-H.countdown.serverOffset;if(H.card.cardData&&H.card.cardData.ml){var b=H.card.cardData.ml;for(var c in b){var d=localStorage.getItem(openid+LS_KEY_CARD_PREFIX+b[c].ud);if(timestamp(b[c].ubt)<a&&a<timestamp(b[c].uet)&&!d)return H.cardGet.show(b[c]),!0}}setTimeout(function(){H.card.beginCountdown()},5e3)},initUnlockingCards:function(){var a=H.card.cardData.ml;for(var b in a){var c=localStorage.getItem(openid+LS_KEY_CARD_PREFIX+a[b].ud);if(!c){var d=localStorage.getItem(openid+LS_KEY_UNLOCKING_PREFIX+a[b].ud);d&&H.card.unLockingCards.push(a[b].ud)}}},unlockCountdown:function(){H.card.unLockingCards.length>0&&getResult("api/greetingcard/material/confirm",{oi:openid,mus:H.card.unLockingCards.join(",")},"callbackGreetingcardMaterialConfirmHandler"),setTimeout(function(){H.card.unlockCountdown()},5e3)},hasUnlocked:function(b){var c=!1,d=0;for(var e in b)if("result"!=e){localStorage.setItem(openid+LS_KEY_CARD_PREFIX+e,!0),localStorage.removeItem(openid+LS_KEY_UNLOCKING_PREFIX+e);var f=a('.index-cards-item[data-id="'+e+'"] img');f.attr("src",f.attr("data-src")),c=!0,d++}c&&(showTips("您的"+d+"张贺卡已解锁"),H.card.unLockingCards=[],H.card.initUnlockingCards())},initVideoEvents:function(b,c,d){H.card.videoCounter++;var e=H.card.$videoTmpl.tmpl({id:"cardVideo"+H.card.videoCounter,src:b,poster:c,width:H.card.videoWidth,height:H.card.videoHeight});a(d).html(e),isAndroid||videojs("#cardVideo"+H.card.videoCounter).ready(function(){})},closeVideo:function(b){a(b).empty()},resize:function(){var b=a(window).width(),c=a(window).height(),d=67/1009,e=70/1009,f=1.35,g=103/1009,h=702/640,i=.68*b-12;H.card.videoWidth=i,H.card.videoHeight=i/4*3,a(".dialog .video-wrapper").css({width:i,height:i/4*3,"background-size":i+"px "+i/4*3+"px"});var j=h*b;a(".small-dialog").css({width:b,height:j,"background-size":b+"px "+j+"px","padding-top":d*c});var k=f*b;a(".big-dialog").css({width:b,height:k,"background-size":b+"px "+k+"px","padding-top":d*c}),c>500?(a(".small-dialog").parent().css({"padding-top":g*c}),a(".big-dialog").parent().css({"padding-top":e*c})):(a(".small-dialog").parent().css({"padding-top":(c-j)/2}),a(".big-dialog").css({"padding-top":(c-k)/2}),a(".big-dialog .btn-close").css({top:"-10px",right:"-10px"})),moveYSmall=g*c+j/2-H.card.cardY,moveYBig=e*c+k/2-H.card.cardY,moveX1=b/2-(H.card.cardX+H.card.cardWidth/2),a.keyframe.define({name:"smallcard-0-open",from:{opacity:0,"-webkit-transform":"translate("+-1*moveX1+"px,"+-1*moveYSmall+"px) scale(0.2) scaleX(0.1)"},to:{"-webkit-transform":"translate(0px,0px) scale(1.0)"}}),a.keyframe.define({name:"smallcard-0-close",to:{opacity:0,"-webkit-transform":"translate("+-1*moveX1+"px,"+-1*moveYSmall+"px) scale(0.2) scaleX(0.1)"},from:{"-webkit-transform":"translate(0px,0px)"}}),a.keyframe.define({name:"bigcard-0-open",from:{opacity:0,"-webkit-transform":"translate("+-1*moveX1+"px,"+-1*moveYBig+"px) scale(0.2) scaleX(0.1)"},to:{"-webkit-transform":"translate(0px,0px) scale(1.0)"}}),a.keyframe.define({name:"bigcard-0-close",to:{opacity:0,"-webkit-transform":"translate("+-1*moveX1+"px,"+-1*moveYBig+"px) scale(0.2) scaleX(0.1)"},from:{"-webkit-transform":"translate(0px,0px)"}}),moveX2=b/2-(H.card.cardX+H.card.cardWidth+H.card.cardWidth/2),a.keyframe.define({name:"smallcard-1-open",from:{opacity:0,"-webkit-transform":"translate("+-1*moveX2+"px,"+-1*moveYSmall+"px) scale(0.2) scaleX(0.1)"},to:{"-webkit-transform":"translate(0px,0px) scale(1.0)"}}),a.keyframe.define({name:"smallcard-1-close",to:{opacity:0,"-webkit-transform":"translate("+-1*moveX2+"px,"+-1*moveYSmall+"px) scale(0.2) scaleX(0.1)"},from:{"-webkit-transform":"translate(0px,0px)"}}),a.keyframe.define({name:"bigcard-1-open",from:{opacity:0,"-webkit-transform":"translate("+-1*moveX2+"px,"+-1*moveYBig+"px) scale(0.2) scaleX(0.1)"},to:{"-webkit-transform":"translate(0px,0px) scale(1.0)"}}),a.keyframe.define({name:"bigcard-1-close",to:{opacity:0,"-webkit-transform":"translate("+-1*moveX2+"px,"+-1*moveYBig+"px) scale(0.2) scaleX(0.1)"},from:{"-webkit-transform":"translate(0px,0px)"}}),moveX3=b/2-(H.card.cardX+2*H.card.cardWidth+H.card.cardWidth/2),a.keyframe.define({name:"smallcard-2-open",from:{opacity:0,"-webkit-transform":"translate("+-1*moveX3+"px,"+-1*moveYSmall+"px) scale(0.2) scaleX(0.1)"},to:{"-webkit-transform":"translate(0px,0px) scale(1.0)"}}),a.keyframe.define({name:"smallcard-2-close",to:{opacity:0,"-webkit-transform":"translate("+-1*moveX3+"px,"+-1*moveYSmall+"px) scale(0.2) scaleX(0.1)"},from:{"-webkit-transform":"translate(0px,0px)"}}),a.keyframe.define({name:"bigcard-2-open",from:{opacity:0,"-webkit-transform":"translate("+-1*moveX3+"px,"+-1*moveYBig+"px) scale(0.2) scaleX(0.1)"},to:{"-webkit-transform":"translate(0px,0px) scale(1.0)"}}),a.keyframe.define({name:"bigcard-2-close",to:{opacity:0,"-webkit-transform":"translate("+-1*moveX3+"px,"+-1*moveYBig+"px) scale(0.2) scaleX(0.1)"},from:{"-webkit-transform":"translate(0px,0px)"}}),H.cardView.resize(b,k,j,d*c,i/4*3),H.cardUnlock.resize(j,d*c,i/4*3),H.cardUnlocking.resize(b,k,d*c,i/4*3),H.cardGet.resize(j,d*c,i/4*3),H.cardSend.resize(k),H.cardAccept.resize(k)}},W.callbackGreetingcardMaterialAllHandler=function(a){1==a.result&&a.ml&&a.ml.length>0?H.card.initCards(a):H.card.initDefaultCards()},W.callbackGreetingcardMaterialGetHandler=function(a){hideLoading(),1==a.result&&H.card.openCard(a)},W.callbackGreetingcardMaterialConfirmHandler=function(a){1==a.result&&H.card.hasUnlocked(a)}}(Zepto),function(a){H.comment={$commentScrolling:a(".index-comment-list"),$comments:a(".comment-list-wrapper"),$list:a("#comment_list"),$input:a("#comment_input"),$submit:a("#comment_submit"),$tabs:a(".nav-list-item"),$tmplComment:a("#tmpl_comment"),$tmplVoice:a("#tmpl_voice"),$tmplCommentEmpty:a("#tmpl_comment_empty"),curPage:1,pageSize:50,lastCommnet:"",lastType:"text",totalHeight:0,scrollerHeight:0,isNewHeight:!1,isLoading:!1,isNoMore:!1,praisedUid:0,topicId:"",curDt:1,curTab:0,init:function(){this.resize(),this.bindBtn(),H.comment.fillCache(openid+LS_KEY_COMMENT_CACHE_QU),this.getList(this.curPage)},initTopic:function(a){H.comment.topicId=a,H.comment.init()},fillCache:function(a){var b=localStorage.getItem(a);if(b)try{var c=JSON.parse(b);H.comment.initcomments(c),H.comment.$commentScrolling[0].scrollTop=0}catch(d){console.log("error")}},getList:function(a){H.comment.isLoading=!0,2==H.comment.curTab?getResult("api/comments/list",{page:a},"callbackCommentsApiList",null,null,null,15e3,function(){}):1==H.comment.curTab?getResult("api/comments/friends",{page:a,oi:openid},"callbackCommentsApiFriends",null,null,null,15e3,function(){}):getResult("api/comments/highQuality",{page:a},"callbackCommentsApiHighQuality",null,null,null,15e3,function(){})},initcomments:function(a){a.items.length<this.pageSize&&(this.isNoMore=!0);var b=simpleTpl();for(var c in a.items){var d=localStorage.getItem(openid+LS_KEY_COMMENT_PRAISED_PREFIX+a.items[c].uid);if("object"==typeof a.items[c].co){var e=a.items[c].co,f=Math.floor(e.duration/1e3),g=f/30*100;20>g?g=20:g>=90&&(g=90),d&&0==a.items[c].pc&&(a.items[c].pc=1),b._(H.comment.$tmplVoice.tmpl({name:a.items[c].na,src:a.items[c].hu,content:a.items[c].co,praised:d?"praised":"",uid:a.items[c].uid,pcshow:1==H.comment.curTab?"none":"",pc:a.items[c].pc,duration:(0==f?1:f)+'"',vid:e.serverId,size:"width: "+g+"%",length:e.duration,vip:a.items[c].sc>0?"":"none"}))}else d&&0==a.items[c].pc&&(a.items[c].pc=1),b._(H.comment.$tmplComment.tmpl({name:xssEscape(a.items[c].na),src:a.items[c].hu,content:xssEscape(a.items[c].co),praised:d?"praised":"",uid:a.items[c].uid,pcshow:1==H.comment.curTab?"none":"",pc:a.items[c].pc,vip:a.items[c].sc>0?"":"none"}))}1==H.comment.curPage&&this.$list.empty(),this.$list.append(b.toString()),this.bindPraise(),this.bindVoice(),this.isNewHeight=!0,H.comment.emptyComments()},emptyComments:function(){0==this.$list.find(".comment-list-item").length?this.$list.html(H.comment.$tmplCommentEmpty.tmpl()):this.$list.find(".comment-list-empty").remove()},bindPraise:function(){this.$list.find(".comment-list-agree").unbind("tap"),this.$list.find(".comment-list-agree").tap(function(){a(this).parents(".comment-list-item").hasClass("praised")||(showLoading(null,"点赞发送中"),H.comment.praisedUid=a(this).attr("uid"),getResult("api/comments/praise",{uid:a(this).attr("uid"),oi:openid},"callbackCommentsApiPraise",null,null,null,15e3,function(){hideLoading(),showTips("点赞成功"),$item=H.comment.$list.find('.comment-list-agree[uid="'+H.comment.praisedUid+'"] .comment-list-mark');var a=parseInt($item.html(),10);$item.html(++a).parent().addClass("praised"),$item.parents(".comment-list-item").addClass("praised"),localStorage.setItem(openid+LS_KEY_COMMENT_PRAISED_PREFIX+H.comment.praisedUid,!0)}))})},bindVoice:function(){this.$list.find(".comment-voice-detail").unbind("tap"),this.$list.find(".comment-voice-detail").tap(function(){var b=this,c=a(b).attr("data-vid");H.voice.playVoice(c),H.comment.$list.find(".comment-voice-detail").removeClass("active"),a(b).addClass("active");var d=a(this).attr("data-len");setTimeout(function(){a(b).removeClass("active")},d)})},bindBtn:function(){this.$submit.tap(function(){var a=H.comment.$input.val();if(a.length>0){H.comment.lastType="text",H.comment.lastCommnet=a,showLoading();var b={co:encodeURIComponent(a),oi:openid,nn:nickname?encodeURIComponent(nickname):"",hu:headimgurl?headimgurl:""};getResult("api/comments/save",b,"callbackCommentsApiSave",null,null,null,15e3,function(){hideLoading(),"text"==H.comment.lastType?H.comment.submitSuccess({uid:0}):H.voice.submitVoiceSuccess({uid:0})})}else alert("内容不能为空哦~")}),this.$commentScrolling.scroll(function(){var a=H.comment.$commentScrolling.scrollTop();return H.comment.isNewHeight&&(H.comment.isNewHeight=!1,H.comment.scrollerHeight=H.comment.$list.height()),H.comment.scrollerHeight-H.comment.totalHeight-a<20&&!H.comment.isLoading&&!H.comment.isNoMore&&H.comment.getList(H.comment.curPage),!1}),a("#btn_time").tap(function(){H.comment.$tabs.removeClass("active"),a(this).addClass("active"),H.comment.$list.empty(),H.comment.curPage=1,H.comment.curTab=2,H.comment.isNoMore=!1,H.comment.getList(H.comment.curPage),H.comment.fillCache(openid+LS_KEY_COMMENT_CACHE_TIME)}),a("#btn_friend").tap(function(){H.comment.$tabs.removeClass("active"),a(this).addClass("active"),H.comment.$list.empty(),H.comment.curPage=1,H.comment.curTab=1,H.comment.isNoMore=!1,H.comment.getList(H.comment.curPage),H.comment.fillCache(openid+LS_KEY_COMMENT_CACHE_FRIEND)}),a("#btn_zan").tap(function(){H.comment.$tabs.removeClass("active"),a(this).addClass("active"),H.comment.$list.empty(),H.comment.curPage=1,H.comment.curTab=0,H.comment.isNoMore=!1,H.comment.getList(H.comment.curPage),H.comment.fillCache(openid+LS_KEY_COMMENT_CACHE_QU)})},submitSuccess:function(a){showTips("发送成功");var b=this.$input.val();this.$input.val("");var c=simpleTpl();c._(H.comment.$tmplComment.tmpl({name:nickname?nickname:"匿名用户",src:headimgurl?headimgurl:"./images/avatar.jpg",content:b,praised:0,uid:a.uid,pcshow:1==H.comment.curTab?"none":"",pc:0,vip:"none"})),0==H.comment.curTab?(this.$list.append(c.toString()),this.$commentScrolling[0].scrollTop=99999):(this.$list.prepend(c.toString()),this.$commentScrolling[0].scrollTop=0),this.bindPraise(),H.comment.emptyComments()},resize:function(){H.comment.totalHeight=parseFloat(H.comment.$commentScrolling.css("height"))}},H.topic={$topicContent:a("#topic_content"),init:function(){getResult("api/comments/topic/round",{},"callbackCommentsTopicInfo",null,null,null,15e3,function(){H.topic.initDefaultTopic(),H.comment.init()})},initTopic:function(a){a.items.length>0?H.topic.$topicContent.text(a.items[0].t):H.topic.initDefaultTopic()},initDefaultTopic:function(){H.topic.$topicContent.text(defaultTopic)}},W.callbackCommentsTopicInfo=function(a){0==a.code&&a.items?(H.topic.initTopic(a),H.comment.initTopic(a.items[0].uid)):(H.topic.initDefaultTopic(),H.comment.init())},W.callbackCommentsApiSave=function(a){hideLoading(),0==a.code?"text"==H.comment.lastType?H.comment.submitSuccess(a):H.voice.submitVoiceSuccess(a):alert("网络错误，请稍后重试")},W.callbackCommentsApiPraise=function(a){if(hideLoading(),0==a.code){showTips("点赞成功"),$item=H.comment.$list.find('.comment-list-agree[uid="'+H.comment.praisedUid+'"] .comment-list-mark');var b=parseInt($item.html(),10);$item.html(++b).parent().addClass("praised"),$item.parents(".comment-list-item").addClass("praised"),localStorage.setItem(openid+LS_KEY_COMMENT_PRAISED_PREFIX+H.comment.praisedUid,!0)}else showTips("大家点赞热情太高啦，请稍后再试~")},W.callbackCommentsApiHighQuality=function(a){H.comment.isLoading=!1,0==a.code?(1==H.comment.curPage&&localStorage.setItem(openid+LS_KEY_COMMENT_CACHE_QU,JSON.stringify(a)),H.comment.initcomments(a),H.comment.curPage++):H.comment.emptyComments()},W.callbackCommentsApiFriends=function(a){H.comment.isLoading=!1,0==a.code?(1==H.comment.curPage&&localStorage.setItem(openid+LS_KEY_COMMENT_CACHE_FRIEND,JSON.stringify(a)),H.comment.initcomments(a),H.comment.curPage++):H.comment.emptyComments()},W.callbackCommentsApiList=function(a){H.comment.isLoading=!1,0==a.code?(1==H.comment.curPage&&localStorage.setItem(openid+LS_KEY_COMMENT_CACHE_TIME,JSON.stringify(a)),H.comment.initcomments(a),H.comment.curPage++):H.comment.emptyComments()}}(Zepto),function(a){H.rank={$dialogWrapper:a("#rank_dialog"),$dialog:a("#rank_dialog .dialog"),$friendList:a("#rank_dialog .rank-friend-list"),$rankGlobal:a("#rank_dialog .rank-global-list"),$tmplMyRank:a("#tmpl_rank_mine"),$tmplFriendList:a("#tmpl_rank_list"),$tmplEmpty:a("#tmpl_rank_empty"),$tabs:a("#rank_dialog .tab"),$tabFriend:a("#rank_dialog .tab-friend"),$tabGlobal:a("#rank_dialog .tab-global"),myRank:"暂无排名",myCard:"0",init:function(){this.resize(),this.bindBtns()},empty:function(){listHtml=H.rank.$tmplEmpty.tmpl(),H.rank.$friendList.html(listHtml)},emptyGlobal:function(){a(".rank-global-list .rank-list-item").addClass("none"),a("#my_card_tips").text("给好友发张拜年贺卡"),a("#my_global_rank").text("即可看到排名哦")},fillRank:function(a){H.rank.myRank=a.rk?a.rk:"暂无排名",H.rank.myCard=a.mc?a.mc:"0";var b=H.rank.$tmplMyRank.tmpl({avatar:headimgurl?headimgurl:"./images/avatar.jpg",name:nickname?xssEscape(nickname):"匿名",rank:H.rank.myRank,card:H.rank.myCard});if(a.fr&&0!=a.fr.length)for(var c in a.fr)b+=H.rank.$tmplFriendList.tmpl({avatar:a.fr[c].hi?a.fr[c].hi:"./images/avatar.jpg",name:a.fr[c].nn?xssEscape(a.fr[c].nn):"匿名好友",rank:a.fr[c].rk?a.fr[c].rk:"暂无排名",card:a.fr[c].mc?a.fr[c].mc:"0"});else b+=H.rank.$tmplEmpty.tmpl();H.rank.$friendList.html(b)},fillGlobal:function(b){a("#my_rank").text(H.rank.myRank),a("#my_card").text(H.rank.myCard),a("#my_card_tips").text("共获得了"+H.rank.myCard+"枚卡片"),a("#my_global_rank").text("击败了全国"+b.pc+"%的用户")},resize:function(){var b=a(window).height(),c=.8*b;H.rank.$dialog.css({top:.1*b,height:c}),H.rank.$friendList.css({height:c-10-49-32-20-50}),H.rank.$rankGlobal.css({height:c-10-49-32-20-50});var d=c-10-49-32-20-60-30-50;H.rank.$rankGlobal.find("p").css({height:d/5+"px","line-height":d/10+"px"}),H.rank.$rankGlobal.find("p.big").css({"line-height":d/5+"px"})},showDialog:function(){H.rank.$dialogWrapper.removeClass("none"),H.rank.$dialog.addClass("transparent"),setTimeout(function(){H.rank.$dialog.removeClass("transparent"),H.rank.$dialog.addClass("fadeInUp")},100)},hideDialog:function(){H.rank.$dialog.removeClass("fadeInUp").addClass("fadeOutDown"),setTimeout(function(){H.rank.$dialogWrapper.addClass("none"),H.rank.$dialog.removeClass("fadeOutDown")},400)},bindBtns:function(){a(window).height();a("#btn_rank").tap(function(){return H.rank.$tabFriend.trigger("tap"),H.rank.showDialog(),!1}),a("#btn_rank_close").tap(function(){return H.rank.hideDialog(),!1}),H.rank.$tabFriend.tap(function(){return H.rank.$tabs.removeClass("active"),a(this).addClass("active"),H.rank.$friendList.removeClass("none"),H.rank.$rankGlobal.addClass("none"),getResult("api/greetingcard/material/rank4friend",{oi:openid},"callbackGreetingcardMaterialRank4friendHandler",null,null,null,15e3,function(){H.rank.empty()}),!1}),H.rank.$tabGlobal.tap(function(){return H.rank.$tabs.removeClass("active"),a(this).addClass("active"),H.rank.$friendList.addClass("none"),H.rank.$rankGlobal.removeClass("none"),getResult("api/greetingcard/material/rank4wide",{oi:openid},"callbackGreetingcardMaterialRank4wideHandler",null,null,null,15e3,function(){H.rank.emptyGlobal()}),!1})}},W.callbackGreetingcardMaterialRank4friendHandler=function(a){hideLoading(),1==a.result?H.rank.fillRank(a):H.rank.empty()},W.callbackGreetingcardMaterialRank4wideHandler=function(a){hideLoading(),1==a.result?H.rank.fillGlobal(a):H.rank.emptyGlobal()},H.rank.init()}(Zepto),function(a){H.yao={$bg:a(".yao-wrapper"),$coverTop:a("#cover_top"),$coverBottom:a("#cover_bottom"),$audioWin:a("#audio_win"),$audioShake:a("#audio_shake"),bgRatio:1.6,bgHeight:0,shakeEvent:null,bgArgs:null,isReturned:!0,randMin:1,randMax:2,yaoran:0,yaotime:0,isLiukong:!1,init:function(){this.resize(),this.initShake(),this.bindBtn(),H.countdown.roundData[H.countdown.currentRound]&&H.countdown.roundData[H.countdown.currentRound].bi&&(this.bgArgs=H.countdown.roundData[H.countdown.currentRound].bi.split(","),preloadimages(this.bgArgs)),this.randomBg(),H.yao.yaoran=H.yao.randMin+Math.round(Math.random()*(H.yao.randMax-H.yao.randMin))},luckCallback:function(a){H.award.show(a,"yao")},randomBg:function(){if(this.bgArgs&&this.bgArgs.length>0){this.bgArgs=H.countdown.roundData[H.countdown.currentRound].bi.split(",");var a=Math.floor(Math.random()*this.bgArgs.length);""==this.bgArgs[a]?this.$bg.css("background-image",'url("./images/bg-yao-default.jpg")'):this.$bg.css("background-image","url("+this.bgArgs[a]+")")}else this.$bg.css("background-image",'url("./images/bg-yao-default.jpg")')},initShake:function(){this.shakeEvent=new Shake({threshold:4,timeout:1300}),W.addEventListener("shake",shakeOccur,!1),this.shakeEvent.start()},bindBtn:function(){a("#btn_back_index").tap(function(){return H.router.slideTo("index"),!1})},liuKong:function(){var a=Math.ceil(20*Math.random())+10;H.yao.isLiukong=!0,setTimeout(function(){H.yao.isLiukong=!1},1e3*a)},resize:function(){var b=a(window).width(),c=a(window).height(),d=380/1009,e=629/1009,f=c*e+1,g=63/85,h=10/640,i=223/629,j=217/629,k=86/629,l=.06875,m=44/53;a("#cover_top").css({height:c*d}),a("#cover_bottom").css({height:f}),this.bgHeight=b/this.bgRatio,this.$bg.css({"background-position-y":c*d-this.bgHeight/2,"background-size":b+"px "+this.bgHeight+"px"}).removeClass("none");var n=f*i;a(".count-down-wrapper").css({top:f*j,height:n});var o=f*k,p=o*g;a(".count-down-wrapper .count-down-time").css({height:o}),a(".count-down-wrapper .count-down-time .count-down-num").css({width:p,height:o,"line-height":o+"px"}),a(".count-down-wrapper .count-down-time .count-down-space").css({width:b*h});var q=l*b/m;a(".count-down-wrapper .count-down-time .count-down-min").css({width:l*b,height:q,"line-height":q+"px","padding-top":l*b/m-l*b-2,bottom:-1*l*b/m,left:-1*l*b/2}),a(".count-down-wrapper .count-down-time").css({width:6*(p+2)+b*h*2});var r=n-o-q;a(".count-down-wrapper h2").css({height:r,"line-height":r+"px"})}},W.shakeOccur=function(){if("index"==H.router.curSlide)return!1;var b=!1;if(a(".dialog-wrapper").each(function(){a(this).hasClass("none")||(b=!0)}),b)return!1;H.yao.$audioShake[0].play(),H.yao.yaotime++;var c=H.yao.bgHeight/2-2;borderWidth="0",borderColor="transparent",H.yao.$coverTop.css({"-webkit-transform":"translate(0px,-"+c+"px)","border-bottom":borderColor+" "+borderWidth+"px solid","box-shadow":"0px 1px 10px #44241A"}),H.yao.$coverBottom.css({"-webkit-transform":"translate(0px,"+c+"px)","border-top":borderColor+" "+borderWidth+"px solid","box-shadow":"0px 1px 10px #44241A"}),setTimeout(function(){H.yao.$coverTop.css({"-webkit-transform":"translate(0px,0px)"}),H.yao.$coverBottom.css({"-webkit-transform":"translate(0px,0px)"}),setTimeout(function(){return H.yao.$coverTop.css({"border-width":"0px","box-shadow":"none"}),H.yao.$coverBottom.css({"border-width":"0px","box-shadow":"none"}),H.yao.randomBg(),H.yao.isLiukong?void H.nothing.showTips():void(H.yao.yaotime%H.yao.yaoran==0?(H.yao.yaoran=H.yao.randMin+Math.round(Math.random()*(H.yao.randMax-H.yao.randMin)),H.yao.yaotime=0,1==H.yao.isReturned&&(H.yao.isReturned=!1,getResult("api/lottery/luck",{oi:openid},"callbackLotteryLuckHandler",null,null,null,15e3,function(){H.yao.isReturned=!0,H.yao.liuKong()}))):H.nothing.showTips())},150)},1100)},W.callbackLotteryLuckHandler=function(a){H.yao.isReturned=!0,1==a.result?H.yao.luckCallback(a):a.flow&&1==a.flow?H.yao.liuKong():H.nothing.showTips()}}(Zepto),function(a){H.voice={isReady:!1,$btnVoice:a("#btn_voice"),$btnRecord:a("#btn_record_voice"),$commentInput:a("#comment_input_wrapper"),$tips:a("#voice_record_tips"),lastServerId:0,lastDuration:0,recordBegin:0,currentLocalId:0,init:function(){getResult("mp/jsapiticket",{appId:W.mpappid},"callbackJsapiTicketHandler")},initVoiceEvents:function(){H.voice.bindBtns()},uploadVoice:function(a){wx.uploadVoice({localId:a,isShowProgressTips:1,success:function(a){a.serverId;H.voice.saveVoice(a.serverId)}})},saveVoice:function(a){showLoading(null,"语音发送中"),H.comment.lastType="comment",H.voice.lastServerId=a;var b={co:JSON.stringify({type:"voice",serverId:a,duration:H.voice.lastDuration}),oi:openid,nn:nickname?encodeURIComponent(nickname):"",hu:headimgurl?headimgurl:""};getResult("api/comments/save",b,"callbackCommentsApiSave")},playVoice:function(a){H.voice.isReady&&(H.voice.stopVoice(H.voice.currentLocalId),wx.downloadVoice({serverId:a,isShowProgressTips:1,success:function(a){H.voice.currentLocalId=a.localId,wx.playVoice({localId:a.localId})}}))},stopVoice:function(a){H.voice.isReady&&wx.stopVoice({localId:a})},submitVoiceSuccess:function(a){showTips("语音发送成功");var b=Math.floor(H.voice.lastDuration/1e3),c=b/30*100;20>c?c=20:c>=90&&(c=90);var d=simpleTpl();d._(H.comment.$tmplVoice.tmpl({name:nickname?nickname:"匿名用户",src:headimgurl?headimgurl:"./images/avatar.jpg",praised:0,uid:a.uid,pc:0,pcshow:1==H.comment.curTab?"none":"",duration:(0==b?1:b)+'"',vid:H.voice.lastServerId,size:"width: "+c+"%",length:H.voice.lastDuration,vip:"none"})),0==H.comment.curTab?(H.comment.$list.append(d.toString()),H.comment.$commentScrolling[0].scrollTop=99999):(H.comment.$list.prepend(d.toString()),H.comment.$commentScrolling[0].scrollTop=0),H.comment.bindPraise(),H.comment.emptyComments(),H.comment.bindVoice(),H.comment.isNewHeight=!0},bindBtns:function(){this.$btnVoice.tap(function(){a(this).hasClass("active")?(a(this).removeClass("active"),a(this).find("img").attr("src","./images/icon-record-white.png"),H.voice.$btnRecord.addClass("none"),H.voice.$commentInput.removeClass("none")):(a(this).addClass("active"),a(this).find("img").attr("src","./images/icon-keyboard-white.png"),H.voice.$btnRecord.removeClass("none"),H.voice.$commentInput.addClass("none"))}),this.$btnRecord.bind("touchstart",function(){return H.voice.recordBegin=(new Date).getTime(),a(this).addClass("recording"),H.voice.$tips.removeClass("none"),wx.startRecord(),!1}),this.$btnRecord.bind("touchend",function(){return a(this).removeClass("recording"),H.voice.$tips.addClass("none"),wx.stopRecord({success:function(a){H.voice.lastDuration=(new Date).getTime()-H.voice.recordBegin,H.voice.uploadVoice(a.localId)}}),!1})}},W.callbackJsapiTicketHandler=function(a){var b=window.location.href,c="df51d5cc9bc24d5e86d4ff92a9507361",d=Math.round((new Date).getTime()/1e3),e=hex_sha1("jsapi_ticket="+a.ticket+"&noncestr="+c+"&timestamp="+d+"&url="+b);wx.config({appId:W.mpappid,timestamp:d,nonceStr:c,signature:e,jsApiList:["checkJsApi","addCard","startRecord","stopRecord","stopVoice","onVoiceRecordEnd","playVoice","stopVoice","onVoicePlayEnd","uploadVoice","downloadVoice"]}),wx.ready(function(){wx.checkJsApi({jsApiList:["addCard","startRecord","stopRecord","stopVoice","onVoiceRecordEnd","playVoice","stopVoice","onVoicePlayEnd","uploadVoice","downloadVoice"],success:function(a){H.voice.isReady=!0,H.voice.initVoiceEvents(),H.award.isKaquanReady=!0}})}),wx.error(function(a){H.voice.isReady=!1})},H.voice.init()}(Zepto),function(a){H.vip={$dialogWrapper:a("#vip_dialog"),$dialog:a("#vip_dialog .dialog"),$btnClose:a("#vip_dialog .btn-close"),$content:a("#vip_dialog .vip-container"),$btnOpen:a("#btn_door"),$btnClose:a("#vip_dialog .vip-close"),$btnStart:a("#vip_dialog .vip-start"),$carousel:a("#carousel"),$tmplPrize:a("#tmpl_vip_prize"),$navButtons:a("#navigation button"),$percent:a("#btn_door_cover"),panelCount:9,theta:0,translateZ:0,stopAuto:!0,isReturn:!0,autoTimeout:null,isLiukong:!1,init:function(){H.vip.resize(),getResult("api/lottery/round4callback",{at:9},"callbackVipLotteryRoundHandler")},initPrizes:function(a){getResult("api/lottery/prizes",{at:9},"callbackLotteryPrizesHandler")},fillPrizes:function(a){var b="";for(var c in a.pa)b+=H.vip.$tmplPrize.tmpl({image:a.pa[c].tp,name:a.pa[c].pn});var d=a.pa.length;if(8-d>0)for(var c=8-d;c>0;c--){var e=Math.floor(Math.random()*d);b+=H.vip.$tmplPrize.tmpl({image:a.pa[e].tp,name:a.pa[e].pn})}b+=H.vip.$tmplPrize.tmpl({image:"./images/nothing/nothing.jpg",name:"继续努力吧"}),H.vip.$carousel.html(b),this.resizePrize(),this.bindBtns(),H.vip.$btnOpen.addClass("ready"),H.vip.updateCardCount()},updateCardCount:function(){getResult("api/greetingcard/material/gainCount",{oi:openid},"callbackGreetingcardMaterialGainCountHandler")},updatePercent:function(a){if(H.card.cardData&&H.card.cardData.ml&&H.card.cardData.ml.length>0){var b=H.card.cardData.ml.length;H.vip.$percent.css("height",a.gc/b*100+"%"),H.vip.$btnStart.attr("data-left",b-a.gc),a.gc>=b&&(H.vip.$btnStart.removeClass("disabled"),H.vip.$btnStart.find("img").attr("src","./images/btn-vip-start.png"))}},liuKong:function(){var a=Math.ceil(20*Math.random())+10;H.vip.isLiukong=!0,setTimeout(function(){H.vip.isLiukong=!1},1e3*a)},show:function(){H.vip.stopAuto=!1,H.vip.autoRolling(),H.vip.$dialogWrapper.removeClass("none"),H.vip.$dialog.addClass("transparent"),setTimeout(function(){H.vip.$dialog.removeClass("transparent"),H.vip.$dialog.addClass("bounceInDown")},100)},autoRolling:function(){return H.vip.stopAuto?!1:(H.vip.theta+=360/H.vip.panelCount*-1,H.vip.$carousel.css("-webkit-transform","translateZ( "+-1*H.vip.translateZ+"px ) rotateY("+H.vip.theta+"deg)"),void(H.vip.autoTimeout=setTimeout(function(){H.vip.autoRolling()},3e3)))},bindBtns:function(){H.vip.$btnClose.tap(function(){H.vip.stopAuto=!0,clearTimeout(H.vip.autoTimeout),H.vip.$dialog.removeClass("bounceInDown").addClass("bounceOutUp"),setTimeout(function(){H.vip.$dialogWrapper.addClass("none"),H.vip.$dialog.removeClass("bounceOutUp")},500)}),H.vip.$btnStart.tap(function(){if(a(this).hasClass("disabled")){var b=a(this).attr("data-left");b?(0>b&&(b=0),showTips("您还差"+b+"张贺卡，请继续努力哦")):showTips("您还未收集到全部贺卡，请继续努力哦")}else if(H.vip.isReturn){if(H.vip.isReturn=!1,H.vip.stopAuto=!0,H.vip.isLiukong)return void H.vip.nothing();showLoading(null,"幸运降临中"),getResult("api/lottery/luck4Vip",{oi:openid},"callbackLotteryLuck4VipHandler",null,null,null,15e3,function(){hideLoading(),H.vip.liuKong(),H.vip.nothing()})}})},rolling:function(a){H.vip.rollingTo(a.px-1,function(){setTimeout(function(){H.award.show(a,"vip"),H.vip.isReturn=!0},1e3)})},nothing:function(){H.vip.rollingTo(8,function(){setTimeout(function(){H.nothing.show("./images/nothing/nothing.jpg","vip"),H.vip.isReturn=!0},1e3)})},reset:function(){H.vip.$carousel.resetKeyframe(),H.vip.stopAuto=!1,H.vip.autoRolling()},rollingTo:function(b,c){var d=b*(360/H.vip.panelCount)*-1;a.keyframe.define({name:"vip-rotate",from:{"-webkit-transform":"translateZ( "+-1*H.vip.translateZ+"px ) rotateY(0deg)"},to:{"-webkit-transform":"translateZ( "+-1*H.vip.translateZ+"px ) rotateY("+(-3600+d)+"deg)"}}),H.vip.$carousel.playKeyframe({name:"vip-rotate",duration:5e3,timingFunction:"cubic-bezier(.2,0,.4,1.05)",complete:function(){c()}})},resize:function(){var b=a(window).width(),c=a(window).height(),d=247/640,e=.6175,f=140/1009,g=b*d,h=g/e;H.vip.$dialog.css({width:b,height:c,"background-size":b+"px "+c+"px"}),H.vip.$content.css({width:g,height:h,"padding-top":f*c}),500>c&&H.vip.$btnStart.css({top:"68%"})},resizePrize:function(){var b=a(window).width(),c=215/123,d=H.vip.translateZ=b/c;H.vip.$content.find("figure").each(function(){var b=a(this).index(),c=40*b;a(this).css({"-webkit-transform":"rotateY("+c+"deg) translateZ("+d+"px)","-moz-transform":"rotateY("+c+"deg) translateZ("+d+"px)","-o-transform":"rotateY("+c+"deg) translateZ("+d+"px)",transform:"rotateY("+c+"deg) translateZ("+d+"px)"})}),H.vip.$carousel.css({"-webkit-transform":"translateZ( "+-1*H.vip.translateZ+"px ) rotateY(0deg)"})}},W.callbackLotteryPrizesHandler=function(a){1==a.result&&H.vip.fillPrizes(a)},W.callbackLotteryLuck4VipHandler=function(a){hideLoading(),1==a.result?H.vip.rolling(a):a.flow&&1==a.flow?(H.vip.liuKong(),H.vip.nothing()):H.vip.nothing()},W.callbackGreetingcardMaterialGainCountHandler=function(a){1==a.result&&(H.vip.updatePercent(a),setTimeout(function(){H.vip.updateCardCount()},5e3))},W.callbackVipLotteryRoundHandler=function(a){1==a.result&&H.vip.initPrizes(a)}}(Zepto),function(a){H.tangyuan={$dialogWrapper:a("#tangyuan_dialog"),$dialog:a("#tangyuan_dialog .dialog"),$dialogGet:a("#tangyuan_get_dialog"),$dialogCollect:a("#tangyuan_collect_dialog"),$count:a(".award-count"),$audioWin:a("#audio_win"),$btnBox:a(".btn-box a"),$petType:a("#pet_type"),$btnPlay:a("#what-play"),
$btnClose:a("#tangyuan_collect_dialog .i-close"),$btnOutClose:a("#tangyuan_dialog .btn-horn"),$pet:null,$type:null,$curPet:0,init:function(){H.tangyuan.bindBtns()},show:function(){H.tangyuan.$dialogWrapper.removeClass("none"),H.tangyuan.$dialog.addClass("transparent"),setTimeout(function(){H.tangyuan.$dialog.removeClass("transparent"),H.tangyuan.$dialog.addClass("bounceInDown")},100),H.tangyuan.resize()},showEgg:function(a){H.tangyuan.$petType.addClass("pet"+(parseInt(a,10)-1)),H.tangyuan.$dialogGet.removeClass("none")},close:function(){H.tangyuan.$dialogCollect.addClass("none"),H.tangyuan.$dialogGet.addClass("none"),H.tangyuan.$dialog.removeClass("bounceInDown").addClass("bounceOutUp"),setTimeout(function(){H.tangyuan.$dialogWrapper.addClass("none"),H.tangyuan.$dialog.removeClass("bounceOutUp")},500)},bindBtns:function(){H.tangyuan.$btnBox.tap(function(){var b=a(this).index();H.tangyuan.$curPet=b+1,H.tangyuan.$pet="pet_no"+(b+1),H.tangyuan.$type="pet"+b,a(this).removeClass("btn-a-"+b).addClass("btn-b-"+b),H.tangyuan.petAdopt()}),H.tangyuan.$btnPlay.removeClass("none").tap(function(){H.tangyuan.$dialogCollect.removeClass("none").addClass("zoom-in")}),H.tangyuan.$btnClose.tap(function(){H.tangyuan.close(),H.tangyuan.$dialogCollect.removeClass("zoom-in").addClass("zoom-out"),setTimeout(function(){H.tangyuan.$dialogCollect.removeClass("zoom-out").addClass("none")},500)}),H.tangyuan.$btnOutClose.tap(function(){H.tangyuan.close()})},petAdopt:function(){getResult("api/pet/thirdadopt",{oi:openid,pet:H.tangyuan.$pet,serviceNo:petServiceNo,nn:nickname?nickname:"",hu:headimgurl?headimgurl:""},"callbackApiPetAdopt")},petHtml:function(){H.tangyuan.$petType.addClass(H.tangyuan.$type),H.tangyuan.$dialogGet.removeClass("none"),localStorage.setItem(openid+LS_KEY_PET_ID,H.tangyuan.$curPet),H.index.updateTangyuan(H.tangyuan.$curPet)},resize:function(){var b=a(window).height(),c=a(window).width();H.tangyuan.$dialog.css({"background-size":c+"px "+b+"px"});var d=50/640,e=.328125,f=jQuery("#showcase");f.Cloud9Carousel({yOrigin:0,yRadius:d*c/2,xRadius:e*c,autoPlay:1,bringToFront:!0})}},W.callbackApiPetAdopt=function(a){a&&0==a.code?H.tangyuan.petHtml():showTips("大家太热情啦，请稍后重试")},H.tangyuan.init()}(Zepto),function(a){H.award={$dialogWrapper:a("#award_dialog"),$dialog:a("#award_dialog .dialog"),$count:a(".award-count"),$audioWin:a("#audio_win"),from:"yao",isKaquanReady:!1,$lastDialog:null,isAwardReturn:!0,init:function(){H.award.resize(),H.award.initCount()},initCount:function(){getResult("api/lottery/awardCount",null,"callbackLotteryAwardCountHandler")},show:function(a,b){if(H.award.from=b,0==a.result)return void H.nothing.showTips();if(0==a.pt)return void H.nothing.showTips();if(1==a.pt)H.award.$audioWin[0].play(),"infi"==a.pd?H.award.infinitiAward(a):"suning"==a.pd?H.award.suningAward(a):H.award.didiAward(a);else{if(7!=a.pt)return void H.nothing.showTips();H.award.$audioWin[0].play(),H.award.kaquanAward(a)}},close:function(){"vip"==H.award.from&&H.vip.reset(),"accept"==H.award.from&&H.cardAccept.didiDone()},resize:function(){var b=a(window).height(),c=770/1009,d=b*c;a("#award_dialog .dialog").css({height:d,top:(b-d)/2})},infinitiAward:function(b){var c=a(window).width(),d=a(window).height(),e=500/690,f=.8*c/e;a("#infiniti_award_dialog").removeClass("none"),a("#infiniti_award_dialog .dialog").addClass("award-in").css({height:f,top:(d-f)/2,"background-image":"url("+b.pi+")"}),a("#infiniti_name").val(b.rn?b.rn:""),a("#infiniti_tel").val(b.ph?b.ph:""),a("#infiniti_addr").val(b.ad?b.ad:""),a("#infiniti_award_dialog .award-btn").tap(function(){if(!H.award.isAwardReturn)return!1;var b=a("#infiniti_name").val();if(0==b.length)return showTips("请输入您的姓名"),!1;var c=a("#infiniti_tel").val();if(!/^\d{11}$/.test(c))return showTips("请正确填写您的电话"),!1;var d=a("#infiniti_addr").val();return 0==d.length?(showTips("请输入您的地址"),!1):(H.award.$lastDialog=a("#infiniti_award_dialog"),H.award.isAwardReturn=!1,void getResult("api/lottery/award",{oi:openid,nn:encodeURIComponent(nickname),hi:headimgurl,ph:c,rn:encodeURIComponent(b),ad:encodeURIComponent(d)},"callbackLotteryAwardHandler"))})},suningAward:function(b){var c=a(window).width(),d=a(window).height(),e=500/801,f=.8*c/e;a("#suning_award_dialog").removeClass("none"),a("#suning_award_dialog .dialog").addClass("award-in").css({height:f,top:(d-f)/2,"background-image":"url("+b.pi+")"}),a("#suning_name").val(b.rn?b.rn:""),a("#suning_tel").val(b.ph?b.ph:""),a("#suning_addr").val(b.ad?b.ad:""),a("#suning_award_dialog .award-btn").tap(function(){if(!H.award.isAwardReturn)return!1;var b=a("#suning_name").val();if(0==b.length)return showTips("请输入您的姓名"),!1;var c=a("#suning_tel").val();if(!/^\d{11}$/.test(c))return showTips("请正确填写您的电话"),!1;var d=a("#suning_addr").val();return 0==d.length?(showTips("请输入您的地址"),!1):(H.award.$lastDialog=a("#suning_award_dialog"),H.award.isAwardReturn=!1,void getResult("api/lottery/award",{oi:openid,nn:encodeURIComponent(nickname),hi:headimgurl,ph:c,rn:encodeURIComponent(b),ad:encodeURIComponent(d)},"callbackLotteryAwardHandler"))})},didiAward:function(b){var c=a(window).width(),d=a(window).height(),e=500/720,f=.8*c/e;a("#didi_award_dialog").removeClass("none"),a("#didi_award_dialog .dialog").addClass("award-in").css({height:f,top:(d-f)/2,"background-image":"url("+b.pi+")"}),a("#didi_tel").val(b.ph?b.ph:""),a("#didi_award_dialog .award-btn").tap(function(){if(!H.award.isAwardReturn)return!1;var b=a("#didi_tel").val();return/^\d{11}$/.test(b)?(H.award.$lastDialog=a("#didi_award_dialog"),H.award.isAwardReturn=!1,void getResult("api/lottery/award",{oi:openid,nn:encodeURIComponent(nickname),hi:headimgurl,ph:b},"callbackLotteryAwardHandler")):(showTips("请正确填写您的电话"),!1)})},kaquanAward:function(b){if(!H.award.isKaquanReady)return H.nothing.showTips(),!1;var c=a(window).width(),d=a(window).height(),e=330/473,f=.8*c/e;a("#kaquan_award_dialog").removeClass("none"),a("#kaquan_award_dialog .dialog").addClass("award-in").css({height:f,top:(d-f)/2,"background-image":"url("+b.pi+")"}),a("#kaquan_award_dialog .dialog").unbind("tap").tap(function(){return a(this).hasClass("disabled")?!1:(showLoading(null,"领取中"),setTimeout(function(){hideLoading()},15e3),void wx.addCard({cardList:[{cardId:b.ci,cardExt:'{"timestamp":"'+b.ts+'","signature":"'+b.si+'"}'}],success:function(b){getResult("api/lottery/award",{oi:openid,hi:headimgurl,nn:nickname},"callbackLotteryAwardHandler"),a("#kaquan_award_dialog .dialog").removeClass("disabled")},fail:function(b){hideLoading(),a("#kaquan_award_dialog .dialog").removeClass("disabled")},complete:function(){hideLoading(),a("#kaquan_award_dialog").addClass("none"),H.award.close()},cancel:function(){hideLoading(),a("#kaquan_award_dialog .dialog").removeClass("disabled")}}))})}},W.callbackLotteryAwardCountHandler=function(a){1==a.result&&(H.award.$count.text("已发奖品："+a.ac).removeClass("none"),setTimeout(function(){H.award.initCount()},5e3))},W.callbackLotteryAwardHandler=function(a){H.award.isAwardReturn=!0,1==a.result&&(showTips("领取成功"),H.award.$lastDialog.addClass("none"),H.award.close())},H.award.init()}(Zepto),function(a){H.nothing={$dialogWrapper:a("#nothing_dialog"),$dialog:a("#nothing_dialog .dialog"),$count:a(".award-count"),$tips:a("#yao .cover-tips"),from:"yao",tips:["姿势摆的好，就能中大奖","别灰心，继续加油！","可能是姿势不对哦~","加油~好运马上就来","换个姿势，再来一次！","再来一次，大奖在等你哦！"],init:function(){H.nothing.resize()},show:function(a,b){H.nothing.from=b,H.nothing.$dialog.find(".award-images img").attr("src",a),H.nothing.$dialog.find(".award-btn").unbind("tap").tap(function(){H.nothing.close()}),H.nothing.$dialogWrapper.removeClass("none"),H.nothing.$dialog.addClass("transparent"),setTimeout(function(){H.nothing.$dialog.removeClass("transparent"),H.nothing.$dialog.addClass("bounceInDown")},100)},showTips:function(){var a=Math.floor(Math.random()*H.nothing.tips.length);H.nothing.$tips.text(H.nothing.tips[a])},close:function(){H.nothing.$dialog.removeClass("bounceInDown").addClass("bounceOutUp"),setTimeout(function(){H.nothing.$dialogWrapper.addClass("none"),H.nothing.$dialog.removeClass("bounceOutUp")},500),"vip"==H.nothing.from&&H.vip.reset()},resize:function(){var b=a(window).height(),c=770/1009,d=b*c;a("#nothing_dialog .dialog").css({height:d,top:(b-d)/2})}},H.nothing.init()}(Zepto),function(a){H.share={shareData:null,init:function(){document.addEventListener("WeixinJSBridgeReady",function(){WeixinJSBridge.on("menu:share:appmessage",function(a){WeixinJSBridge.invoke("sendAppMessage",{img_url:H.share.shareData.image,link:H.share.shareData.link,desc:H.share.shareData.content,title:H.share.shareData.title},function(a){"send_app_msg:confirm"==a.err_msg&&(showTips(H.share.shareData.successTips),H.cardUnlock.$guide.addClass("none"),H.cardUnlocking.$guide.addClass("none"),H.cardSend.$guide.addClass("none"))})}),WeixinJSBridge.on("menu:share:timeline",function(a){WeixinJSBridge.invoke("shareTimeline",{img_url:H.share.shareData.image,img_width:"480",img_height:"480",link:H.share.shareData.link,desc:H.share.shareData.content,title:H.share.shareData.title},function(a){"share_timeline:ok"==a.err_msg&&(showTips(H.share.shareData.successTips),H.cardUnlock.$guide.addClass("none"),H.cardUnlocking.$guide.addClass("none"),H.cardSend.$guide.addClass("none"))})})},!1),H.share.commonShare()},commonShare:function(a){a?H.share.shareData={image:headimgurl,link:H.share.getCommonUrl(),content:"我是"+nickname+"，我是2016年江苏卫视第"+a+"个传递幸福的人，我在朋友圈，你在哪儿？",title:"多一个刷朋友圈，少一个跳广场舞",successTips:"分享成功"}:H.share.shareData={image:headimgurl,link:H.share.getCommonUrl(),content:"我是"+nickname+"，正在2016年江苏卫视传递幸福。我在朋友圈，你在哪儿？",title:"多一个刷朋友圈，少一个跳广场舞",successTips:"分享成功"}},unlockShare:function(a,b){var c=a.ud;H.share.shareData={image:headimgurl,link:H.share.getUnlockUrl(c),content:"盼你们如南方人盼暖气，我与明星距离只剩最后一步，快来帮我解锁卡片！",title:"【还差"+b+"人】江苏卫视春晚，没你怎么玩？",successTips:"解锁请求发送成功"}},cardShare:function(a,b,c,d,e,f){H.share.shareData={image:headimgurl,link:H.share.getSendUrl(a,b,c,d,f),content:"即使我们相隔千里，但我对你的思念和祝愿，从未停止...",title:e+"与"+nickname+"给您发来新年祝福",successTips:"贺卡发送成功"}},fuShare:function(a,b){H.share.shareData={image:headimgurl,link:H.share.getFuUrl(a,b),content:"盼你们如南方人盼暖气，我与明星距离只剩最后一步，快来帮我解锁卡片！",title:"江苏卫视春晚，没你怎么玩？"}},getCommonUrl:function(){var a=window.location.href;return a=a.replace(/[^\/]*\.html/i,"index.html"),a=add_param(a,"resopenid",hex_md5(openid),!0),a=add_param(a,"from","share",!0),a=add_param(a,"openid",null,!0),a=add_param(a,"headimgurl",null,!0),a=add_param(a,"nickname",null,!0),a=add_param(a,"send",null,!0),a=add_param(a,"ud",null,!0),a=add_param(a,"roi",null,!0),add_yao_prefix(a)},getUnlockUrl:function(a){var b=window.location.href;return b=b.replace(/[^\/]*\.html/i,"unlock.html"),b=add_param(b,"resopenid",hex_md5(openid),!0),b=add_param(b,"from","share",!0),b=add_param(b,"ud",a,!0),b=add_param(b,"roi",openid,!0),b=add_param(b,"openid",null,!0),b=add_param(b,"headimgurl",null,!0),b=add_param(b,"nickname",null,!0),b=add_param(b,"send",null,!0),console.log(b),add_yao_prefix(b)},getSendUrl:function(a,b,c,d,e){var f=window.location.href;return f=f.replace(/[^\/]*\.html/i,"index.html"),f=add_param(f,"resopenid",hex_md5(openid),!0),f=add_param(f,"from","share",!0),f=add_param(f,"nn",nickname?nickname:null,!0),f=add_param(f,"hd",headimgurl?headimgurl:null,!0),f=add_param(f,"vi",a,!0),f=add_param(f,"co",b,!0),f=add_param(f,"te",c?c:null,!0),f=add_param(f,"voi",d?d:null,!0),f=add_param(f,"du",e?e:null,!0),f=add_param(f,"send",1,!0),f=add_param(f,"openid",null,!0),f=add_param(f,"headimgurl",null,!0),f=add_param(f,"nickname",null,!0),f=add_param(f,"ud",null,!0),f=add_param(f,"roi",null,!0),console.log(f),add_yao_prefix(f)},getFuUrl:function(a,b){var c=window.location.href;return c=c.replace(/[^\/]*\.html/i,"unlock.html"),c=add_param(c,"resopenid",hex_md5(openid),!0),c=add_param(c,"from","share",!0),c=add_param(c,"ud",a,!0),c=add_param(c,"roi",b,!0),c=add_param(c,"openid",null,!0),c=add_param(c,"headimgurl",null,!0),c=add_param(c,"nickname",null,!0),c=add_param(c,"send",null,!0),console.log(c),add_yao_prefix(c)}},H.share.init()}(Zepto),function(a){H.zhibo={$dialogWrapper:a("#zhibo"),$dialog:a("#zhibo .dialog"),$tmpl:a("#tmpl_zhibo"),$tv:a("#tv"),$snow:a("#tv .tv-snow"),$cover:a("#tv .tv-cover"),$video:a("#zhibovideo"),videoData:null,showed:[],videoCounter:0,videoWidth:0,videoHeight:0,player:null,init:function(){getResult("api/article/list",null,"callbackArticledetailListHandler"),H.zhibo.resize(),H.zhibo.bindBtns()},beginCountdown:function(){if("index"==H.router.curSlide&&H.zhibo.$dialogWrapper.hasClass("none")&&H.cardGet.$dialogWrapper.hasClass("none")){var a=(new Date).getTime()-H.countdown.serverOffset;if(H.zhibo.videoData&&H.zhibo.videoData.length>0){var b=H.zhibo.videoData;for(var c in b){isShowed=!1;for(var d in H.zhibo.showed)b[c].uid==H.zhibo.showed[d]&&(isShowed=!0);if(!isShowed&&timestamp(b[c].bt)<a&&a<timestamp(b[c].et))return H.zhibo.show(b[c]),!0}}}setTimeout(function(){H.zhibo.beginCountdown()},500)},show:function(a){H.zhibo.showed.push(a.uid),H.zhibo.videoCounter++;var b='<iframe frameborder="0" style="width:'+parseInt(H.zhibo.videoWidth)+"px;height:"+parseInt(H.zhibo.videoHeight)+'px;" width="'+parseInt(H.zhibo.videoWidth)+'" height="'+parseInt(H.zhibo.videoHeight)+'"  src="'+a.gu+'" allowfullscreen></iframe>';H.zhibo.$cover.html(b),H.zhibo.$dialogWrapper.removeClass("none"),H.zhibo.$dialog.addClass("transparent"),setTimeout(function(){H.zhibo.$dialog.removeClass("transparent"),H.zhibo.$dialog.addClass("bounceInDown")},100),setTimeout(function(){H.zhibo.$snow.addClass("none"),H.zhibo.$cover.removeClass("none")},3e3)},close:function(){H.zhibo.$dialog.removeClass("bounceInDown").addClass("bounceOutUp"),setTimeout(function(){H.zhibo.$dialogWrapper.addClass("none"),H.zhibo.$dialog.removeClass("bounceOutUp"),H.zhibo.$cover.empty()},500),H.zhibo.beginCountdown()},bindBtns:function(){H.zhibo.$tv.tap(function(){return H.zhibo.player.play(),!1}),H.zhibo.$dialogWrapper.tap(function(){H.zhibo.close()})},resize:function(){var b=a(window).width(),c=(a(window).height(),424/296),d=.8*b,e=d/c;H.zhibo.videoWidth=.7*d,H.zhibo.videoHeight=.8*e}},W.callbackArticledetailListHandler=function(a){0==a.code&&(H.zhibo.videoData=a.arts,H.zhibo.beginCountdown())}}(Zepto),+function(a,b){a.Cartoon=function(a){this.defaultParam={element:"",delay:"",direction:"normal",duration:"",iteration_count:"",play_state:"",timing_function:"linear",animation_fill_mode:"",content:null,complete:null,isRemoveStyle:!1},a.constructor==Array&&(this.arr=a),this.initItem(),this.start(0)},Cartoon.prototype.initItem=function(){this.items=[];for(var a=0,b=this.arr.length;b>a;a++){var c=new this.arr[a];c.index=a,this.items.push(c)}},Cartoon.prototype.start=function(a){function c(a){function e(f,g){if(f.meanwhile&&f.meanwhile.length)for(var h=0,i=f.meanwhile.length;i>h;h++)e(new f.meanwhile[h],!0);var j={};for(var k in f)j[k]=f[k];var l={};for(var k in d.defaultParam)l[k]=d.defaultParam[k];var m=b.extend(l,j),n="pass_barrage";return m.before&&m.before(b(m.element),n),b(m.element).addClass(n),"infinite"==m.iteration_count?void(1e3*m.duration?setTimeout(function(){g||(a++,c(a))},1e3*m.duration):g||(a++,c(a))):void function(b,d,e){setTimeout(function(){e.animation_fill_mode||s.remove(),e.complete&&e.complete(b,n),e.stop||g||(a++,c(a))},d)}(b(m.element),1e3*m.duration,m,n)}if(!(a>=d.items.length)){var f=d.items[a];e(f)}}var d=this;c(a)},rollingRecord=function(a){rollingRecord.param=b.extend({datas:[],items:[],width:300,height:50,container:null,interval:1e3},a||{});for(var c in rollingRecord.param)this[c]=rollingRecord.param[c];this.init()},rollingRecord.prototype.init=function(){this.loadData(),this.setCss()},rollingRecord.prototype.loadData=function(){W.roll=this,W.isFirstLoad=!0,this.loadFn()},rollingRecord.prototype.loadFn=function(){getResult("api/lottery/allrecord",{ps:10},"callbackLotteryAllRecordHandler")},rollingRecord.prototype.setCss=function(){this.container.empty().css({width:this.width,height:this.height,overflow:"hidden"}),this.rollingRecord=b("<div class='rollingRecord' style='visibility:hidden; '></div>"),this.rollingRecord.css({width:this.width,height:2*this.height}),this.container.append(this.rollingRecord)},rollingRecord.prototype.createHtml=function(a){var c=b("<div class='lan_item'></div>");c.css({display:"block;",width:this.width,height:this.height,overflow:"hidden","text-align":"center","line-height":this.height+"px"}),this.items.push(c),this.rollingRecord.append(c);var d=c.clone(!0);if(this.items.push(d),this.rollingRecord.append(d),0!=this.datas.length){if(1==this.datas.length)return void this.items[0].html(this.datas[0]);this.items[0].html(this.datas[0]),this.items[1].html(this.datas[1]),a&&a()}},rollingRecord.prototype.appendData=function(a){this.datas.length>50&&this.datas.splice(0,1),this.datas[this.datas.length]=a},rollingRecord.prototype.startAn=function(){function a(){b.CartoonObj=null,b.CartoonObj=new Cartoon([function(){this.element=b.rollingRecord,this.duration=b.interval/1e3,this.animation_fill_mode="forwards",this.isRemoveStyle=!0,this.content=function(){var a=[];return a.push("0% {  -webkit-transform: translateY(-0px) }"),a.push("100% {  -webkit-transform: translateY(-"+b.height+"px)}"),a.join("")},this.before=function(){if(c)c=!1;else{var a=b.turnCount;a++,a>b.datas.length-1&&(a=0),b.items[1].html(b.datas[a])}},this.complete=function(c,d){b.turnCount++,b.turnCount>b.datas.length-1&&(b.turnCount=0),b.items[0].html(b.datas[b.turnCount]),b.rollingRecord.removeClass(b.lastClassName),b.lastClassName=d,setTimeout(function(){a()},1500)}}])}var b=this,c=!0;b.turnCount=0,b.lastClassName="",setTimeout(function(){a()},b.interval)},rollingRecord.prototype.stop=function(){this.Winterval&&clearInterval(this.Winterval)};var c=b(".rollingrecord-wrapper"),d=b(window).width();new rollingRecord({width:d,height:32,container:c})}(window,Zepto),W.callbackLotteryAllRecordHandler=function(a){if(1==a.result)if(W.isFirstLoad){W.isFirstLoad=!1;for(var b=[],c=0;c<a.rl.length;c++){var d=a.rl[c];b.push((d.un||"匿名用户")+"获得"+d.pn)}W.roll.datas=b,b.length>0&&W.roll.rollingRecord.css("visibility","visible"),W.roll.createHtml(function(){W.roll.startAn()})}else for(var b=[],c=0;c<a.rl.length;c++){var d=a.rl[c];W.roll.appendData((d.un||"匿名用户")+"获得"+d.pn)}setTimeout(function(){W.roll.loadFn()},5e3)},function(a){H.rule={$dialogWrapper:a("#rule_dialog"),$dialog:a("#rule_dialog .dialog"),$list:a("#rule_dialog .rule-list"),init:function(){this.resize(),this.bindBtns()},resize:function(){var b=a(window).height(),c=.8*b;H.rule.$dialog.css({top:.1*b,height:c}),H.rule.$list.css({height:c-10-49})},showDialog:function(){H.rule.$dialogWrapper.removeClass("none"),H.rule.$dialog.addClass("transparent"),setTimeout(function(){H.rule.$dialog.removeClass("transparent"),H.rule.$dialog.addClass("fadeInUp")},100)},hideDialog:function(){H.rule.$dialog.removeClass("fadeInUp").addClass("fadeOutDown"),setTimeout(function(){H.rule.$dialogWrapper.addClass("none"),H.rule.$dialog.removeClass("fadeOutDown")},400)},bindBtns:function(){a(window).height();a("#btn_rule_close").tap(function(){return H.rule.hideDialog(),!1}),a("#rule_btn").tap(function(){return H.rule.showDialog(),!1})}},H.rule.init()}(Zepto),function(a,b){a.Subscribe=function(a){this.appid="wxca9de9df38b0951e",this.type=a&&a.type||2,this.selector=a&&a.selector||"div_subscribe_area",this.sub_contain=b('<div id="'+this.selector+'" class="none '+this.selector+'"></div>')},Subscribe.prototype.setCss=function(){var a={position:"fixed",bottom:"0",left:"0",width:"100%",height:"50px",overflow:"hidden","z-index":"9999999"};this.sub_contain.css(a)},Subscribe.prototype.appendHtml=function(){b("#cover").append(this.sub_contain),this.setCss()},Subscribe.prototype.shaketv_subscribe=function(){a.shaketv&&shaketv.subscribe({appid:this.appid,selector:"#"+this.selector,type:this.type},function(a){})},Subscribe.prototype.switch_state=function(){-1==a.location.href.indexOf("cb41faa22e731e9b")?this.sub_contain.addClass("none").css("height","0"):this.sub_contain.removeClass("none").css("height","50px")},Subscribe.prototype.initEvent=function(){if(a.shaketv)this.shaketv_subscribe(),this.switch_state();else{var b=this;b.shaketvCount=0,a.shaketvInterval=setInterval(function(){b.shaketvCount++,a.shaketv&&(b.shaketv_subscribe(),b.switch_state(),clearInterval(a.shaketvInterval)),b.shaketvCount>10&&(clearInterval(a.shaketvInterval),b.shaketvCount=0)},1e3)}},Subscribe.prototype.init=function(){this.appendHtml(),this.initEvent()},(new Subscribe).init()}(window,Zepto),function(a){H.index={cardItemHeight:0,$countDownTips:a("#tips_countdown"),$tangyuan:a(".index-header-link"),$defaultTangyuan:a("#default_tangyuan"),$selectedTangyuan:a("#selected_tangyuan"),$tangyuanType:a(".icon-tangyuan-bg"),$tangyuanFace:a(".icon-tangyuan-face"),$tangyuanVoice:a(".index-tangyuan-voice"),init:function(){H.topic.init(),H.index.bindBtns(),H.index.initTangyuan(),H.card.getCards()},initTangyuan:function(){var a=localStorage.getItem(openid+LS_KEY_PET_ID);H.index.updateTangyuan(a)},updateTangyuan:function(a){if(a){var b="a";b=1==a?"a":2==a?"b":3==a?"c":"d",H.index.$defaultTangyuan.addClass("none"),H.index.$selectedTangyuan.removeClass("none"),H.index.$tangyuanType.attr("src","http://yaotv.qq.com/shake_tv/auto2/2016/01/957pprijv1qnhi/images/tangyuan/yuan_"+b+"_01.png"),H.index.$tangyuan.removeClass("noEgg")}else H.index.$tangyuan.addClass("noEgg")},bindBtns:function(){a("#index .index-countdown").tap(function(){return a(this).hasClass("active")?(H.router.slideTo("yao"),!1):(H.index.$countDownTips.removeClass("none"),void setTimeout(function(){H.index.$countDownTips.addClass("none")},3e3))}),a("#btn_yao").tap(function(){return H.countdown.isYaoActive?(H.router.slideTo("yao"),!1):void 0}),H.vip.$btnOpen.tap(function(){a(this).hasClass("ready")?H.vip.show():showTips("终极抽奖准备中")}),H.index.$tangyuan.tap(function(){if(!H.index.$tangyuan.hasClass("moving")){H.index.$tangyuan.addClass("moving");var b=Math.floor(4*Math.random()),c="click-"+b;a(this).addClass(c);var d=Math.floor(8*Math.random());H.index.$tangyuanFace.attr("src","http://yaotv.qq.com/shake_tv/auto2/2016/01/957pprijv1qnhi/images/tangyuan/yuan_bq_0"+(d+1)+".png"),setTimeout(function(){H.index.$tangyuan.removeClass(c),H.index.$tangyuan.removeClass("moving")},1e3);var e=["养我养我","节目好看不？","嘿嘿嘿","新年快乐","嗝~"],f=Math.floor(5*Math.random());H.index.$tangyuanVoice.removeClass("zoom-out").addClass("zoom-in").text(e[f]),setTimeout(function(){H.index.$tangyuanVoice.removeClass("zoom-in"),setTimeout(function(){H.index.$tangyuanVoice.addClass("zoom-out")},800)},500)}a(this).hasClass("noEgg")?H.tangyuan.show():setTimeout(function(){H.tangyuan.showEgg(localStorage.getItem(openid+LS_KEY_PET_ID))},800)}),H.index.$tangyuan.hasClass("noEgg")||setInterval(function(){if(!H.index.$tangyuan.hasClass("moving")){H.index.$tangyuan.addClass("moving");var a=Math.floor(4*Math.random()),b="click-"+a;H.index.$tangyuan.addClass(b);var c=Math.floor(8*Math.random());H.index.$tangyuanFace.attr("src","http://yaotv.qq.com/shake_tv/auto2/2016/01/957pprijv1qnhi/images/tangyuan/yuan_bq_0"+(c+1)+".png"),setTimeout(function(){H.index.$tangyuan.removeClass(b),H.index.$tangyuan.removeClass("moving")},1e3);var d=["养我养我","节目好看不？","嘿嘿嘿","新年快乐","嗝~"],e=Math.floor(5*Math.random());H.index.$tangyuanVoice.removeClass("zoom-out").addClass("zoom-in").text(d[e]),setTimeout(function(){H.index.$tangyuanVoice.removeClass("zoom-in"),setTimeout(function(){H.index.$tangyuanVoice.addClass("zoom-out")},800)},500)}},2e4),a("#btn_suning").tap(function(){location.href="http://c.m.suning.com/channel/2016xinnian.html"}),a("#btn_didi").tap(function(){location.href="http://community.xiaojukeji.com/market/stars_jiangsu/"}),a("#btn_biaoqing").tap(function(){location.href="http://w.url.cn/s/Aq3Ca9G#wechat_redirect"})},resize:function(){var b=a(window).width(),c=a(window).height(),d=27,e=640/187,f=577/66,g=12.8,h=20,i=8,j=17,k=40,l=b/e,m=b/h,n=(b-2*m)/f,o=22,p=b/g+j,q=62,r=c-k-l-n-o-p-q-d;a("#index .index-header").css({height:k+"px","background-size":b+"px "+k+"px"}).bind("touchmove",function(){return!1}),a("#index .index-cards").css({height:l+"px","background-size":b+"px "+l+"px"}),a("#index .index-countdown").css({width:b-2*m,height:n+"px","background-size":b-2*m+"px "+n+"px",margin:"0 auto"}).bind("touchmove",function(){return!1}),a("#index .index-topic").css({height:o,"padding-left":i,"padding-right":i}).bind("touchmove",function(){return!1}),a("#index .index-comment-nav").css({height:p}).bind("touchmove",function(){return!1}),a("#index .index-comment-list").css({height:r}),a("#index .index-comment-input").css({height:q}),a("#index .index-comment-bg").css({height:q+r,width:b});var s=640/70,t=640/34,u=640/60,v=640/46,w=128,x=b/s,y=5,z=b-x-b/t;a("#index .index-cards .index-cards-btns").css({"padding-top":(l-2*x-y)/2}),a("#index .index-cards .index-cards-btn").css({width:x,height:x,"background-size":x+"px "+x+"px"});var A=b/u,B=b/v;a("#index .index-cards .index-cards-content-inner").css({"margin-left":A,"margin-right":B,width:z-A-B}),a("#index .index-cards .index-cards-item").css({"margin-right":b/w,"margin-left":b/w});var C=H.index.cardItemHeight=(z-A-B-6*(b/w))/3;a("#index .index-cards .index-cards-content").css({width:z,"padding-top":(l-C)/2}),H.card.cardY=43+(l-C)/2+C/2,H.card.cardX=A,H.card.cardWidth=C+b/w*2,H.card.card2Left=H.card.cardX+H.card.cardWidth,H.card.card3Left=H.card.cardX+2*H.card.cardWidth;var D=640/27,E=640/37,F=640/12,G=640/520,I=3.8,J=38/13;a("#bar_countdown").css({top:(b-2*m)/D,left:(b-2*m)/E,height:(b-2*m)/F,width:(b-2*m)/G}),a("#bar_countdown .bar-blink-wrapper").css({"-webkit-border-radius":(b-2*m)/F/2,"border-radius":(b-2*m)/F/2}),a(".index-countdown .bar-yao-btn").css({width:1.2*n,height:1.2*n});var K=(b-2*m)/F*I,L=(b-2*m)/F;a("#bar_countdown .bar-blink").css({height:L,width:K,"background-size":K+"px "+L+"px",right:-1*(K/J)}),a(".index-countdown .bar-tips-arrow").css({left:(b-2*m-20)/2});var M=4,N=12.8,O=640/63,P=12.8,Q=b/M,R=b/N,S=b/O,T=b/P;a(".nav-list-item").css({width:Q,height:R,"line-height":R+"px","background-size":Q+"px "+R+"px"}),a(".index-comment-nav-list .sper").css({width:S,height:T,"background-size":S+"px "+T+"px"});var U=a(".nav-list-item").length;a(".index-comment-nav-list").css({width:U*Q+(U-1)*S}),H.guide.doorWidth=x,H.guide.doorHeight=x,H.guide.doorLeft=z,H.guide.doorTop=x+(l-2*x-y)/2+6+3+40,H.guide.countDownWidth=b-2*m,H.guide.countDownHeight=n,H.guide.countDownLeft=m,H.guide.countDownTop=51+l,H.guide.unlockWidth=C,H.guide.unlockHeight=C,H.guide.unlockLeft=A,H.guide.unlockTop=43+(l-C)/2,H.guide.resize()}}}(Zepto);