function hex_md5(a){return rstr2hex(rstr_md5(str2rstr_utf8(a)))}function hex_hmac_md5(a,b){return rstr2hex(rstr_hmac_md5(str2rstr_utf8(a),str2rstr_utf8(b)))}function md5_vm_test(){return"900150983cd24fb0d6963f7d28e17f72"==hex_md5("abc").toLowerCase()}function rstr_md5(a){return binl2rstr(binl_md5(rstr2binl(a),8*a.length))}function rstr_hmac_md5(a,b){var c=rstr2binl(a);c.length>16&&(c=binl_md5(c,8*a.length));for(var d=Array(16),e=Array(16),f=0;16>f;f++)d[f]=909522486^c[f],e[f]=1549556828^c[f];var g=binl_md5(d.concat(rstr2binl(b)),512+8*b.length);return binl2rstr(binl_md5(e.concat(g),640))}function rstr2hex(a){try{}catch(b){hexcase=0}for(var c,d=hexcase?"0123456789ABCDEF":"0123456789abcdef",e="",f=0;f<a.length;f++)c=a.charCodeAt(f),e+=d.charAt(c>>>4&15)+d.charAt(15&c);return e}function str2rstr_utf8(a){for(var b,c,d="",e=-1;++e<a.length;)b=a.charCodeAt(e),c=e+1<a.length?a.charCodeAt(e+1):0,b>=55296&&56319>=b&&c>=56320&&57343>=c&&(b=65536+((1023&b)<<10)+(1023&c),e++),127>=b?d+=String.fromCharCode(b):2047>=b?d+=String.fromCharCode(192|b>>>6&31,128|63&b):65535>=b?d+=String.fromCharCode(224|b>>>12&15,128|b>>>6&63,128|63&b):2097151>=b&&(d+=String.fromCharCode(240|b>>>18&7,128|b>>>12&63,128|b>>>6&63,128|63&b));return d}function rstr2binl(a){for(var b=Array(a.length>>2),c=0;c<b.length;c++)b[c]=0;for(var c=0;c<8*a.length;c+=8)b[c>>5]|=(255&a.charCodeAt(c/8))<<c%32;return b}function binl2rstr(a){for(var b="",c=0;c<32*a.length;c+=8)b+=String.fromCharCode(a[c>>5]>>>c%32&255);return b}function binl_md5(a,b){a[b>>5]|=128<<b%32,a[(b+64>>>9<<4)+14]=b;for(var c=1732584193,d=-271733879,e=-1732584194,f=271733878,g=0;g<a.length;g+=16){var h=c,i=d,j=e,k=f;c=md5_ff(c,d,e,f,a[g+0],7,-680876936),f=md5_ff(f,c,d,e,a[g+1],12,-389564586),e=md5_ff(e,f,c,d,a[g+2],17,606105819),d=md5_ff(d,e,f,c,a[g+3],22,-1044525330),c=md5_ff(c,d,e,f,a[g+4],7,-176418897),f=md5_ff(f,c,d,e,a[g+5],12,1200080426),e=md5_ff(e,f,c,d,a[g+6],17,-1473231341),d=md5_ff(d,e,f,c,a[g+7],22,-45705983),c=md5_ff(c,d,e,f,a[g+8],7,1770035416),f=md5_ff(f,c,d,e,a[g+9],12,-1958414417),e=md5_ff(e,f,c,d,a[g+10],17,-42063),d=md5_ff(d,e,f,c,a[g+11],22,-1990404162),c=md5_ff(c,d,e,f,a[g+12],7,1804603682),f=md5_ff(f,c,d,e,a[g+13],12,-40341101),e=md5_ff(e,f,c,d,a[g+14],17,-1502002290),d=md5_ff(d,e,f,c,a[g+15],22,1236535329),c=md5_gg(c,d,e,f,a[g+1],5,-165796510),f=md5_gg(f,c,d,e,a[g+6],9,-1069501632),e=md5_gg(e,f,c,d,a[g+11],14,643717713),d=md5_gg(d,e,f,c,a[g+0],20,-373897302),c=md5_gg(c,d,e,f,a[g+5],5,-701558691),f=md5_gg(f,c,d,e,a[g+10],9,38016083),e=md5_gg(e,f,c,d,a[g+15],14,-660478335),d=md5_gg(d,e,f,c,a[g+4],20,-405537848),c=md5_gg(c,d,e,f,a[g+9],5,568446438),f=md5_gg(f,c,d,e,a[g+14],9,-1019803690),e=md5_gg(e,f,c,d,a[g+3],14,-187363961),d=md5_gg(d,e,f,c,a[g+8],20,1163531501),c=md5_gg(c,d,e,f,a[g+13],5,-1444681467),f=md5_gg(f,c,d,e,a[g+2],9,-51403784),e=md5_gg(e,f,c,d,a[g+7],14,1735328473),d=md5_gg(d,e,f,c,a[g+12],20,-1926607734),c=md5_hh(c,d,e,f,a[g+5],4,-378558),f=md5_hh(f,c,d,e,a[g+8],11,-2022574463),e=md5_hh(e,f,c,d,a[g+11],16,1839030562),d=md5_hh(d,e,f,c,a[g+14],23,-35309556),c=md5_hh(c,d,e,f,a[g+1],4,-1530992060),f=md5_hh(f,c,d,e,a[g+4],11,1272893353),e=md5_hh(e,f,c,d,a[g+7],16,-155497632),d=md5_hh(d,e,f,c,a[g+10],23,-1094730640),c=md5_hh(c,d,e,f,a[g+13],4,681279174),f=md5_hh(f,c,d,e,a[g+0],11,-358537222),e=md5_hh(e,f,c,d,a[g+3],16,-722521979),d=md5_hh(d,e,f,c,a[g+6],23,76029189),c=md5_hh(c,d,e,f,a[g+9],4,-640364487),f=md5_hh(f,c,d,e,a[g+12],11,-421815835),e=md5_hh(e,f,c,d,a[g+15],16,530742520),d=md5_hh(d,e,f,c,a[g+2],23,-995338651),c=md5_ii(c,d,e,f,a[g+0],6,-198630844),f=md5_ii(f,c,d,e,a[g+7],10,1126891415),e=md5_ii(e,f,c,d,a[g+14],15,-1416354905),d=md5_ii(d,e,f,c,a[g+5],21,-57434055),c=md5_ii(c,d,e,f,a[g+12],6,1700485571),f=md5_ii(f,c,d,e,a[g+3],10,-1894986606),e=md5_ii(e,f,c,d,a[g+10],15,-1051523),d=md5_ii(d,e,f,c,a[g+1],21,-2054922799),c=md5_ii(c,d,e,f,a[g+8],6,1873313359),f=md5_ii(f,c,d,e,a[g+15],10,-30611744),e=md5_ii(e,f,c,d,a[g+6],15,-1560198380),d=md5_ii(d,e,f,c,a[g+13],21,1309151649),c=md5_ii(c,d,e,f,a[g+4],6,-145523070),f=md5_ii(f,c,d,e,a[g+11],10,-1120210379),e=md5_ii(e,f,c,d,a[g+2],15,718787259),d=md5_ii(d,e,f,c,a[g+9],21,-343485551),c=safe_add(c,h),d=safe_add(d,i),e=safe_add(e,j),f=safe_add(f,k)}return Array(c,d,e,f)}function md5_cmn(a,b,c,d,e,f){return safe_add(bit_rol(safe_add(safe_add(b,a),safe_add(d,f)),e),c)}function md5_ff(a,b,c,d,e,f,g){return md5_cmn(b&c|~b&d,a,b,e,f,g)}function md5_gg(a,b,c,d,e,f,g){return md5_cmn(b&d|c&~d,a,b,e,f,g)}function md5_hh(a,b,c,d,e,f,g){return md5_cmn(b^c^d,a,b,e,f,g)}function md5_ii(a,b,c,d,e,f,g){return md5_cmn(c^(b|~d),a,b,e,f,g)}function safe_add(a,b){var c=(65535&a)+(65535&b),d=(a>>16)+(b>>16)+(c>>16);return d<<16|65535&c}function bit_rol(a,b){return a<<b|a>>>32-b}function recordUserPage(a,b,c){recordUserLog(a,b,"",c,"true")}var hexcase=0,__ns=function(fullNs){for(var nsArray=fullNs.split("."),evalStr="",ns="",i=0,l=nsArray.length;l>i;i++)0!==i&&(ns+="."),ns+=nsArray[i],evalStr+="( typeof "+ns+' === "undefined" && ('+ns+" = {}) );";""!==evalStr&&eval(evalStr)},__noop=function(){},W=W||window;__ns("H");var getQueryString=function(a){var b=decodeURIComponent(location.search.slice(1));if(""!=b){for(var c=b.split("&"),d=0,e=c.length;e>d;d++){var f=c[d].search("="),g=c[d].substring(0,f),h=c[d].substring(f+1,c[d].length);if(g===a)return h}return""}return""},from=getQueryString("from"),gefrom=from||getQueryString("gefrom"),recordUserLog=function(a,b,c,d,e){$.ajax({type:"get",async:!0,url:domain_url+"api/common/reportlog",dataType:"jsonp",jsonp:"callback",data:{openid:a,operateDesc:encodeURIComponent(b),operateDomId:c,loadingTime:d,flag:e}})},recordUserOperate=function(a,b,c){recordUserLog(a,b,c,"","false")},callbackUserSaveHandler=function(a){};$(function(){recordUserPage(openid,$("title").html(),""),$("body").delegate("*[data-collect='true']","click",function(a){a.preventDefault(),"true"==$(this).attr("data-stoppropagation")&&a.stopPropagation(),recordUserOperate(openid,$(this).attr("data-collect-desc"),$(this).attr("data-collect-flag"));var b=$(this).attr("href");b&&"#"!==b&&(gefrom&&(b=add_param(b,"gefrom",gefrom,!0)),setTimeout(function(){window.location.href=b},5))})});var getUrl=function(){var a=window.location.href;return a=share_page?a.replace(/[^\/]*\.html/i,share_page):a.replace(/[^\/]*\.html/i,"index.html"),a=add_param(a,"resopenid",hex_md5(openid),!0),a=add_param(a,"from","share",!0),a=add_param(a,"openid",null,!0),a=add_param(a,"headimgurl",null,!0),a=add_param(a,"nickname",null,!0),add_yao_prefix(a)},add_param=function(a,b,c,d){(null==a||0==a.length)&&(a=document.location.href);var e=a.split("?"),f="";if(e.length>1)for(var g=e[1].split("&"),h=0;h<g.length;h++){var i=g[h].search("="),j=g[h].substring(0,i),k=g[h].substring(i+1,g[h].length);d&&j==b||(""==f?f="?":f+="&",f+=j+"="+k)}return null!==c&&(""==f?f="?":f+="&",f+=b+"="+c),e[0]+f},add_yao_prefix=function(a){return"http://yao.qq.com/tv/entry?redirect_uri="+encodeURIComponent(a)};$(function(){$.ajax({type:"get",async:!1,url:domain_url+"api/common/versioncheck",dataType:"jsonp",jsonp:"callback",jsonpCallback:"commonApiVersionHandler",success:function(a){a.result||(location.href=a.redirect),share_img=share_img?share_img:a.si,share_title=share_title?share_title:a.st,share_desc=share_desc?share_desc:a.sd,window.shaketv&&shaketv.wxShare(share_img,share_title,share_desc,getUrl())},error:function(){}})});var getResult=function(a,b,c,d,e,f,g,h,i){e&&showLoading(f);var a=domain_url+a;"undefined"!=typeof isDev&&isDev.length>0&&(a=add_param(a,"dev",isDev,!0)),$.ajax({type:"GET",async:"undefined"==typeof g?!1:g,url:a,data:b,dataType:"jsonp",jsonpCallback:c,timeout:h?h:0,complete:function(){e&&hideLoading(f)},error:function(){$.isFunction(i)&&i()},success:function(a){$.isFunction(d)&&d(a)}})},simpleTpl=function(a){return a=$.isArray(a)?a.join(""):a||"",{store:a,_:function(){var a=this;return $.each(arguments,function(b,c){a.store+=c}),this},toString:function(){return this.store}}},showLoading=function(a,b){var c=simpleTpl(),a=($(window).width(),$(window).height(),a||$("body")),d=a?a.find("#qy_loading"):$("body").children("#qy_loading"),b=b||"努力加载中...";d.length>0&&d.remove(),c._('<section id="qy_loading" class="qy-loading">')._('<section class="qy-loading-logo">')._('<section class="qy-logo-1"></section>')._('<section class="qy-logo-2"></section>')._("</section>")._('<section class="qy-loading-tips">'+b+"</section>")._("</section>"),a.append(c.toString())},hideLoading=function(a){a?a.find("#qy_loading").remove():$("body").children("#qy_loading").remove()};$(function(){var a=$(".copyright");a&&W.copyright&&a.html(W.copyright)});var aniTrue=!0,showTips=function(a,b,c){if(aniTrue){aniTrue=!1;var b=b||"2",c=c||1500;$("body").append('<div class="tips none"></div>'),$(".tips").css({position:"fixed","max-width":"80%",top:"60%",left:"50%","z-index":"99999999",color:"rgb(255, 255, 255)",padding:"20px 10px","border-radius":"5px","margin-left":"-120px",background:"rgba(0, 0, 0, 0.8)","text-align":"center"}),$(".tips").html(a);var d=($(window).width(),$(window).height());$(".tips").removeClass("none").css("opacity","0");var e=$(".tips").width(),f=$(".tips").height();$(".tips").css({"margin-left":-e/2,top:(d-f)/(b-.2)}).removeClass("none"),$(".tips").animate({opacity:"1",top:(d-f)/b},300,function(){setTimeout(function(){$(".tips").animate({opacity:"0"},300,function(){$(".tips").addClass("none").css("top",(d-f)/(b-.2))})},c),setTimeout(function(){$(".tips").remove(),aniTrue=!0},c+350)})}};!function(a){a.yao_scope="userinfo",a.openid=$.fn.cookie(mpappid+"_openid"),a.headimgurl=$.fn.cookie(mpappid+"_headimgurl"),a.nickname=$.fn.cookie(mpappid+"_nickname"),a.expires_in={expires:30},a.Authorize=function(a){this.mpappid=a&&a.mpappid||mpappid,this.serviceNo=a&&a.serviceNo||serviceNo,this.scope="snsapi_userinfo",this.redirect_uri=domain_url+"api/mp/auth/snsapi_userinfo",this.callBackPage=a&&a.callBackPage||"",this.param=""},Authorize.prototype.authorize=function(a){window.location.href="https://open.weixin.qq.com/connect/oauth2/authorize?appid="+this.mpappid+"&redirect_uri="+encodeURIComponent(this.redirect_uri+"?callBackPage="+this.callBackPage+"&param="+this.param)+"&response_type=code&scope="+this.scope+"&state="+this.serviceNo+"#wechat_redirect",a&&a()},Authorize.prototype.checkIsAuthorize=function(){return $.fn.cookie(mpappid+"_openid")?!0:!1},Authorize.prototype.getQueryParam=function(a){var b=decodeURIComponent(location.search.slice(1));if(""!=b){for(var c=b.split("&"),d=0,e=c.length;e>d;d++){var f=c[d].search("="),g=c[d].substring(0,f),h=c[d].substring(f+1,c[d].length);if(g===a)return h}return""}return""},Authorize.prototype.jumpToUrl=function(){this.callBackPage&&(window.location.href=this.callBackPage)},Authorize.prototype.getParam=function(){for(var a={},b=decodeURIComponent(location.search.slice(1)).split("&"),c=0,d=b.length;d>c;c++){var e=b[c].search("="),f=b[c].substring(0,e),g=b[c].substring(e+1,b[c].length);a[f]=g}this.param=encodeURIComponent(JSON.stringify(a))},Authorize.prototype.init=function(a){this.getParam();var b=this;openid&&nickname?($.fn.cookie(mpappid+"_openid",openid,d),a&&setTimeout(function(){a()},50)):(openid=b.getQueryParam("openid"),openid&&$.fn.cookie(mpappid+"_openid",openid,d),openid||b.authorize(function(){})),headimgurl?$.fn.cookie(mpappid+"_headimgurl",headimgurl,d):(headimgurl=b.getQueryParam("headimgurl"),headimgurl&&$.fn.cookie(mpappid+"_headimgurl",headimgurl,d)),nickname?$.fn.cookie(mpappid+"_nickname",nickname,d):(nickname=b.getQueryParam("nickname"),nickname&&$.fn.cookie(mpappid+"_nickname",nickname,d))};var b="base",c=$.fn.cookie(shaketv_appid+"_openid"),d={expires:30},e=(window.location.href,0),f=function(){return window.shaketv?void(c?$.fn.cookie(shaketv_appid+"_openid",c,d):shaketv.authorize(shaketv_appid,b,function(a){0==a.errorCode&&g(a.code)})):!1},g=function(b){e>0||(e++,$.ajax({type:"GET",async:!1,url:domain_url+"shaketv/yaotv/userinfo",data:{code:b,mpopenid:a.openid},dataType:"jsonp",jsonpCallback:"callbackShaketvYaotvUserinfoHandler",success:function(a){"undefined"!=typeof a.errcode&&a.errcode>0||(c=a.openid,a.openid&&$.fn.cookie(shaketv_appid+"_openid",a.openid,d))}}))};new Authorize({callBackPage:"index.html"}).init(f())}(window);var imgReady=function(){var a=[],b=null,c=function(){for(var b=0;b<a.length;b++)a[b].end?a.splice(b--,1):a[b]();!a.length&&d()},d=function(){clearInterval(b),b=null};return function(d,e,f,g){var h,i,j,k,l,m=new Image;return m.src=d,m.complete?(e.call(m),void(f&&f.call(m))):(i=m.width,j=m.height,m.onerror=function(){g&&g.call(m),h.end=!0,m=m.onload=m.onerror=null},h=function(){k=m.width,l=m.height,(k!==i||l!==j||k*l>1024)&&(e.call(m),h.end=!0)},h(),m.onload=function(){!h.end&&h(),f&&f.call(m),m=m.onload=m.onerror=null},void(h.end||(a.push(h),null===b&&(b=setInterval(c,40)))))}}();!function(a){a.fn.tmpl=function(b){var c=a(this[0]).html().trim();if(c=c.replace("<table>",""),c=c.replace("</table>",""),c=c.replace("<tbody>",""),c=c.replace("</tbody>",""),b)for(k in b)c=c.replace(new RegExp("\\${"+k+"}","g"),b[k]);return c}}(Zepto),function(a){H.router={curUrl:"cover",$pagerSlide:a(".pager-slide"),init:function(){window.addEventListener("popstate",function(a){H.router.load()}),H.router.load(),H.router.initNav()},load:function(){if("#"===window.location.hash||""===window.location.hash)H.router.to("cover");else{var a=window.location.hash;a=a.substr(1,a.length),H.router.show(a)}},to:function(a){history.pushState({},"",location.href.split("#")[0]+"#"+a),H.router.show(a)},show:function(b){if(H.router.curUrl=b,"cover"==b)a("#page_cover").removeClass("none"),setTimeout(function(){a("#page_cover").css({"-webkit-transform":"translate(0px, 0px)",transform:"translate(0px, 0px)",opacity:"1"}),a(".pager-wrapper").addClass("none")},10);else{a("#page_cover").addClass("none"),a(".pager-wrapper").removeClass("none");var c=a(window).width();window.scroll(0,0),H.router.$pagerSlide.css({"-webkit-transform":"translate("+-1*a("#page_"+b).index()*c+"px, 0)",transform:"translate("+-1*a("#page_"+b).index()*c+"px, 0)"}),"comment"==b?a("body").css({height:a(window).height()}):a("body").css({height:"auto"}),H.router.updateNav()}return!1},initNav:function(){a("#btn_comment").tap(function(){H.router.to("comment")}),a("#btn_vote").tap(function(){H.router.to("vote")}),a("#btn_disclose").tap(function(){H.router.to("disclose")}),a("#btn_back").tap(function(){H.router.to("cover")})},updateNav:function(){a(".nav-item").removeClass("active"),a("#btn_"+H.router.curUrl).length>0&&a("#btn_"+H.router.curUrl).addClass("active")}},H.router.init()}(Zepto),function(a){H.index={coverRatio:1242/1784,coverBtnTopRatio:1415/1784,coverBtnHeightRatio:124/1784,coverBtnRatio:361/124,$cover:a(".index-cover"),$btn:a("#cover_btn"),$page:a("#page_cover"),init:function(){this.resize(),this.bindBtn(),this.initAd()},initAd:function(){getResult("api/ad/get",{areaNo:W.adid},"callbackAdGetHandler")},fillAd:function(b){if(b.ads.length>0){var c=b.ads[0].p;imgReady(b.ads[0].p,function(){setTimeout(function(){a("#cover").attr("src",c).removeClass("transparent")},2e3)})}},bindBtn:function(){this.$btn.tap(function(){a(".pager-wrapper").removeClass("none"),a("#page_cover").css({"-webkit-transform":"translate(0px, 40px)",transform:"translate(0px, 40px)",opacity:"0"}),setTimeout(function(){a("#page_cover").addClass("none"),H.router.to("vote")},1e3)})},resize:function(){var b=a(window).width(),c=a(window).height(),d=b/this.coverRatio*this.coverBtnTopRatio,e=b/this.coverRatio*this.coverBtnHeightRatio,f=e*this.coverBtnRatio,g=(b-f)/2;this.$btn.css({width:f,height:e,top:d,left:g,"line-height":e+"px"}).removeClass("none"),this.$cover.css({height:b/this.coverRatio}),a(".pager").css({width:b}),a(".pager-wrapper").css({width:b}),a(".pager-slide").css({width:3*b}),a("#page_cover").css({height:c,width:b})}},W.callbackAdGetHandler=function(a){0==a.code&&H.index.fillAd(a)},a(function(){H.index.init()})}(Zepto),function(a){H.vote={questionData:null,answerData:null,supportData:null,curAnswerId:null,selectedAuid:null,isVoted:!1,$banner:a("#banner"),$topic:a("#topic"),$answerWrapper:a("#answer_wrapper"),$tmplAnswer:a("#tmpl_answer"),init:function(){getResult("api/question/round",{},"callbackQuestionRoundHandler"),this.bindBtn()},initVotes:function(){var a=H.vote.questionData;H.vote.$banner.attr("src",a.bi),H.vote.$topic.text(a.qt);var b=H.vote.getAvatars(a.dc),c="";for(var d in a.aitems)c+=H.vote.$tmplAnswer.tmpl({avatar:b&&b[d]?b[d]:"./images/avatar.jpg",id:a.aitems[d].auid,content:a.aitems[d].at});H.vote.$answerWrapper.html(c),H.vote.updateMyVoted(),H.vote.bindVoteEvent()},updateMyVoted:function(){var b=H.vote.answerData;b&&b.anws&&b.puid==H.vote.curAnswerId&&(a('.opinion-item[auid="'+b.anws+'"]').addClass("voted"),H.vote.isVoted=!0),1!=H.vote.isVoted&&a("#topic_tips").removeClass("none")},updateAfterVoted:function(){var b=H.vote.selectedAuid;a('.opinion-item[auid="'+b+'"]').addClass("voted"),a('.opinion-item[auid="'+b+'"]').find(".sum-plus").addClass("show"),a("#topic_tips").addClass("none");var c=H.vote.supportData;if(c&&c.aitems){for(var d in c.aitems)if(c.aitems[d].auid==b){c.aitems[d].supc+=1;break}H.vote.updateSupport(c)}},bindVoteEvent:function(){a(".opinion-item").tap(function(){a(this).hasClass("voted")||H.vote.isVoted?showTips("您已经投过票了哦<br/>点击 #有话说# 参与更多讨论"):(showLoading(null,"投票中"),H.vote.selectedAuid=a(this).attr("auid"),getResult("api/question/answer",{yoi:openid,suid:H.vote.curAnswerId,auid:H.vote.selectedAuid},"callbackQuestionAnswerHandler"))})},updateSupport:function(b){var c=0;for(var d in b.aitems)c+=parseInt(b.aitems[d].supc,10);for(var d in b.aitems){a('.opinion-item[auid="'+b.aitems[d].auid+'"]').find(".sum").text(b.aitems[d].supc);var e=0;c>0&&(e=Math.floor(100*b.aitems[d].supc/c)),a('.opinion-item[auid="'+b.aitems[d].auid+'"]').find(".per").text(e)}},getAvatars:function(a){return a=a.toString(),a.match(/http:.*?jpg/gi)},bindBtn:function(){a(".comment-link").tap(function(){H.router.to("comment")})}},W.callbackQuestionRoundHandler=function(a){0==a.code&&a.qitems&&a.qitems.length>0&&(H.vote.questionData=a.qitems[0],H.vote.curAnswerId=H.vote.questionData.quid,getResult("api/question/record",{quid:H.vote.questionData.quid,yoi:openid},"callbackQuestionRecordHandler"))},W.callbackQuestionRecordHandler=function(a){0==a.code&&(H.vote.answerData=a),H.vote.initVotes(),getResult("api/question/eachsupport",{quid:H.vote.questionData.quid},"callbackQuestionSupportHandler")},W.callbackQuestionSupportHandler=function(a){0==a.code&&(H.vote.supportData=a,H.vote.updateSupport(a))},W.callbackQuestionAnswerHandler=function(a){hideLoading(),0==a.code?(showTips("投票成功"),H.vote.isVoted=!0,H.vote.updateAfterVoted()):showTips("点击 #有话说# 参与更多讨论")},a(function(){H.vote.init()})}(Zepto),function(a){H.commentroom={$commentroomsWrapper:a(".commentroom-wrapper"),$commentrooms:a(".commentrooms"),$list:a(".commentrooms .commentrooms-list"),$inputWrapper:a(".commentrooms-input-wrapper"),$input:a("#commentroom_input"),$submit:a("#commentroom_submit"),curPage:1,pageSize:10,lastCommnet:"",totalHeight:0,scrollerHeight:0,isNewHeight:!1,isLoading:!1,isNoMore:!1,praisedUid:0,topicId:"",bannerRatio:1242/785,init:function(){this.resize(),this.bindBtn(),this.getList(this.curPage),this.curPage++},initTopic:function(a){H.commentroom.topicId=a,H.commentroom.init()},getList:function(a){H.commentroom.isLoading=!0,getResult("api/comments/list",{page:a,ps:this.pageSize,op:openid,dt:1,zd:0,anys:H.commentroom.topicId},"callbackCommentsList")},initcommentrooms:function(b){b.items.length<this.pageSize&&(this.isNoMore=!0);var c=simpleTpl();for(var d in b.items)c._(a("#tmpl_commentroom").tmpl({name:b.items[d].na,src:b.items[d].hu,content:b.items[d].co,praised:0==b.items[d].isp?"":"praised",uid:b.items[d].uid,pc:b.items[d].pc}));this.$list.append(c.toString()),this.bindPraise(),this.isNoMore&&this.$list.append('<section class="citem-no-more"></section>'),this.isNewHeight=!0},bindPraise:function(){this.$list.find(".citem-praise").unbind("click"),this.$list.find(".citem-praise").bind("click",function(){a(this).hasClass("praised")||(showLoading(null,"点赞发送中"),H.commentroom.praisedUid=a(this).attr("uid"),getResult("api/comments/praise",{uid:a(this).attr("uid"),op:openid},"callbackCommentsPraise"))})},bindBtn:function(){this.$submit.click(function(){var a=H.commentroom.$input.val();if(a.length>0){H.commentroom.lastCommnet=a,showLoading();var b={co:encodeURIComponent(a),op:openid,tid:"uuid",ty:2,nickname:nickname?encodeURIComponent(nickname):"",headimgurl:headimgurl?headimgurl:""};""!=H.commentroom.topicId?(b.ty=1,b.tid=H.commentroom.topicId):b.ty=2,getResult("api/comments/save",b,"callbackCommentsSave")}else alert("内容不能为空哦~")}),this.$commentrooms.scroll(function(){var a=H.commentroom.$commentrooms.scrollTop();return H.commentroom.isNewHeight&&(H.commentroom.isNewHeight=!1,H.commentroom.scrollerHeight=H.commentroom.$list.height()),H.commentroom.scrollerHeight-H.commentroom.totalHeight-a<10&&!H.commentroom.isLoading&&!H.commentroom.isNoMore&&(H.commentroom.getList(H.commentroom.curPage),H.commentroom.curPage++),!1})},submitSuccess:function(b){showTips("发送成功");var c=this.$input.val();this.$input.val(""),a(".citem-no-more").addClass("none");var d=simpleTpl();d._(a("#tmpl_commentroom").tmpl({name:nickname?nickname:"匿名用户",src:headimgurl?headimgurl:"./images/avatar.jpg",content:c,praised:0,uid:b.uid,pc:0})),this.$list.append(d.toString()),this.bindPraise(),a(".commentrooms")[0].scrollTop=a(".commentrooms-list").height()},resize:function(){var b=a(window).width(),c=a(window).height(),d=b/this.bannerRatio,e=40,f=c-d-e-5;this.$commentroomsWrapper.css({height:f}),this.totalHeight=f-44,this.$commentrooms.css("height",this.totalHeight).css("width",b),this.$input.val("")}},H.topic={$cover:a("#comment_cover"),init:function(){getResult("api/comments/topic/round",{},"callbackCommentsTopicInfo")},initTopic:function(a){a.items.length>0&&this.$cover.attr("src",a.items[0].im)}},W.callbackCommentsTopicInfo=function(a){0==a.code&&a.items?(H.topic.initTopic(a),H.commentroom.initTopic(a.items[0].uid)):showTips("暂无话题")},W.callbackCommentsList=function(b){H.commentroom.isLoading=!1,0==b.code?H.commentroom.initcommentrooms(b):0==a(".citem-no-more").length&&H.commentroom.$list.append('<section class="citem-no-more"></section>')},W.callbackCommentsSave=function(a){hideLoading(),0==a.code?H.commentroom.submitSuccess(a):alert("网络错误，请稍后重试")},W.callbackCommentsPraise=function(a){if(hideLoading(),0==a.code){showTips("点赞成功"),$item=H.commentroom.$list.find('.citem-praise[uid="'+H.commentroom.praisedUid+'"] .pc-num');var b=parseInt($item.html(),10);$item.html(++b).parent().addClass("praised"),$item.parents(".citem").addClass("praised")}else showTips("网络不给力，请稍后重试")},a(function(){H.topic.init()})}(Zepto),function(a,b){b.fn.upload=function(a){b.fn.upload.defaults={url:"",numLimit:5,formCls:"upload-form",successFn:null,cancelFn:null};var c=b.extend({},b.fn.upload.defaults,a),d=function(a){return a=b.isArray(a)?a.join(""):a||"",{store:a,_:function(){var a=this;return b.each(arguments,function(b,c){a.store+=c}),this},toString:function(){return this.store}}};return this.each(function(){var a=b(this),e=a.find(".btn-upload"),f=null,g=function(){f=a.find("input"),e.click(function(a){a.preventDefault(),b(this).hasClass("none")||f.trigger("click")}),f.on("change",function(a){h()}),a.on("click",".img-preview",function(a){a.preventDefault(),b(a.target).hasClass("close")||k(b(this).find("img").attr("src"))}).on("click",".close",function(a){return a.preventDefault(),c.cancelFn&&c.cancelFn(b(this).parent().attr("id")),b(this).closest("a").remove(),e.removeClass("none"),!1})},h=function(){var a=f.get(0),g=(a.files.length,"img-"+(new Date).getTime());if(b(".img-preview").length>=c.numLimit-1&&e.addClass("none"),a.files&&a.files[0]){var h=new FileReader,j=d();j._('<a href="#" id="'+g+'" class="img-preview loading" data-collect="true" data-collect-flag="news-baoliao-preview-btn" data-collect-desc="预览图片按钮">')._('<span class="lc"><i class="uploading"></i></span>')._('<i class="close icon icon-x-alt" data-stoppropagation="true"></i>')._('<span class="ic"><img /></span>')._("</a>"),e.before(j.toString()),h.onload=function(a){a.target.result&&-1!==a.target.result.indexOf("image/")&&b("#"+g).find("img").attr("src",a.target.result)},h.readAsDataURL(a.files[0])}i(g)},i=function(a){var b=new FormData,c=f.get(0),d=c.files.length;0!=d&&(b.append("file",c.files[0]),b.append("serviceName","clueImg"),j(a,b))},j=function(d,e){var f=new XMLHttpRequest,g=b("#"+d),h=g.find("img");f.addEventListener("load",function(e){if(e.target&&e.target.responseText){var f=null;try{f=b.parseJSON(e.target.responseText)}catch(i){}if(!f||0!=f.code)return void alert("上传图片失败");c.successFn&&c.successFn(f.filePath,a.find("."+c.formCls),d),h.attr("src")||h.attr("src",f.filePath),g.attr("data-url",f.filePath).removeClass("loading")}},!1),0!=e&&(f.addEventListener("error",function(){b("#"+d).removeClass("loading"),alert("上传出错")},!1),f.addEventListener("abort",function(){b("#"+d).removeClass("loading"),alert("上传已取消")},!1),f.open("POST",c.url),f.send(e))},k=function(a){var c=d(),e=b(".preview-box"),f=b(window).width(),g=b(window).height();0==e.length?(c._('<div class="preview-box">')._('<img class="none" />')._("</div>"),e=b(c.toString())):e.show(),imgReady(a,function(){var b=f-20,c=g-20,d=b/c,h=this.width/this.height;this.width>b||this.height>c?h>=d?c=b*(this.height/this.width):b=c*(this.width/this.height):(b=this.width,c=this.height),e.find("img").attr("src",a).css({width:b,height:c,"margin-left":(f-b)/2,"margin-top":(g-c)/2}).removeClass("none")}),b("html").addClass("noscroll"),b("body").append(e).delegate(".preview-box","click",function(a){e.hide(),b("html").removeClass("noscroll")})},l=function(){var e=a.find("."+c.formCls);if(!(e.length>0)){var f=d();f._('<form class="'+c.formCls+'" enctype="multipart/form-data" method="post">')._('<input type="file" accept="image/*" capture="camera">')._("</form>"),e=b(f.toString()),a.append(e)}};l(),g()})},H.discolse={initParam:function(){this.news_disclose=b("#news-disclose"),this.news_textarea=b(".news-textarea"),this.news_input=b(".news-input"),this.nickname_input=b(".nickname-input"),this.news_submit=b(".news-submit")},initEvent:function(){var a=this;b("#upload-box").upload({url:domain_url+"fileupload/image",numLimit:4,formCls:"upload-form"}),this.news_submit.tap(function(){if(a.checkForm()){var c=a.news_input.val(),d=a.nickname_input.val(),e=a.news_textarea.val(),f="";b("#upload-box .img-preview").each(function(){f+=b(this).attr("data-url")+","}),f=f.substr(0,f.length-1),getResult("api/newsclue/save",{nickname:nickname,openid:openid,avatar:headimgurl,phone:c,title:"",content:d+":"+e,imgs:f,videos:""},"callbackClueSaveHandler",function(c){0==c.code?(showTips("爆料成功"),a.news_textarea.val(""),a.nickname_input.val(""),a.news_input.val(""),b("#upload-box .img-preview").remove()):alert("网络错误，请稍后重试")})}})},checkForm:function(){return this.news_textarea.val().trim()?this.nickname_input.val().trim()?this.news_input.val().trim()?/^[1]\d{10}$/.test(this.news_input.val().trim())?!0:(showTips("请填写正确的联系电话"),!1):(showTips("请填写联系电话"),!1):(showTips("请填写姓名"),!1):(showTips("请填写新闻线索"),!1)},init:function(){this.initParam(),this.initEvent()}},b(function(){H.discolse.init()})}(window,Zepto),function(a,b){a.Reserve=function(){this.$reserveId=null,this.$dateT=null},Reserve.prototype.orderFn=function(a,c,d){var e=this;b.ajax({type:"GET",async:!0,url:domain_url+"api/program/reserve/get",dataType:"jsonp",data:{},jsonpCallback:"callbackProgramReserveHandler",success:function(f){if(e.$reserveId=f.reserveId,e.$dateT=f.date,f.reserveId)window.shaketv&&shaketv.preReserve_v2({tvid:a.yao_tv_id,reserveid:f.reserveId,date:f.date},function(c){if(0==c.errorCode)b(a.id).removeClass("none");else if(-1007==c.errorCode){if(d)return void d();b(a.id).addClass("none")}});else{if(c)return void c();b(a.id).addClass("none")}}})},Reserve.prototype.orderBtn=function(a,c,d){var e=this;b(a.id).click(function(){e.$reserveId&&shaketv.reserve_v2({tvid:a.yao_tv_id,reserveid:e.$reserveId,date:e.$dateT},function(c){if(0==c.errorCode){if(d)return void d();b(a.id).addClass("none")}})})},Reserve.prototype.init=function(a,b,c){this.orderFn(a,b,c),this.orderBtn(a,b,c)}}(window,Zepto),function(a){H.reserve={init:function(){a("#reserve_btn").addClass("none"),W.yao_tv_id?(new Reserve).init({id:"#reserve_btn",yao_tv_id:W.yao_tv_id}):alert("请配置频道tvid")}},H.reserve.init()}(Zepto),function(a,b){a.Subscribe=function(a){this.type=a&&a.type||2,this.selector=a&&a.selector||"div_subscribe_area",this.sub_contain=b('<div id="'+this.selector+'" class="none" '+this.selector+'"></div>')},Subscribe.prototype.setCss=function(){var a={position:"fixed",left:"0",width:"100%",height:"50px",overflow:"hidden","z-index":"9999999"};this.sub_contain.css(a)},Subscribe.prototype.appendHtml=function(){b("footer").append(this.sub_contain),this.setCss()},Subscribe.prototype.shaketv_subscribe=function(){a.shaketv&&shaketv.subscribe({appid:"wx93991f6fd5e85543",selector:"#"+this.selector,type:this.type},function(a){})},Subscribe.prototype.switch_state=function(){-1==a.location.href.indexOf("cb41faa22e731e9b")?this.sub_contain.addClass("none").css("height","0"):this.sub_contain.removeClass("none").css("height","50px")},Subscribe.prototype.initEvent=function(){if(a.shaketv)this.shaketv_subscribe(),this.switch_state();else{var b=this;b.shaketvCount=0,a.shaketvInterval=setInterval(function(){b.shaketvCount++,a.shaketv&&(b.shaketv_subscribe(),b.switch_state(),clearInterval(a.shaketvInterval)),b.shaketvCount>10&&(clearInterval(a.shaketvInterval),b.shaketvCount=0)},1e3)}},Subscribe.prototype.init=function(){this.appendHtml(),this.initEvent()},(new Subscribe).init()}(window,Zepto);