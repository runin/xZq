(function(a){H.dialog={puid:0,$container:a("#main"),REQUEST_CLS:"requesting",height:a(window).height(),init:function(){var b=this;this.$container.delegate(".btn-rule","click",function(c){c.preventDefault();H.dialog.rule.open()}).delegate(".btn-close","click",function(c){c.preventDefault();a(this).closest(".modal").addClass("none")}).delegate(".btn-lottery","click",function(c){c.preventDefault();H.dialog.lottery.open()}).delegate(".btn-record","click",function(c){c.preventDefault();H.dialog.record.open()})},close:function(){a(".modal").addClass("none")},open:function(){H.dialog.close();if(this.$dialog){this.$dialog.removeClass("none")}else{this.$dialog=a(this.tpl());H.dialog.$container.append(this.$dialog)}H.dialog.relocate()},relocate:function(){var b=a(window).height(),c=a(window).width();a(".modal").css({width:c,height:b}).find(".btn-close").css({right:c*0.06-15,top:b*0.06-15});a(".dialog").each(function(){if(a(this).hasClass("relocated")){return}a(this).css({width:c*0.88,height:b*0.88,left:c*0.06,right:c*0.06,bottom:b*0.06});var d=a(this).find(".box");if(d.length>0){d.css("height",b*0.38)}});if(is_android()){a("input").each(function(){a(this).focus(function(){setInterval(function(){if(H.dialog.height!=a(window).height()){a(".dialog").css({bottom:-b*0.12})}else{a(".dialog").css({bottom:H.dialog.height*0.06})}},500)})})}},rule:{$dialog:null,open:function(){H.dialog.open.call(this);this.event();getResult("common/activtyRule/"+serviceNo,{},"callbackRuleHandler",true,this.$dialog)},close:function(){this.$dialog&&this.$dialog.addClass("none");a(".masking-box").addClass("none")},event:function(){var b=this;this.$dialog.find(".btn-close").click(function(c){c.preventDefault();b.close()})},update:function(b){this.$dialog.find(".rule").html(b).closest(".content").removeClass("none")},tpl:function(){var b=simpleTpl();b._('<section class="modal" id="rule-dialog">')._('<a href="#" class="btn-close" data-collect="true" data-collect-flag="xian-song-ruledialog-closebtn" data-collect-desc="规则弹层-关闭按钮"></a>')._('<div class="dialog rule-dialog">')._("<h2></h2>")._('<div class="content border none">')._('<div class="rule"></div>')._("</div>")._('<p class="dialog-copyright">本活动最终解释权归西安广播电视台所有</p>')._("</div>")._("</section>");return b.toString()}},lottery:{$dialog:null,open:function(){var b=this.$dialog;H.dialog.open.call(this);if(!b){this.event()}},close:function(){this.$dialog&&this.$dialog.addClass("none");a(".masking-box").addClass("none")},event:function(){var b=this;this.$dialog.find(".btn-close").click(function(c){c.preventDefault();b.clear();b.close()});this.$dialog.find(".btn-award").click(function(g){g.preventDefault();if(!b.check()){return false}var f=a.trim(b.$dialog.find(".mobile").val()),d=a.trim(b.$dialog.find(".name").val()),c=a.trim(b.$dialog.find(".address").val());b.disable();getResult("vote/award",{pluid:b.puid,ph:f,un:encodeURIComponent(d),openid:openid},"awardHander",this.$dialog)})},check:function(){var e=this;var d=e.$dialog.find(".mobile"),f=e.$dialog.find(".name"),c=a.trim(d.val()),b=a.trim(f.val());if(!b){alert("请先输入姓名");f.focus();a(this).removeClass(e.REQUEST_CLS);return false}if(!c||!/^\d{11}$/.test(c)){alert("请先输入正确的手机号");d.focus();a(this).removeClass(e.REQUEST_CLS);return false}a(".mobile").val(c);return true},enable:function(){this.$dialog.find(".btn-award").removeClass(this.REQUEST_CLS)},disable:function(){this.$dialog.find(".btn-award").addClass(this.REQUEST_CLS)},tpl:function(){var b=simpleTpl();b._('<section class="modal" id="lottery-dialog">')._('<div class="dialog lottery-dialog">')._('<a href="#" class="btn-close lottery-close" data-collect="true" data-collect-flag="xian-song-lottdialog-closebtn" data-collect-desc="抽奖弹层-关闭按钮"></a>')._('<div class="not-lott " id="not-lott">')._('<img src="images/open-li.png">')._("<h1>很遗憾，没抽中哦，再接再厉吧</h1>")._('<a href="javascript:share();" class="btn btn-share" data-collect="true" data-collect-flag="xian-song-sharebtn" data-collect-desc="唱响中国-分享按钮">邀请小伙伴来抽奖</a>')._('<p class="da-tips"><a href="#" class="btn-record" data-collect="true" data-collect-flag="xian-song-rank" data-collect-desc="唱响中国-查看中奖纪录">查看中奖记录</a></p>')._("</div>")._('<div class="lott none" id="lott">')._('<img src="">')._("<h2>-</h2>")._("<h1>请填写您的联系方式以便顺利领奖</h1>")._('<input type="text" class="name" placeholder="姓名：" />')._('<input type="number" class="mobile" placeholder="电话：" />')._('<a class="btn btn-share bth-aw btn-award" id="btn-award" data-collect="true" data-collect-xian-song-combtn" data-collect-desc="唱响中国-确定按钮">确定</a>')._('<p class="da-tips"><a href="#" class="btn-record" data-collect="true" data-collect-flag="xian-song-rank" data-collect-desc="唱响中国-查看中奖纪录">查看中奖记录</a></p>')._("</div>")._('<p class="dialog-copyright">本活动最终解释权归西安广播电视台所有</p>')._("</div>")._("</section>");return b.toString()},update:function(b){if(b.code==0){this.puid=b.pluid;if(b.pt==1){a("#lott").find("img").attr("src",b.piu);a("#lott").find("h2").text(b.ltp);this.$dialog.find("#not-lott").addClass("none");this.$dialog.find("#lott").removeClass("none")}}else{alert("系统繁忙，请稍候再试~")}},clear:function(){this.$dialog.find("#not-lott").removeClass("none");this.$dialog.find("#lott").addClass("none");this.$dialog.find("input").removeAttr("disabled");this.$dialog.find("#btn-award").removeClass("none").addClass("btn btn-share bth-aw btn-award");this.$dialog.find("#lott h1").text("请填写您的联系方式以便顺利领奖")},succ:function(){this.$dialog.find("input").attr("disabled","disabled");this.$dialog.find("#btn-award").addClass("none");this.$dialog.find("#lott h1").text("以下是您的联系方式，请等候工作人员联系")}},record:{$dialog:null,open:function(){H.dialog.open.call(this);this.event();H.dialog.lottery.clear();if(openid!=null){getResult("vote/prize",{openid:openid},"prizeHandler",true,this.$dialog)}},close:function(){this.$dialog&&this.$dialog.addClass("none");a(".masking-box").addClass("none")},event:function(){var b=this;this.$dialog.find(".btn-close").click(function(c){c.preventDefault();b.close()})},tpl:function(){var b=simpleTpl();b._('<section class="modal" id="rule-dialog">')._('<a href="#" class="btn-close" data-collect="true" data-collect-flag="xian-song-recoddialog-closebtn" data-collect-desc="中奖记录弹层-关闭按钮"></a>')._('<div class="dialog rule-dialog">')._('<h2 class="record-h2"></h2>')._('<div class="content border record-con">')._('<ul class="rule" id="rule-ul"></ul>')._("</div>")._('<p class="dialog-copyright">本活动最终解释权归西安广播电视台所有</p>')._("</div>")._("</section>");return b.toString()},list:function(f){var d=simpleTpl(),e=f||[],g=a("#rule-ul");for(var c=0,b=e.length;c<e.length;c++){d._("<li>")._("<i>"+(c+1)+"</i><label>"+e[c].pd+"</label><span>"+e[c].pn+"</span>")._("</li>")}return g.html(d.toString())}}};W.awardHander=function(b){if(b.code==0){H.dialog.lottery.enable();H.dialog.lottery.succ();return}alert(b.message)};W.callbackRuleHandler=function(b){if(b.code==0&&b.rule){H.dialog.rule.update(b.rule);H.dialog.record.list()}};W.prizeHandler=function(b){if(b.code==0){H.dialog.record.list(b.items)}}})(Zepto);$(function(){H.dialog.init()});(function(a){H.index={from:getQueryString("from"),$ctrl_wrapper:a(".ctrl-wrapper"),$share:a("#ui-share"),init:function(){var b=this;if(openid!=null){getResult("vote/index",{openid:openid},"voteIndexHandler",true)}setTimeout(function(){b.$share.removeClass("none")},3500);H.page.rank()}};H.page={parallax:null,puid:0,$pages:a("#pages"),$arrows:a("#ui-arrows"),$top_outer:a("#ui-outer-top"),$top_inner:a("#ui-inner-top"),$ui_audio:a("#ui-audio"),$wrapper:a(".wrapper"),s_type:0,TURNED_CLS:"turned",STARTING_CLS:"starting",ENDED_CLS:"ended",timeout:true,time:3000,init:function(d){var c=this;this.$pages.append(this.tpl(d));if(this.$pages.find(".page").length<=1){return}this.parallax=c.$pages.parallax({direction:"horizontal",swipeAnim:"default",drag:true,loading:false,indicator:false,arrow:false,onchange:function(e,f,h){if(a(".current").attr("data-id")==1){H.index.$share.addClass("none")}else{H.index.$share.removeClass("none")}c.update_arrow(e,f);if(e>0){var g=h=="forward"?"右翻":(h=="backward"?"左翻":"");recordUserOperate(openid,g+"查看第"+e+"个餐厅","ah-pagechange-"+e)}}});var b=a(window).height();a(".xs-wrapper").css("height",b*0.6).css("marginTop",b*0.2);a(".ctrl-wrapper").css("height",b*0.28);c.event_handler();c.progress()},update_arrow:function(b,c){if(a(c).next(".page").length==0){this.$arrows.addClass("left")}else{this.$arrows.removeClass("left")}},to:function(d){if(!this.parallax){return}var e=a(window).width(),f=this.$pages.find(".page"),c=f.index('[data-guid="'+(d||0)+'"]');c=c>-1?c:1;var b=a(".page").eq(c);if(c==0||b.hasClass("none")){return}f.removeClass("current");b.addClass("current");this.$pages.css("-webkit-transform","matrix(1, 0, 0, 1, -"+(c*e)+", 0)");window.curPage=c;this.update_arrow(c,b)},progress:function(){var b=this;a(".page-round").each(function(f){var e=a(this),d=e.attr("data-guid"),g=e.prev(),c=e.attr("data-rs");e.progress({index:f,callback:function(k){var h=a(".page-round").not(function(){return a(this).hasClass(b.ENDED_CLS)}).first();if(b.timeout&&h.length==0){h=a(".page-round").eq(0)}if(!h.hasClass(b.TURNED_CLS)){var j=h.attr("data-state");if(!j){return}h.addClass(b.TURNED_CLS);if(j==3&&h.next().length==0){var i=a(".page-round").eq(0);if(b.timeout){b.timeout=false;setTimeout(function(){b.to(i.length>0?i.attr("data-guid"):0)},b.time)}else{b.to(i.length>0?i.attr("data-guid"):0)}}else{if(b.timeout){b.timeout=false;setTimeout(function(){b.to(h.attr("data-guid"))},b.time)}else{b.to(h.attr("data-guid"))}}}},stCallback:function(h){e.addClass(b.STARTING_CLS).removeClass("none")},sdCallback:function(h){e.removeClass(b.STARTING_CLS).removeClass("none")},otCallback:function(h){e.addClass(b.ENDED_CLS)}})})},event_handler:function(){var b=this;this.$pages.delegate(".btn-vote","click",function(f){f.preventDefault();b.$pages.addClass("disabled");var d=a(this).closest(".page"),c=d.attr("data-guid");getResult("vote/vote",{openid:openid,actUuid:H.page.puid,attrUuid:c},"voteHandler",true)});this.$pages.delegate(".draw","click",function(f){f.preventDefault();if(a(".current").find(".draw").hasClass("btn-disabled")){return}b.fill_masking();var d=a(this).closest(".page"),c=d.attr("data-guid");H.page.ani_relocate(c)});a(".home").click(function(c){c.preventDefault();a(".info-box").addClass("none");b.$ui_audio.addClass("none");b.$arrows.removeClass("none");H.index.$share.removeClass("none");b.$wrapper.removeClass("none")});this.$pages.delegate(".xs-wrapper","click",function(d){d.preventDefault();var c=a("#info-box-"+a(".current").attr("data-guid"));c.removeClass("none");c.find(".ui-audio").audio({auto:false,stopMode:"pause",audioUrl:c.find(".ui-audio").attr("data-url"),steams:["<img src='./images/icon-musical-note.png' />","<img src='./images/icon-musical-note.png' />"],steamHeight:150,steamWidth:44}).removeClass("none");b.$wrapper.addClass("none");b.$arrows.addClass("none");H.index.$share.addClass("none");getResult("vote/detail",{attrUuid:a(".current").attr("data-guid")},"detailHandler",true)});H.index.$share.click(function(c){c.preventDefault();H.about.init();b.$wrapper.addClass("none");b.$arrows.addClass("none");H.index.$share.addClass("none");a(".rank-box").removeClass("none")})},info:function(d,c){var b=simpleTpl();b._('<div class="masking-box info-box none" id="info-box-'+d+'" >')._('<section class="info" >')._('<a class="home" data-collect="true" data-collect-flag="xian-song-info-back" data-collect-desc="西安广播-返回首页">< 返回</a>')._('<div class="info-con" id="info-con"></div>')._("</section>")._('<section class="ui-audio none" data-url="'+c+'">')._('<div class="coffee-flow">')._('<a href="#" class="audio-icon"></a>')._("</div>")._("</section>")._("</div>");$masking_box=a(b.toString());a("body").append($masking_box)},rank:function(){var b=simpleTpl();b._('<div class="masking-box rank-box none">')._('<section class="info" >')._('<a class="rank-close" data-collect="true" data-collect-flag="xian-song-info-back" data-collect-desc="西安广播-返回首页"></a>')._('<section class="ui-movies info-con none" id="ui-movies">')._('<div class="ui-list" id="ui-list"></div>')._("</section>")._("</section>")._("</div>");$masking_box=a(b.toString());a("body").append($masking_box)},get_page:function(b){return a("#page-"+b)},to2:function(){if(a(".giftBoxDiv").hasClass("step-1")){a(".giftBoxDiv").removeClass("step-1").addClass("step-2");a(".wer").addClass("page-a")}else{a(".giftBoxDiv").removeClass("step-2").addClass("step-1")}},fill_masking:function(){var b=simpleTpl();b._('<div class="masking-box">')._('<div class="gift">')._('<div class="giftBoxDiv step-1">')._('<div class="giftbox">')._('<div class="cover">')._("<div></div>")._("</div>")._('<div class="box"></div>')._("</div>")._('<div class="wer">')._("<span></span>")._("<span></span>")._("<span></span>")._("<span></span>")._("<span></span>")._("<span></span>")._("</div>")._("</div>")._("</div>")._("</div>");$masking_box=a(b.toString());a("body").append($masking_box)},ani_relocate:function(b){setTimeout(function(){H.page.to2();setTimeout(function(){getResult("vote/lottery",{openid:openid,actUid:H.page.puid,attrUuid:b},"lotteryHandler",true,a(".dialog"));a(".giftBoxDiv").removeClass("step-1")},1700)},1000)},tpl:function(j){var g=simpleTpl(),d=j.attrs||[];this.puid=j.actUid;H.dialog.puid=this.puid;for(var f=0,b=d.length;f<b;f++){var e=d[f].uv>0?"":"none",c=d[f].uv!=0?"none":"",h=d[f].uv==0&&d[f].up?"btn-disabled":"";g._('<div class="page page-round" id="page-'+d[f].au+'" data-guid="'+d[f].au+'">');g._('<div class="xs-wrapper" data-collect="true" data-collect-flag="xian-song-index-num'+f+'" data-collect-desc="唱响中国-详情">')._('<img src="'+d[f].ai+'" />')._('<div class="xs-bot"><span>'+d[f].an+'</span><label class="votenum">'+d[f].vn+"</label></div>")._("</div>")._('<div class="ctrl-wrapper">');g._('<div class="cwc-item cw-vote">')._('<div class="cw-btns">')._('<a href="#" class="btn-vote btn-jinji '+e+'" data-surplus="'+d[f].uv+'" data-collect="true" data-collect-flag="xian-song-index-votejj" data-collect-desc="唱响中国-投票按钮"><i></i>赞一个</a>')._('<a href="#" class="draw '+c+" "+h+'" data-collect="true" data-collect-flag="xian-song-index-votejj" data-collect-desc="唱响中国-抽奖按钮">我要抽奖</a>')._("</div>")._("</div>");g._('<div class="cwr-ctrl ctrl">')._('<p class="tips"><a href="#" class="btn-rule" data-collect="true" data-collect-flag="xian-song-index-rulebtn" data-collect-desc="唱响中国-规则弹层按钮">活动规则</a></p>')._("</div>");g._("</div>")._("</div>");H.page.info(d[f].au,d[f].am)}return g.toString()}};W.voteIndexHandler=function(b){if(b.code==0||b.code==3||b.code==4){H.page.init(b)}};W.voteHandler=function(c){if(c.code==1){alert(c.message);return}else{var b=a(".current").find(".btn-vote");var d=a(".current").find(".votenum");b.addClass("animated");setTimeout(function(){b.removeClass("animated");b.addClass("none");d.html(d.html()*1+1);a(".current").find(".draw").removeClass("none");H.page.$pages.removeClass("disabled")},2000)}};W.lotteryHandler=function(b){a(".current").find(".draw").addClass("btn-disabled");H.dialog.lottery.open();H.dialog.lottery.update(b)};W.detailHandler=function(c){if(c.code==0){var b=a("#info-box-"+a(".current").attr("data-guid"));b.find(".info-con").html(c.ad)}}})(Zepto);$(function(){H.index.init()});(function(a){H.about={$cover:a("#cover"),page:1,pageSize:10,total:0,loadmore:true,init:function(){getList(true);this.event_handler()},event_handler:function(){a(".btn-loadmore").click(function(c){c.preventDefault();var b="loading";if(a(this).hasClass(b)){return}a(this).addClass(b);H.about.page++;getList()});a(".rank-close").click(function(b){b.preventDefault();a(".masking-box").addClass("none");a("#ui-audio").addClass("none");a("#ui-arrows").removeClass("none");a("#ui-share").removeClass("none");a(".wrapper").removeClass("none")})},add_items:function(h){var d=h.items||[],b=d.length,g=simpleTpl();item=[{an:"城",ci:"薛保勤",qu:"赵 麟",chang:"雷 佳"},{an:"西门外的雨",ci:"孙 浩",qu:"孙 浩",chang:"孙 浩"},{an:"大西安",ci:"陈维东",qu:"陈丽春",chang:"王潇/刘小洁"},{an:"长安月",ci:"李宏天",qu:"龚佩燕",chang:"苏  华"},{an:"西安是首歌",ci:"祁  越",qu:"张  林",chang:"郝  萌"},{an:"梦中的西安",ci:"新  明",qu:"周  澎",chang:"周  澎"},{an:"西安梦",ci:"蒋  平",qu:"夏正华",chang:"王海天"},{an:"世界的西安",ci:"王海天",qu:"刘续红",chang:"张  喆"},{an:"西安，我对你太熟了",ci:"海  鹏",qu:"曹  博",chang:"捌零年代"},{an:"八水润西安",ci:"徐亚非",qu:"陈大明",chang:"郝 萌"}];this.total=h.ac;for(var f=0;f<item.length;f++){g._('<div class="ui-movie movie">')._('<div class="num"><label>'+(f+1)+"</label></div>")._('<div class="cover"><span>'+(item[f].an||"")+"</span></div>")._('<div class="content">')._('<div class="ci">作词：<span>'+(item[f].ci||"")+"</span></div>")._('<div class="qu">作曲：<span>'+(item[f].qu||"")+"</span></div>")._('<div class="chang">演唱：<span>'+(item[f].chang||"")+"</span></div>")._("</div>")._('<div class="heart" id="heart'+f+'"></div>')._('</div><div class="clear"></div>')}a("#ui-list").html(g.toString());for(var f=0;f<b;f++){var c=d[f].an,e=d[f].vn;switch(c){case"城":a("#heart0").text(e);break;case"西门外的雨":a("#heart1").text(e);break;case"大西安":a("#heart2").text(e);break;case"长安月":a("#heart3").text(e);break;case"西安是首歌":a("#heart4").text(e);break;case"梦中的西安":a("#heart5").text(e);break;case"西安梦":a("#heart6").text(e);break;case"世界的西安":a("#heart7").text(e);break;case"西安，我对你太熟了":a("#heart8").text(e);break;case"八水润西安":a("#heart9").text(e);break;default:a("#heart"+f).text("-")}}a("#ui-movies").removeClass("none")}};W.getList=function(b){getResult("vote/rank",{page:H.about.page,pageSize:H.about.pageSize},"rankHandler",true)};W.rankHandler=function(c){if(c.code!=0){return}var b=c;a(".btn-loadmore").removeClass("loading");var d=a(".btn-loadmore");if(c.items.length<H.about.pageSize){d.addClass("none")}else{d.removeClass("none")}H.about.add_items(b)}})(Zepto);