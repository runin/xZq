function percent(e){document.getElementById("counter").innerHTML=e}function createScratchCard(e){function t(){return"undefined"==typeof e.foreground?!1:("#"!==e.foreground.charAt(0)||4!=e.foreground.length&&7!=e.foreground.length?(f.topImage.src=e.foreground,f.topImage.onload=function(){var e=b.createPattern(f.topImage,"repeat");b.fillStyle=e,b.fillRect(0,0,g,p),l.style.backgroundImage='url("'+f.bottomImage.src+'")',l.appendChild(I),l.appendChild(w)}):l.style.backgroundColor=e.foreground,f.endAt=3==f.demo?90:100,3!=f.demo?(f.coinImage.src=e.coin,f.coinImage.onload=function(){E=f.coinImage.width,L=f.coinImage.height,w.style.width=E+"px",w.style.height=L+"px",w.style.background='url("'+e.coin+'") no-repeat left top',o()}):I.style.cursor=f.defaultCursor,"undefined"!=typeof e.thickness&&(f.thickness=e.thickness),"undefined"!=typeof e.counter&&(f.counter=e.counter,m=window[e.counter]),I.addEventListener("mousedown",n),I.addEventListener("mousemove",n),document.addEventListener("mouseup",a),I.addEventListener("touchstart",n),I.addEventListener("touchmove",n),document.addEventListener("touchend",a),I.addEventListener("mouseover",i),I.addEventListener("mouseout",c),void I.addEventListener("mousemove",function(e){w.style.left=e.pageX-E/2+"px",w.style.top=e.pageY-L/2+"px"}))}function o(){l.style.cursor="none",w.style.position="absolute",w.style.display="none",w.style.zIndex="9000",w.style.top=0,w.style.left=0,w.style.pointerEvents="none",d(w)}function n(e){var t=!1;if("touchmove"==e.type?(e.preventDefault(),t=!0):("mousedown"==e.type||"touchstart"==e.type)&&(isMouseDown=!0,t=!0),0==v){for(var o=0,n=b.getImageData(0,0,g,p).data,a=0,i=n.length;i>a;a+=4)n[a]>0&&o++;v=g*p-o}if(isMouseDown){var c=e.pageX-this.offsetLeft,d=e.pageY-this.offsetTop;if("touchmove"==e.type||"touchstart"==e.type){var u=e.touches[0],m=u.pageX-u.target.offsetLeft,l=u.pageY-u.target.offsetTop;c=m,d=l}b.save(),b.globalCompositeOperation="destination-out",b.beginPath(),b.arc(c,d,f.thickness,0,2*Math.PI,!1),b.closePath(),b.fillStyle="rgba(0, 0, 0, 1)",b.fill(),b.restore(),("touchmove"==e.type||"touchstart"==e.type||"touchend"==e.type)&&(I.style.marginRight="1px",I.style.marginRight="0px"),parseInt(s(t))>=f.endAt&&r()}}function r(){var e=b.createPattern(f.bottomImage,"repeat");b.fillStyle=e,b.fillRect(0,0,g,p),h=100,I.removeEventListener("mousedown",n),I.removeEventListener("mousemove",n),document.removeEventListener("mouseup",a),I.removeEventListener("mouseover",i),I.removeEventListener("mouseout",c),l.style.setProperty("cursor","default","important"),I.style.setProperty("cursor","default","important"),w.style.display="none",l.removeChild(I),l.removeChild(w),0!=f.counter&&3==f.demo&&m(h),3==f.demo&&alert("This is an example of a callback function. You can set any callback function of your choice, it will be triggered when the foreground image has been scratched off")}function s(e){if(y++%10==0||e){for(var t=0,o=b.getImageData(0,0,g,p).data,n=0,r=o.length;r>n;n+=4)o[n]>0&&t++;h=(100-t/(g*p-v)*100).toFixed(2)}return 0!=f.counter&&"function"==typeof m&&m(h),h}function a(){isMouseDown=!1}function i(){w.style.display="block"}function c(){w.style.display="none"}function d(e){e.style.setProperty("-khtml-user-select","none","important"),e.style.setProperty("-webkit-user-select","none","important"),e.style.setProperty("-moz-user-select","-moz-none","important"),e.style.setProperty("-ms-user-select","none","important"),e.style.setProperty("user-select","none","important"),e.style.setProperty("-webkit-touch-callout","none","important")}function u(){I.style.setProperty("cursor","default","important"),document.removeEventListener("touchstart",u),document.removeEventListener("touchmove",u),document.removeEventListener("touchend",u)}var m,l,g,p,f={topImage:new Image,bottomImage:new Image,coinImage:new Image,thickness:20,endAt:95,defaultCursor:"pointer",counter:!1,demo:e.demo},h=0,y=0,v=0;if(l=document.getElementById(1==f.demo?"scratch1":2==f.demo?"star":4==f.demo?"multiple":"scratch3"),g=l.offsetWidth,p=l.offsetHeight,l.style.setProperty("position","static","important"),d(l),!window.HTMLCanvasElement)return l.innerHTML="Your browser does not support HTML5 canvas tag.",!1;f.bottomImage.onload=function(){g*p==0&&(g=f.bottomImage.width,p=f.bottomImage.height,l.style.width=f.bottomImage.width+"px",l.style.height=f.bottomImage.height+"px",I.width=g,I.height=p,d(I),t())},f.bottomImage.src=1==f.demo?"./images/demo1-background.png":2==f.demo?"./images/demo2-star-background.png":4==f.demo?"./images/demo4-star-background.png":"./images/background.png";var I=document.createElement("canvas"),b=I.getContext("2d");b.translate(0,0);var w=document.createElement("div"),E=0,L=0;document.addEventListener("touchstart",u),document.addEventListener("touchmove",u),document.addEventListener("touchend",u)}var isMouseDown=!1;window.onload=function(){createScratchCard({demo:1,foreground:"./images/demo1-foreground.png",coin:"./images/coin2.png",thickness:18}),createScratchCard({demo:2,foreground:"./images/demo2-star-foreground.png",coin:"./images/coin.png",thickness:16}),createScratchCard({demo:3,foreground:"./images/foreground.png",counter:"percent",thickness:80}),createScratchCard({demo:4,foreground:"./images/demo2-star-foreground.png",coin:"./images/coin.png",thickness:16})};