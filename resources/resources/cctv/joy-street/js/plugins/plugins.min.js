function hex_md5(a){return rstr2hex(rstr_md5(str2rstr_utf8(a)))}function hex_hmac_md5(a,b){return rstr2hex(rstr_hmac_md5(str2rstr_utf8(a),str2rstr_utf8(b)))}function md5_vm_test(){return"900150983cd24fb0d6963f7d28e17f72"==hex_md5("abc").toLowerCase()}function rstr_md5(a){return binl2rstr(binl_md5(rstr2binl(a),8*a.length))}function rstr_hmac_md5(a,b){var c=rstr2binl(a);c.length>16&&(c=binl_md5(c,8*a.length));for(var d=Array(16),e=Array(16),f=0;16>f;f++)d[f]=909522486^c[f],e[f]=1549556828^c[f];var g=binl_md5(d.concat(rstr2binl(b)),512+8*b.length);return binl2rstr(binl_md5(e.concat(g),640))}function rstr2hex(a){try{}catch(b){hexcase=0}for(var c,d=hexcase?"0123456789ABCDEF":"0123456789abcdef",e="",f=0;f<a.length;f++)c=a.charCodeAt(f),e+=d.charAt(c>>>4&15)+d.charAt(15&c);return e}function str2rstr_utf8(a){for(var b,c,d="",e=-1;++e<a.length;)b=a.charCodeAt(e),c=e+1<a.length?a.charCodeAt(e+1):0,b>=55296&&56319>=b&&c>=56320&&57343>=c&&(b=65536+((1023&b)<<10)+(1023&c),e++),127>=b?d+=String.fromCharCode(b):2047>=b?d+=String.fromCharCode(192|b>>>6&31,128|63&b):65535>=b?d+=String.fromCharCode(224|b>>>12&15,128|b>>>6&63,128|63&b):2097151>=b&&(d+=String.fromCharCode(240|b>>>18&7,128|b>>>12&63,128|b>>>6&63,128|63&b));return d}function rstr2binl(a){for(var b=Array(a.length>>2),c=0;c<b.length;c++)b[c]=0;for(var c=0;c<8*a.length;c+=8)b[c>>5]|=(255&a.charCodeAt(c/8))<<c%32;return b}function binl2rstr(a){for(var b="",c=0;c<32*a.length;c+=8)b+=String.fromCharCode(a[c>>5]>>>c%32&255);return b}function binl_md5(a,b){a[b>>5]|=128<<b%32,a[(b+64>>>9<<4)+14]=b;for(var c=1732584193,d=-271733879,e=-1732584194,f=271733878,g=0;g<a.length;g+=16){var h=c,i=d,j=e,k=f;c=md5_ff(c,d,e,f,a[g+0],7,-680876936),f=md5_ff(f,c,d,e,a[g+1],12,-389564586),e=md5_ff(e,f,c,d,a[g+2],17,606105819),d=md5_ff(d,e,f,c,a[g+3],22,-1044525330),c=md5_ff(c,d,e,f,a[g+4],7,-176418897),f=md5_ff(f,c,d,e,a[g+5],12,1200080426),e=md5_ff(e,f,c,d,a[g+6],17,-1473231341),d=md5_ff(d,e,f,c,a[g+7],22,-45705983),c=md5_ff(c,d,e,f,a[g+8],7,1770035416),f=md5_ff(f,c,d,e,a[g+9],12,-1958414417),e=md5_ff(e,f,c,d,a[g+10],17,-42063),d=md5_ff(d,e,f,c,a[g+11],22,-1990404162),c=md5_ff(c,d,e,f,a[g+12],7,1804603682),f=md5_ff(f,c,d,e,a[g+13],12,-40341101),e=md5_ff(e,f,c,d,a[g+14],17,-1502002290),d=md5_ff(d,e,f,c,a[g+15],22,1236535329),c=md5_gg(c,d,e,f,a[g+1],5,-165796510),f=md5_gg(f,c,d,e,a[g+6],9,-1069501632),e=md5_gg(e,f,c,d,a[g+11],14,643717713),d=md5_gg(d,e,f,c,a[g+0],20,-373897302),c=md5_gg(c,d,e,f,a[g+5],5,-701558691),f=md5_gg(f,c,d,e,a[g+10],9,38016083),e=md5_gg(e,f,c,d,a[g+15],14,-660478335),d=md5_gg(d,e,f,c,a[g+4],20,-405537848),c=md5_gg(c,d,e,f,a[g+9],5,568446438),f=md5_gg(f,c,d,e,a[g+14],9,-1019803690),e=md5_gg(e,f,c,d,a[g+3],14,-187363961),d=md5_gg(d,e,f,c,a[g+8],20,1163531501),c=md5_gg(c,d,e,f,a[g+13],5,-1444681467),f=md5_gg(f,c,d,e,a[g+2],9,-51403784),e=md5_gg(e,f,c,d,a[g+7],14,1735328473),d=md5_gg(d,e,f,c,a[g+12],20,-1926607734),c=md5_hh(c,d,e,f,a[g+5],4,-378558),f=md5_hh(f,c,d,e,a[g+8],11,-2022574463),e=md5_hh(e,f,c,d,a[g+11],16,1839030562),d=md5_hh(d,e,f,c,a[g+14],23,-35309556),c=md5_hh(c,d,e,f,a[g+1],4,-1530992060),f=md5_hh(f,c,d,e,a[g+4],11,1272893353),e=md5_hh(e,f,c,d,a[g+7],16,-155497632),d=md5_hh(d,e,f,c,a[g+10],23,-1094730640),c=md5_hh(c,d,e,f,a[g+13],4,681279174),f=md5_hh(f,c,d,e,a[g+0],11,-358537222),e=md5_hh(e,f,c,d,a[g+3],16,-722521979),d=md5_hh(d,e,f,c,a[g+6],23,76029189),c=md5_hh(c,d,e,f,a[g+9],4,-640364487),f=md5_hh(f,c,d,e,a[g+12],11,-421815835),e=md5_hh(e,f,c,d,a[g+15],16,530742520),d=md5_hh(d,e,f,c,a[g+2],23,-995338651),c=md5_ii(c,d,e,f,a[g+0],6,-198630844),f=md5_ii(f,c,d,e,a[g+7],10,1126891415),e=md5_ii(e,f,c,d,a[g+14],15,-1416354905),d=md5_ii(d,e,f,c,a[g+5],21,-57434055),c=md5_ii(c,d,e,f,a[g+12],6,1700485571),f=md5_ii(f,c,d,e,a[g+3],10,-1894986606),e=md5_ii(e,f,c,d,a[g+10],15,-1051523),d=md5_ii(d,e,f,c,a[g+1],21,-2054922799),c=md5_ii(c,d,e,f,a[g+8],6,1873313359),f=md5_ii(f,c,d,e,a[g+15],10,-30611744),e=md5_ii(e,f,c,d,a[g+6],15,-1560198380),d=md5_ii(d,e,f,c,a[g+13],21,1309151649),c=md5_ii(c,d,e,f,a[g+4],6,-145523070),f=md5_ii(f,c,d,e,a[g+11],10,-1120210379),e=md5_ii(e,f,c,d,a[g+2],15,718787259),d=md5_ii(d,e,f,c,a[g+9],21,-343485551),c=safe_add(c,h),d=safe_add(d,i),e=safe_add(e,j),f=safe_add(f,k)}return Array(c,d,e,f)}function md5_cmn(a,b,c,d,e,f){return safe_add(bit_rol(safe_add(safe_add(b,a),safe_add(d,f)),e),c)}function md5_ff(a,b,c,d,e,f,g){return md5_cmn(b&c|~b&d,a,b,e,f,g)}function md5_gg(a,b,c,d,e,f,g){return md5_cmn(b&d|c&~d,a,b,e,f,g)}function md5_hh(a,b,c,d,e,f,g){return md5_cmn(b^c^d,a,b,e,f,g)}function md5_ii(a,b,c,d,e,f,g){return md5_cmn(c^(b|~d),a,b,e,f,g)}function safe_add(a,b){var c=(65535&a)+(65535&b),d=(a>>16)+(b>>16)+(c>>16);return d<<16|65535&c}function bit_rol(a,b){return a<<b|a>>>32-b}function recordUserPage(a,b,c){recordUserLog(a,b,"",c,"true")}var hexcase=0,__ns=function(fullNs){for(var nsArray=fullNs.split("."),evalStr="",ns="",i=0,l=nsArray.length;l>i;i++)0!==i&&(ns+="."),ns+=nsArray[i],evalStr+="( typeof "+ns+' === "undefined" && ('+ns+" = {}) );";""!==evalStr&&eval(evalStr)},__noop=function(){},W=W||window;__ns("H");var getQueryString=function(a){var b=decodeURIComponent(location.search.slice(1));if(""!=b){for(var c,d=b.split("&"),e=0,f=d.length;f>e;e++)if(c=d[e].split("="),c[0]===a)return c[1];return""}return""},from=getQueryString("from"),gefrom=from||getQueryString("gefrom"),recordUserLog=function(a,b,c,d,e){$.ajax({type:"get",async:!1,url:domain_url+"userlog",dataType:"jsonp",jsonp:"callback",jsonpCallback:"callbackDataHandler",data:{openId:a,operateDesc:encodeURIComponent(b),operateDomId:c,loadingTime:d,from:gefrom,flag:e}})},recordUserOperate=function(a,b,c){recordUserLog(a,b,c,"","false")},callbackUserSaveHandler=function(a){};$(function(){recordUserPage(openid,$("title").html(),""),$("body").delegate("*[data-collect='true']","click",function(a){a.preventDefault(),"true"==$(this).attr("data-stoppropagation")&&a.stopPropagation(),recordUserOperate(openid,$(this).attr("data-collect-desc"),$(this).attr("data-collect-flag"));var b=$(this).attr("href");b&&"#"!==b&&(gefrom&&(b=add_param(b,"gefrom",gefrom,!0)),setTimeout(function(){window.location.href=b},5))})});var getUrl=function(){var a=window.location.href,b=getQueryString("uid"),c=getQueryString("auid");return b?(a=a,a=add_param(a,"toShare",null,!0)):c?(a=a,a=add_param(a,"toShare",null,!0)):a=share_page?a.replace(/[^\/]*\.html/i,share_page):a.replace(/[^\/]*\.html/i,"index.html"),a=add_param(a,"resopenid",hex_md5(openid),!0),a=add_param(a,"from","share",!0),a=add_param(a,"openid",null,!0),a=add_param(a,"headimgurl",null,!0),a=add_param(a,"nickname",null,!0),add_yao_prefix(a)},add_param=function(a,b,c,d){(null==a||0==a.length)&&(a=document.location.href);var e=a.split("?"),f="";if(e.length>1)for(var g=e[1].split("&"),h=0;h<g.length;h++){var i=g[h].split("=");d&&i[0]==b||(""==f?f="?":f+="&",f+=i[0]+"="+i[1])}return null!==c&&(""==f?f="?":f+="&",f+=b+"="+c),e[0]+f},add_yao_prefix=function(a){return"http://yao.qq.com/tv/entry?redirect_uri="+encodeURIComponent(a)};$(function(){$.ajax({type:"get",async:!1,url:domain_url+"version/check",dataType:"jsonp",jsonp:"callback",jsonpCallback:"callbackVersionHandler",success:function(a){a.result||(location.href=a.redirect),share_img=share_img?share_img:a.si,share_title=share_title?share_title:a.st,share_desc=share_desc?share_desc:a.sd,window.shaketv&&shaketv.wxShare(share_img,share_title,share_desc,getUrl())},error:function(){}})});var getResult=function(a,b,c,d,e,f){d&&showLoading(e);var a=domain_url+a;"undefined"!=typeof isDev&&isDev.length>0&&(a=add_param(a,"dev",isDev,!0)),$.ajax({type:"GET",async:"undefined"==typeof f?!1:f,url:a,data:b,dataType:"jsonp",jsonp:c,complete:function(){d&&hideLoading(e)},success:function(a){}})},simpleTpl=function(a){return a=$.isArray(a)?a.join(""):a||"",{store:a,_:function(){var a=this;return $.each(arguments,function(b,c){a.store+=c}),this},toString:function(){return this.store}}},showLoading=function(a){var b=simpleTpl(),a=a||$("body"),c=a?a.find(".spinner"):$("body").children(".spinner");if(c.length>0)c.show();else{b._('<div class="spinner">')._('<div class="spinner-wrapper">')._('<div class="spinner-container container1">')._('<div class="circle1"></div>')._('<div class="circle2"></div>')._('<div class="circle3"></div>')._('<div class="circle4"></div>')._("</div>")._('<div class="spinner-container container2">')._('<div class="circle1"></div>')._('<div class="circle2"></div>')._('<div class="circle3"></div>')._('<div class="circle4"></div>')._("</div>")._('<div class="spinner-container container3">')._('<div class="circle1"></div>')._('<div class="circle2"></div>')._('<div class="circle3"></div>')._('<div class="circle4"></div>')._("</div>")._("</div>")._("</div>");var d=$(window).width(),e=$(window).height(),f=50;c=$(b.toString()).css({left:(d-f)/2,top:(e-f)/2}),a.append(c)}},hideLoading=function(a){a?a.find(".spinner").hide():$("body").children(".spinner").hide(),$(".copyright").removeClass("hidden")};!function(a){a.openid=$.fn.cookie(mpappid+"_openid"),a.headimgurl=$.fn.cookie(mpappid+"_headimgurl"),a.nickname=$.fn.cookie(mpappid+"_nickname"),a.expires_in={expires:30},a.Authorize=function(a){this.mpappid=a&&a.mpappid||mpappid,this.serviceNo=a&&a.serviceNo||serviceNo,this.scope="snsapi_userinfo",this.redirect_uri=domain_url+"api/mp/auth/snsapi_userinfo",this.callBackPage=a&&a.callBackPage||"",this.param=""},Authorize.prototype.authorize=function(a){window.location.href="https://open.weixin.qq.com/connect/oauth2/authorize?appid="+this.mpappid+"&redirect_uri="+encodeURIComponent(this.redirect_uri+"?callBackPage="+this.callBackPage+"&param="+this.param)+"&response_type=code&scope="+this.scope+"&state="+this.serviceNo+"#wechat_redirect",a&&a()},Authorize.prototype.getQueryParam=function(a){var b=decodeURIComponent(location.search.slice(1));if(""!=b){for(var c,d=b.split("&"),e=0,f=d.length;f>e;e++)if(c=d[e].split("="),c[0]===a)return c[1];return""}return""},Authorize.prototype.getParam=function(){for(var a,b={},c=decodeURIComponent(location.search.slice(1)).split("&"),d=0,e=c.length;e>d;d++)a=c[d].split("="),b[a[0]]=a[1];this.param=encodeURIComponent(JSON.stringify(b))},Authorize.prototype.init=function(a){this.getParam();var b=this;openid&&nickname?($.fn.cookie(mpappid+"_openid",openid,expires_in),a&&setTimeout(function(){a()},50)):(openid=b.getQueryParam("openid"),openid&&$.fn.cookie(mpappid+"_openid",openid,expires_in),openid||b.authorize(function(){})),headimgurl?$.fn.cookie(mpappid+"_headimgurl",headimgurl,expires_in):(headimgurl=b.getQueryParam("headimgurl"),headimgurl&&$.fn.cookie(mpappid+"_headimgurl",headimgurl,expires_in)),nickname?$.fn.cookie(mpappid+"_nickname",nickname,expires_in):(nickname=b.getQueryParam("nickname"),nickname&&$.fn.cookie(mpappid+"_nickname",nickname,expires_in))};var b=getQueryString("uid"),c=getQueryString("auid");b?new Authorize({callBackPage:"zuji-share.html"}).init():c?new Authorize({callBackPage:"toutiao.html"}).init():(new Authorize).init()}(window);var str2date=function(a){return a=a.replace(/-/g,"/"),new Date(a)},timestamp=function(a){return str2date(a).getTime()},dateformat=function(date,format){var z={M:date.getMonth()+1,d:date.getDate(),h:date.getHours(),m:date.getMinutes(),s:date.getSeconds()};return format=format.replace(/(M+|d+|h+|m+|s+)/g,function(v){return((v.length>1?"0":"")+eval("z."+v.slice(-1))).slice(-2)}),format.replace(/(y+)/g,function(a){return date.getFullYear().toString().slice(-a.length)})},preloadimages=function(a){function b(){d++,d==a.length&&e(c)}for(var c=[],d=0,e=function(){},a="object"!=typeof a?[a]:a,f=0;f<a.length;f++)c[f]=new Image,c[f].src=a[f],c[f].onload=function(){b()},c[f].onerror=function(){b()};return{done:function(a){e=a||e}}};!function(a){H.rule={$dialog:a(".dialog"),$rule:a("#rule"),$tab:a(".tab"),$tabRule:a("#tab_rule"),$tabScore:a("#tab_score"),$tabAllScore:a("#tab_all_score"),$tabTicket:a("#tab_ticket"),$contentRule:a("#content_rule"),$contentScore:a("#content_score"),$contentTicket:a("#content_ticket"),$close:a(".dialog-close"),dialogTopRatio:580/87,dialogBottomRatio:580/34,init:function(){this.resize(),this.bindBtn(),this.prereserve()},resize:function(){width=a(window).width(),height=a(window).height();var b=.9*width/this.dialogTopRatio;a(".dialog .dialog-top").css({height:b,"background-size":.9*width});var c=.9*width/this.dialogBottomRatio;a(".dialog .dialog-bottom").css({height:c,"background-size":.9*width});var d=height-b-c-20;a(".dialog .dialog-center").css({height:d,"background-size":.9*width}),a(".dialog .separator").css({"background-size":.8*width});var e=height-125-20;this.$contentRule.css("height",e),this.$contentScore.css("height",e),this.$contentTicket.css("height",e)},ruleCallback:function(a){this.$contentRule.html(a.rule)},ruleError:function(){alert("网络错误，请稍后重试"),a(".dialog-wrapper").addClass("none")},bindBtn:function(){this.$rule.click(function(){a("body,html").scrollTop(0),a("#guize").parent().removeClass("none"),showLoading(),getResult("api/common/rule",null,"commonApiRuleHandler")}),this.$tabScore.click(function(){a(".tab a").removeClass("active"),H.rule.$tabScore.addClass("active"),a(".tab-content").addClass("none"),H.rule.$contentScore.removeClass("none"),H.rule.$contentScore.find(".detail").text("我的积分：0 排名：暂无排名").removeClass("none"),H.rule.$contentScore.find(".rank-list").html(""),showLoading(),getResult("api/lottery/integral/rank/self",{oi:openid,pu:H.router.currentDate},"callbackIntegralRankSelfRoundHandler"),getResult("api/lottery/integral/rank/top10",{pu:H.router.currentDate},"callbackIntegralRankTop10RoundHandler")}),this.$tabAllScore.click(function(){a(".tab a").removeClass("active"),H.rule.$tabAllScore.addClass("active"),a(".tab-content").addClass("none"),H.rule.$contentScore.removeClass("none"),H.rule.$contentScore.find(".detail").text("我的积分：0 排名：暂无排名").addClass("none"),H.rule.$contentScore.find(".rank-list").html(""),showLoading(),getResult("api/lottery/integral/total/rank/top10",{oi:openid},"callbackIntegralTotalRankTop10Handler")}),this.$tabRule.click(function(){a(".tab a").removeClass("active"),H.rule.$tabRule.addClass("active"),a(".tab-content").addClass("none"),H.rule.$contentRule.removeClass("none")}),this.$tabTicket.click(function(){a(".tab a").removeClass("active"),H.rule.$tabTicket.addClass("active"),a(".tab-content").addClass("none"),H.rule.$contentTicket.removeClass("none"),H.rule.$contentTicket.find(".rank-list").html(""),showLoading(),getResult("api/lottery/record",{oi:openid,pt:5},"callbackLotteryRecordHandler")}),this.$close.click(function(){a(this).parent().parent().addClass("none")}),a("#appointment").click(function(b){b.preventDefault();var c=a(this).attr("data-reserveid");c&&shaketv.reserve(yao_tv_id,c,function(a){})})},fillSelfData:function(a){a["in"]?this.$contentScore.find(".detail").text("我的积分："+a["in"]+" 排名："+a.rk):this.$contentScore.find(".detail").text("我的积分：0 排名：暂无排名")},fillListData:function(a){var b=simpleTpl();for(var c in a.top10)b._("<li>")._('<section class="avatar">')._('<img src="'+a.top10[c].hi+'" onerror="this.src=\'./images/avatar.jpg\'" />')._("</section>")._('<section class="nickname">')._(a.top10[c].nn?a.top10[c].nn:"匿名用户")._("</section>")._('<section class="rank">第')._(a.top10[c].rk)._("名</section>")._("</li>");this.$contentScore.find(".rank-list").html(b.toString())},fillTicketListData:function(a){var b=simpleTpl();b._('<li class="ticket-wrapper">')._('<section class="ticket-name center">')._("类型")._("</section>")._('<section class="ticket-code center">')._("密钥")._("</section>")._("</li>");for(var c in a.rl)b._('<li class="ticket-wrapper">')._('<section class="ticket-name">')._(a.rl[c].pn)._("</section>")._('<section class="ticket-code">')._(a.rl[c].cc)._("</section>")._("</li>");this.$contentTicket.find(".rank-list").html(b.toString())},prereserve:function(){a.ajax({type:"GET",async:!0,url:domain_url+"api/program/reserve/get",data:{},dataType:"jsonp",jsonpCallback:"callbackProgramReserveHandler",success:function(b){b.reserveId&&window.shaketv&&shaketv.preReserve(yao_tv_id,b.reserveId,function(c){0==c.errorCode&&a("#appointment").removeClass("none").attr("data-reserveid",b.reserveId)})}})}},W.commonApiRuleHandler=function(a){hideLoading(),0==a.code?H.rule.ruleCallback(a):H.rule.ruleError()},W.callbackIntegralRankSelfRoundHandler=function(a){hideLoading(),1==a.result&&H.rule.fillSelfData(a)},W.callbackIntegralRankTop10RoundHandler=function(a){hideLoading(),1==a.result&&H.rule.fillListData(a)},W.callbackIntegralTotalRankTop10Handler=function(a){hideLoading(),1==a.result&&H.rule.fillListData(a)},W.callbackLotteryRecordHandler=function(a){hideLoading(),1==a.result&&H.rule.fillTicketListData(a)}}(Zepto);