$.fn.countdown = function(b) {
	$.fn.countdown.defaultVal = {
		eAttr: "data-etime",
		sAttr: "data-stime",
		wTime: 500,
		stpl: "%H%:%M%:%S%",
		etpl: "%H%:%M%:%S%",
		otpl: "已结束",
		callback: function() {}
	};
	var d = $.extend({}, $.fn.countdown.defaultVal, b),
		c = $(this);
	var a = function() {
			var e = new Date().getTime();
			c.each(function() {
				var g = $(this),
					l = 1,
					f = parseInt(g.attr(d.sAttr)),
					j = parseInt(g.attr(d.eAttr)),
					i = isNaN(f) ? 0 : f - e,
					k = isNaN(j) ? 0 : j - e;
				var h = function(m, q) {
						var p = Math.round((m % 60000) / d.wTime);
						p = dateNum(Math.min(Math.floor(p / 1000 * d.wTime), 59));
						var n = dateNum(Math.floor((m % 3600000) / 60000));
						var o = dateNum(Math.floor((m % 86400000) / 3600000));
						var r = dateNum(Math.floor(m / 86400000));
						g.html(q.replace(/%S%/, p).replace(/%M%/, n).replace(/%H%/, o).replace(/%D%/, r))
					};
				if (i > 0) { //wei kaishi
					l = 1;
					//h(i, d.stpl)
					//h(k, d.etpl);
				} else { //dao shu
					if (k > 0) {
						l = 2;
						h(k, d.etpl);
					} else { // jie shu
						l = 3;
						g.html(d.otpl);
						if(inserval){
							clearInterval(inserval);
						}
					}
				}
				d.callback && d.callback(l)
			})
		};

   a();
	var inserval = setInterval(function() {
		a();
	}, d.wTime)
};