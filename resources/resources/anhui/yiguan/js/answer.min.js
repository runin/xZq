function Lottery(l,i,k,g,h,j){this.conNode=l;this.background=null;this.backCtx=null;this.mask=null;this.maskCtx=null;this.lottery=null;this.lotteryType="image";this.cover=i||"#000";this.coverType=k;this.pixlesData=null;this.width=g;this.height=h;this.lastPosition=null;this.drawPercentCallback=j;this.vail=false;this.percent=30}Lottery.prototype={createElement:function(h,f){var g=document.createElement(h);for(var e in f){g.setAttribute(e,f[e])}return g},getTransparentPercent:function(a,q,i){var r=a.getImageData(0,0,q,i),p=r.data,o=[];for(var m=0,n=p.length;m<n;m+=4){var j=p[m+3];if(j<128){o.push(m)}}return(o.length/(p.length/4)*100).toFixed(2)},resizeCanvas:function(d,f,e){d.width=f;d.height=e;d.getContext("2d").clearRect(0,0,f,e)},resizeCanvas_w:function(d,f,e){d.width=f;d.height=e;d.getContext("2d").clearRect(0,0,f,e);if(this.vail){this.drawLottery()}else{this.drawMask()}},drawPoint:function(f,g,e){var h=$(this.mask).offset();f=f-h.left;g=g-h.top;this.maskCtx.beginPath();this.maskCtx.arc(f,g,30,0,Math.PI*2);this.maskCtx.fill();this.maskCtx.beginPath();this.maskCtx.lineWidth=60;this.maskCtx.lineCap=this.maskCtx.lineJoin="round";if(this.lastPosition){this.maskCtx.moveTo(this.lastPosition[0],this.lastPosition[1])}this.maskCtx.lineTo(f,g);this.maskCtx.stroke();this.lastPosition=[f,g];this.mask.style.zIndex=(this.mask.style.zIndex==20)?21:20},bindEvent:function(){var h=this;var j=(/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(navigator.userAgent.toLowerCase()));var f=j?"touchstart":"mousedown";var i=j?"touchmove":"mousemove";if(!j){var g=false;h.conNode.addEventListener("mouseup",function(a){a.preventDefault();g=false;var b=h.getTransparentPercent(h.maskCtx,h.width,h.height);if(b>=h.percent){if(typeof(h.drawPercentCallback)=="function"){h.drawPercentCallback()}}},false)}else{h.conNode.addEventListener("touchmove",function(a){if(g){a.preventDefault()}if(a.cancelable){a.preventDefault()}else{window.event.returnValue=false}},false);h.conNode.addEventListener("touchend",function(a){g=false;var b=h.getTransparentPercent(h.maskCtx,h.width,h.height);if(b>=h.percent){if(typeof(h.drawPercentCallback)=="function"){h.drawPercentCallback()}}},false)}this.mask.addEventListener(f,function(b){b.preventDefault();g=true;var c=(j?b.touches[0].pageX:b.pageX||b.x);var a=(j?b.touches[0].pageY:b.pageY||b.y);h.drawPoint(c,a,g)},false);this.mask.addEventListener(i,function(b){b.preventDefault();if(!g){return false}b.preventDefault();var c=(j?b.touches[0].pageX:b.pageX||b.x);var a=(j?b.touches[0].pageY:b.pageY||b.y);h.drawPoint(c,a,g)},false)},resize:function(l,h,i,k){var j=i/k,g=l/h;if(l>i||h>k){if(j<=g){k=i*(h/l)}else{i=k*(l/h)}}else{i=l;k=h}return{width:i,height:k}},drawLottery:function(){if(this.lotteryType=="image"){var d=new Image(),f=this;d.onload=function(){var b=f.resize(this.width,this.height,f.width,f.height),c=Math.ceil((f.width-b.width)/2),a=Math.ceil((f.height-b.height)/2);this.width=f.width;this.height=f.height;f.resizeCanvas(f.background,f.width,f.height);f.backCtx.drawImage(this,c,a,b.width,b.height);f.drawMask()};d.src=this.lottery}else{if(this.lotteryType=="text"){this.width=this.width;this.height=this.height;this.resizeCanvas(this.background,this.width,this.height);this.backCtx.save();this.backCtx.fillStyle="#FFF";this.backCtx.fillRect(0,0,this.width,this.height);this.backCtx.restore();this.backCtx.save();var e=30;this.backCtx.font="Bold "+e+"px Arial";this.backCtx.textAlign="center";this.backCtx.fillStyle="#F60";this.backCtx.fillText(this.lottery,this.width/2,this.height/2+e/2);this.backCtx.restore();this.drawMask()}}},drawMask:function(){if(this.coverType=="color"){this.maskCtx.fillStyle=this.cover;this.maskCtx.fillRect(0,0,this.width,this.height);this.maskCtx.globalCompositeOperation="destination-out"}else{if(this.coverType=="image"){var d=new Image(),c=this;d.onload=function(){c.resizeCanvas(c.mask,c.width,c.height);var a=(/android/i.test(navigator.userAgent.toLowerCase()));c.maskCtx.globalAlpha=0.98;c.maskCtx.drawImage(this,0,0,this.width,this.height,0,0,c.width,c.height);c.maskCtx.globalAlpha=1;c.maskCtx.globalCompositeOperation="destination-out"};d.src=this.cover}}},init:function(e,d){if(e){this.lottery=e;this.lottery.width=this.width;this.lottery.height=this.height;this.lotteryType=d||"image";this.vail=true}if(this.vail){this.background=this.background||this.createElement("canvas",{style:"position:absolute;left:0;top:0px;background-color:transparent;",id:"lottery-mask"})}this.mask=this.mask||this.createElement("canvas",{style:"position:absolute;left:0;top:0;background-color:transparent;",id:"lottery-cover"});this.mask.style.zIndex=20;if(!this.conNode.innerHTML.replace(/[\w\W]| /g,"")){if(this.vail){this.conNode.appendChild(this.background)}this.conNode.appendChild(this.mask);this.bindEvent()}if(this.vail){this.backCtx=this.backCtx||this.background.getContext("2d")}this.maskCtx=this.maskCtx||this.mask.getContext("2d");if(this.vail){this.drawLottery()}else{this.drawMask()}var f=this;window.addEventListener("resize",function(){f.width=document.documentElement.clientWidth;f.height=document.documentElement.clientHeight;f.resizeCanvas_w(f.mask,f.width,f.height)},false)}};(function(a){H.dialog={puid:0,$container:a("body"),REQUEST_CLS:"requesting",iscroll:null,init:function(){var b=this;this.$container.delegate(".btn-rule","click",function(c){c.preventDefault();H.dialog.rule.open()}).delegate(".btn-close","click",function(c){c.preventDefault();a(this).closest(".modal").addClass("none")}).delegate(".btn-result","click",function(c){c.preventDefault();H.dialog.result.open()}).delegate(".btn-lottery","click",function(c){c.preventDefault();H.dialog.lottery.open()}).delegate(".btn-comeon","click",function(c){c.preventDefault();H.dialog.guide.open()})},close:function(){a(".modal").addClass("none")},open:function(){H.dialog.close();if(this.$dialog){this.$dialog.removeClass("none")}else{this.$dialog=a(this.tpl());H.dialog.$container.append(this.$dialog)}H.dialog.relocate()},relocate:function(){var b=a(window).height(),c=a(window).width(),d=a(window).scrollTop()+b*0.06;a(".modal").each(function(){a(this).css({width:c,height:b}).find(".btn-close").css({right:c*0.06-15,top:d-15})});a(".dialog").each(function(){if(a(this).hasClass("relocated")){return}a(this).css({width:c*0.88,height:b*0.88,left:c*0.06,right:c*0.06,top:d,bottom:b*0.06});var e=a(this).find(".box");if(e.length>0){e.css("height",b*0.38)}})},guide:{$dialog:null,open:function(){H.dialog.open.call(this);this.event();var b=this;setTimeout(function(){b.close()},8000)},event:function(){var b=this;this.$dialog.find(".btn-try").click(function(c){c.preventDefault();b.close()})},close:function(){this.$dialog&&this.$dialog.addClass("none")},tpl:function(){var b=simpleTpl();b._('<section class="modal modal-guide" id="guide-dialog">')._('<div class="dialog guide-dialog relocated">')._("<h2>看《医馆笑传》微信摇一摇<strong>答题抽大奖</strong></h2>")._('<p class="ellipsis"><label>1.</label>打开电视，锁定安徽卫视</p>')._('<p class="ellipsis"><label>2.</label>打开微信，进入摇一摇(歌曲)</p>')._('<p class="ellipsis"><label>3.</label>对着电视摇一摇</p>')._('<a href="#" class="btn btn-try" data-collect="true" data-collect-flag="yg-guide-trybtn" data-collect-desc="引导弹层-关闭按钮">等下就去试试</a>')._("</div>")._("</section>");return b.toString()}},rule:{$dialog:null,open:function(){H.dialog.open.call(this);this.event();a("body").addClass("noscroll");getResult("common/rule",{},"callbackRuleHandler",true,this.$dialog)},close:function(){a("body").removeClass("noscroll");this.$dialog&&this.$dialog.addClass("none")},event:function(){var b=this;this.$dialog.find(".btn-close").click(function(c){c.preventDefault();b.close()})},update:function(b){this.$dialog.find(".rule").html(b).removeClass("none")},tpl:function(){var b=simpleTpl();b._('<section class="modal" id="rule-dialog">')._('<a href="#" class="btn-close" data-collect="true" data-collect-flag="yg-ruledialog-closebtn" data-collect-desc="规则弹层-关闭按钮"></a>')._('<div class="dialog rule-dialog">')._("<h2>活动规则</h2>")._('<div class="content border">')._('<div class="rule none"></div>')._("</div>")._('<p class="dialog-copyright">中奖信息详询微信公众号：天和医馆</p>')._("</div>")._("</section>");return b.toString()}},rank:{$dialog:null,open:function(){H.dialog.open.call(this);this.event();getResult("yiguan/transcript",{yoi:openid},"callbackYiguanTranscript",true,this.$dialog)},close:function(){this.$dialog&&this.$dialog.addClass("none")},event:function(){var b=this;this.$dialog.find(".btn-close").click(function(c){c.preventDefault();b.close()})},update:function(f){this.$dialog.find(".jf").text(f.iv);this.$dialog.find(".pm").text(f.rank);var e=simpleTpl(),c=f.items||[],b=c.length;for(var d=0;d<b;d++){e._("<li>")._('<span class="r-avatar"><img src="'+(c[d].hm?(c[d].hm+"/"+yao_avatar_size):"./images/avatar.jpg")+'" /></span>')._('<span class="r-name ellipsis">'+(c[d].n||"匿名用户")+"</span>")._('<span class="r-rank">第'+(c[d].rank||"-")+"名</span>")._("</li>")}this.$dialog.find("ul").html(e.toString())},tpl:function(){var b=simpleTpl();b._('<section class="modal" id="rank-dialog">')._('<a href="#" class="btn-close" data-collect="true" data-collect-flag="yg-rankdialog-closebtn" data-collect-desc="积分排行榜弹层-关闭按钮"></a>')._('<div class="dialog rank-dialog">')._("<h2>积分排行榜</h2>")._('<div class="list border">')._('<div class="content">')._('<h3>我的积分：<span class="jf"></span>排名：<span class="pm"></span></h3>')._("<ul></ul>")._("</div>")._("</div>")._("</div>")._("</section>");return b.toString()}},lottery:{iscroll:null,$dialog:null,LOTTERIED_CLS:"lotteried",REQUEST_CLS:"requesting",AWARDED_CLS:"lottery-awarded",LOTTERY_NONE_CLS:"lottery-none",open:function(){var f=this,g=this.$dialog;H.dialog.open.call(this);if(!g){this.event()}var e=this.$dialog.find(".cover"),h=this.$dialog.find(".back"),b=this.$dialog.find(".content"),c=true;var d=new Lottery(e.get(0),"images/bg-lottery-cover.jpg","image",b.width(),b.height(),function(){e.removeClass("zshow").html("");setTimeout(function(){e.addClass("none");if(!c){return}c=false;getResult("yiguan/lottery",{yoi:openid},"callbackYiguanLottery",true,f.$dialog)},5)});d.init();this.scroll_enable();this.$dialog&&this.$dialog.removeClass("none")},event:function(){var b=this;this.$dialog.find(".btn-award").click(function(g){g.preventDefault();if(a(this).hasClass(b.REQUEST_CLS)){return false}a(this).addClass(b.REQUEST_CLS);if(!b.check()){return false}var f=a.trim(b.$dialog.find(".mobile").val()),d=a.trim(b.$dialog.find(".name").val()),c=a.trim(b.$dialog.find(".address").val());b.disable();getResult("yiguan/award",{yoi:openid,rl:encodeURIComponent(d),ph:f,ad:encodeURIComponent(c)},"callbackYiguanAward",true,b.$dialog)});this.$dialog.find(".btn-close").click(function(c){c.preventDefault();if(b.$dialog&&b.$dialog.hasClass(b.LOTTERIED_CLS)&&!b.check()){return false}b.$dialog&&b.$dialog.remove();b.$dialog=null});this.$dialog.find(".btn-share").click(function(c){c.preventDefault();b.$dialog.find(".btn-close").trigger("click");b.reset();share()});if(is_android()){this.iscroll=new IScroll(this.$dialog.find(".dialog")[0],{mouseWheel:true,preventDefaultException:{tagName:/^(A|INPUT|TEXTAREA|BUTTON|SELECT)$/},});this.$dialog.find("input").focus(function(){b.$dialog.find(".dialog-inner").css("padding-bottom","70%").css("height","auto");if(b.iscroll){b.iscroll.refresh();b.iscroll.scrollToElement(a(this)[0])}})}},update:function(b){if(b.code===0){if(b.pt===3){alert("太棒了！恭喜你获得滴滴红包");window.location.href="didi.html";return}this.$dialog.find("h3").html("太棒了！恭喜你获得 "+(b.pn||"")+(b.pt===2?"":(" "+(b.co||"")+(b.pu||""))));this.$dialog.find("img").attr("src",(b.pi||""));this.$dialog.find(".name").val(b.rl||"");this.$dialog.find(".mobile").val(b.ph||"");this.$dialog.find(".address").val(b.ad||"");this.$dialog.addClass(this.LOTTERIED_CLS)}else{this.$dialog.addClass(this.LOTTERY_NONE_CLS)}this.$dialog.find(".back").removeClass("none");this.$dialog.removeClass(this.REQUEST_CLS)},check:function(){var f=this,e=f.$dialog.find(".mobile"),d=a.trim(e.val()),h=f.$dialog.find(".name"),c=a.trim(h.val()),g=f.$dialog.find(".address"),b=a.trim(g.val());if(!c){H.dialog.confirm.open(h);return false}else{if(!d){H.dialog.confirm.open(e);return false}else{if(f.pt==1&&!b){H.dialog.confirm.open(g);return false}}}if(c.length>20){alert("姓名太太太长了！");h.focus();return false}if(!/^\d{11}$/.test(d)){alert("这手机号，可打不通...");e.focus();return false}if(f.pt==1&&(b.length<5||b.length>60)){alert("地址长度为5~60个字符");g.focus();return false}return true},enable:function(){this.$dialog.find(".btn-award").removeClass(this.REQUEST_CLS)},disable:function(){this.$dialog.find(".btn-award").addClass(this.REQUEST_CLS)},scroll_enable:function(){if(this.iscroll){this.iscroll.scrollTo(0,0);this.iscroll.enable()}},scroll_disable:function(){if(this.iscroll){this.iscroll.scrollTo(0,0);this.iscroll.disable()}},succ:function(){this.scroll_disable();this.$dialog.addClass(this.AWARDED_CLS);this.$dialog.find("input").attr("disabled","disabled")},reset:function(){this.$dialog&&this.$dialog.remove();this.$dialog=null},close:function(){this.$dialog.find(".btn-close").trigger("click")},tpl:function(){var b=simpleTpl();b._('<section class="modal" id="lottery-dialog">')._('<a href="#" class="btn-close" data-collect="true" data-collect-flag="yg-lotterydialog-closebtn" data-collect-desc="抽奖弹层-关闭按钮"></a>')._('<div class="dialog lottery-dialog">')._('<div class="dialog-inner">')._("<h2>恭喜你，答对了！<br />快来刮开膏药，赢取奖品吧！</h2>")._('<div class="content">')._('<div class="cover zshow"></div>')._('<div class="back none">')._('<div class="award-win">')._("<h3></h3>")._('<div class="award-img">')._('<img src="" />')._("</div>")._('<div class="contact">')._('<h4 class="award-tip">请填写您的联系方式以便顺利领奖</h4>')._('<h4 class="awarded-tip">以下是您的联系方式，请等候工作人员联系</h4>')._('<p><input type="text" class="name" placeholder="姓名" /></p>')._('<p><input type="number" class="mobile" placeholder="联系电话" /></p>')._('<p><input type="text" class="address" placeholder="收件地址" /></p>')._('<a href="#" class="btn btn-award">确定</a>')._('<a href="#" class="btn btn-share">喜大普奔告诉小伙伴</a>')._("</div>")._("</div>")._('<div class="award-none none">')._("<h5>很遗憾，您未抽中奖品</h5>")._('<a href="#" class="btn-close">返回答题</a>')._("</div>")._("</div>")._("</div>")._("</div>")._('<p class="dialog-copyright">中奖信息详询微信公众号：天和医馆</p>')._("</div>")._("</section>");return b.toString()}},confirm:{$dialog:null,$focus_obj:null,open:function(b){this.$focus_obj=b;if(this.$dialog){this.$dialog.removeClass("none")}else{this.$dialog=a(this.tpl());H.dialog.$container.append(this.$dialog)}H.dialog.relocate();this.event()},close:function(){this.$dialog&&this.$dialog.addClass("none")},event:function(){var b=this;this.$dialog.find(".btn-confirm").click(function(c){c.preventDefault();b.close()})},tpl:function(){var b=simpleTpl();b._('<section class="modal" id="confirm-dialog">')._('<div class="dialog confirm-dialog relocated">')._('<div class="content">资料填写不全，将被视为自愿放弃奖品。</div>')._('<div class="ctrl">')._('<a href="#" class="btn btn-confirm">返回填写</a>')._("</div>")._("</div>")._("</section>");return b.toString()}}};W.callbackYiguanLottery=function(b){if(b.code>=0){H.dialog.lottery.update(b)}else{setTimeout(function(){alert(b.message);H.dialog.lottery.close()},50)}};W.callbackRuleHandler=function(b){if(b.code==0&&b.rule){H.dialog.rule.update(b.rule)}};W.callbackYiguanAward=function(b){H.dialog.lottery.enable();if(b.code==0){H.dialog.lottery.succ();return}alert(b.message)};W.callbackYiguanTranscript=function(b){H.dialog.rank.update(b)}})(Zepto);$(function(){H.dialog.init()});window.CACHEMSG.push("太搞笑了");window.CACHEMSG.push("天和医馆");window.CACHEMSG.push("陈赤赤陈赤赤，实在太帅啦");window.CACHEMSG.push("赤赤，我们会永远支持你的");window.CACHEMSG.push("男神，果然怎么看都帅");window.CACHEMSG.push("对你的爱，无从告白");window.CACHEMSG.push("怎么抽奖怎么抽奖啊");window.CACHEMSG.push("看预告片就好期待了");window.CACHEMSG.push("期待不愿将就的爱情");window.CACHEMSG.push("祝天下有情人终成眷属");(function(a){H.answer={tid:"",$article:a("#article"),$question:a("#question"),$answered:a("#answered"),$timebox:a("#time-box"),$answerTip:a("#answer-tip"),$btnRank:a("#ranking"),$inputCmt:a("#input-comment"),$btnCmt:a("#btn-comment"),$btnRule:a("#btn-rule"),$total:a("#total"),STARTING_CLS:"starting",STARTED_CLS:"started",ENDED_CLS:"ended",REQUEST_CLS:"requesting",currTime:new Date().getTime(),init:function(){if(!openid){window.location.href="index.html";return}H.utils.resize();getResult("yiguan/info",{yoi:openid},"callbackYiguanInfo",true,null,true);this.event();H.comment.init();this.updatepv();this.prereserve()},updatepv:function(){getResult("log/serpv",{},"callbackCountServicePvHander",false,null,true);setInterval(function(){getResult("log/serpv",{},"callbackCountServicePvHander",false,null,true)},5000)},fill:function(k){var f=simpleTpl(),c=k.qitems||[],h=c.length;this.$article.css("background-image","url("+k.bm+")");this.currTime=timestamp(k.cut);this.tid=k.tid;f._("<ul>");for(var e=0;e<h;e++){f._('<li data-qcode="'+c[e].qcode+'" data-ruid="'+c[e].ruid+'" data-stime="'+timestamp(c[e].qst)+'" data-etime="'+timestamp(c[e].qet)+'" id="question-'+c[e].quid+'" data-quid="'+c[e].quid+'">')._("<dl>")._("<dt>"+c[e].qt+"</dt>");var g=c[e].aitems||[];for(var d=0,b=g.length;d<b;d++){f._('<dd><a href="#" class="q-item" data-auid="'+g[d].auid+'" data-collect="true" data-collect-flag="ah-answer-answer" data-collect-desc="答题页面-答案按钮">'+g[d].at+"</a></dd>")}f._("</dl>")._("</li>")}f._("</ul>");this.$question.html(f.toString());this.progress()},progress:function(){var b=this;this.$question.find("li").each(function(){var d=a(this),c=d.attr("data-ruid");d.progress({cTime:b.currTime,stpl:"<span>%H%</span><i>:</i><span>%M%</span><i>:</i><span>%S%</span>",callback:function(g){var e="";switch(g){case 1:e=b.STARTING_CLS+" none";break;case 2:e=b.STARTED_CLS;break;default:e=b.ENDED_CLS+" none"}d.removeClass().addClass(e);var h=b.$question.find("li."+b.STARTED_CLS).not(function(){return parseInt(a(this).attr("data-qcode"))!==2}),i=b.$question.find("li."+b.STARTING_CLS);if(h.length>0){b.$answered.addClass("none");h.eq(0).removeClass("none");b.$question.removeClass("none")}else{b.$question.addClass("none");b.$answered.removeClass("none");if(i.length>0){var f=i.eq(0).prev("li");if(f&&parseInt(f.attr("data-qcode"))===0){b.$answered.addClass("error")}else{b.$answered.removeClass("error")}b.$timebox.html(i.eq(0).attr("data-timestr"))}else{if(d.next("li").length==0){clearInterval(window.progressTimeInterval);b.$timebox.addClass("none").siblings("h4").html('本期答题活动已结束，请等待下期答题<a href="#" class="btn-reserve" id="btn-reserve" data-collect="true" data-collect-flag="ah-answer-reservebtn" data-collect-desc="答题页面-预约本剧按钮">预约本剧</a>')}}}}})})},event:function(){var b=this;this.$question.delegate(".q-item","click",function(c){c.preventDefault();getResult("yiguan/answer",{yoi:openid,auid:a(this).attr("data-auid")},"callbackYiguanAnswer",true)});this.$btnRule.click(function(c){c.preventDefault();H.dialog.rule.open()});this.$btnRank.click(function(c){c.preventDefault();H.dialog.rank.open()});this.$answered.delegate("h4","click",function(d){d.preventDefault();var c=a(this).attr("data-reserveid");if(!c){return}shaketv.reserve(yao_tv_id,c,function(e){})});this.$btnCmt.click(function(d){d.preventDefault();if(a(this).hasClass(b.REQUEST_CLS)){return}var f=a.trim(b.$inputCmt.val())||"",f=f.replace(/<[^>]+>/g,""),c=f.length;if(c<1){alert("请先说点什么吧");b.$inputCmt.removeClass("error").addClass("error").focus();return}else{if(c>20){alert("观点字数超出了20字");b.$inputCmt.removeClass("error").addClass("error").focus();return}}a(this).addClass(b.REQUEST_CLS);showLoading();a.ajax({type:"GET",async:false,url:domain_url+"comments/save",data:{co:encodeURIComponent(f),op:openid,tid:b.tid,ty:1,nickname:nickname?encodeURIComponent(a.fn.cookie(shaketv_appid+"_nickname")):"",headimgurl:headimgurl?headimgurl:""},dataType:"jsonp",jsonpCallback:"callbackCommentsSave",complete:function(){hideLoading()},success:function(e){b.$btnCmt.removeClass(b.REQUEST_CLS);if(e.code==0){barrage.appendMsg(f);b.$inputCmt.removeClass("error").val("");return}alert(e.message)}})})},answered:function(c){this.$question.addClass("none");this.$answered.removeClass("none").addClass(c.rs===1?"":"error");if(c.rs===1){H.dialog.lottery.open()}var b=this.$getQuestion(c.quid);if(b){b.attr("data-qcode",c.rs)}},$getQuestion:function(b){return a("#question-"+b)},prereserve:function(){var b=this;a.ajax({type:"GET",async:true,url:domain_url+"program/reserve/get",data:{},dataType:"jsonp",jsonpCallback:"callbackProgramReserveHandler",success:function(c){if(!c.reserveId){return}window.shaketv&&shaketv.preReserve(yao_tv_id,c.reserveId,function(d){if(d.errorCode==0){b.$answered.find("h4").addClass("reserved").attr("data-reserveid",c.reserveId)}})}})}};H.comment={timer:5000,maxid:0,pageSize:10,$comments:a("#comments"),init:function(){var b=this;W.barrage=this.$comments.barrage();setTimeout(function(){W.barrage.start(1);setInterval(function(){b.flash()},b.timer)},1000)},flash:function(){var b=this;a.ajax({type:"GET",async:true,url:domain_url+"comments/room",data:{ps:b.pageSize,maxid:b.maxid},dataType:"jsonp",jsonpCallback:"callbackCommentsRoom",success:function(f){if(f.code!=0){return}b.maxid=f.maxid;var d=f.items||[];for(var e=0,c=d.length;e<c;e++){barrage.pushMsg(d[e].co)}}})}};H.utils={$header:a("header"),$wrapper:a("article"),$comments:a("#comments"),resize:function(){var b=a(window).height();this.$header.css("height",b*0.38);this.$wrapper.css("height",b*0.62);this.$comments.css("height",b*0.62-50);a("body").css("height",b)}};W.callbackYiguanInfo=function(b){if(b.code==0){H.answer.fill(b)}};W.callbackYiguanAnswer=function(b){if(b.code==0){H.answer.answered(b);return}alert(b.message)};W.callbackCountServicePvHander=function(b){if(b.code==0){H.answer.$total.text(b.c)}}})(Zepto);$(function(){H.answer.init()});