(function(a){H.dialog={puid:0,$container:a("#main"),expires:{expires:7},init:function(){var b=this;this.$container.delegate(".btn-rule","click",function(c){c.preventDefault();H.dialog.rule.open()}).delegate(".btn-close","click",function(c){c.preventDefault();a(this).closest(".modal").addClass("none")})},close:function(){a(".modal").addClass("none")},open:function(){H.dialog.close();if(this.$dialog){this.$dialog.removeClass("none")}else{this.$dialog=a(this.tpl());H.dialog.$container.append(this.$dialog)}H.dialog.relocate()},relocate:function(){var b=a(window).height(),c=a(window).width(),d=a(window).scrollTop()+b*0.06;a(".modal").css({width:c,height:b}).find(".btn-close").css({right:c*0.06-15,top:d-15})},guide:{$dialog:null,open:function(){H.dialog.open.call(this);this.event();var b=this;setTimeout(function(){b.close()},8000)},event:function(){var b=this;this.$dialog.find(".btn-try").click(function(c){c.preventDefault();b.close()})},close:function(){this.$dialog&&this.$dialog.addClass("none")},tpl:function(){var b=simpleTpl();b._('<section class="modal modal-guide" id="guide-dialog">')._('<div class="dialog guide-dialog relocated">')._("<h2></h2>")._("<p><label>1.</label>打开电视，锁定安徽卫视</p>")._("<p><label>2.</label>打开微信，进入摇一摇(歌曲)</p>")._("<p><label>3.</label>对着电视摇一摇，领取贺礼</p>")._("<p><label>4.</label>选择明星，一起送贺礼</p>")._('<a href="#" class="btn btn-try" data-collect="true" data-collect-flag="ah-guide-trybtn" data-collect-desc="引导弹层-关闭按钮">等下就去试试</a>')._("</div>")._("</section>");return b.toString()}}}})(Zepto);H.dialog.init();var stars=[{id:1,name:"乔任梁",avatar:"http://cdn.holdfun.cn/ahtv/images/stars/%E4%B9%94%E4%BB%BB%E6%A2%81.jpg",type:"audio",wish:"http://cdn.holdfun.cn/ahtv/audios/%E4%B9%94%E4%BB%BB%E6%A2%81.mp3",},{id:2,name:"俞飞鸿",avatar:"http://cdn.holdfun.cn/ahtv/images/stars/%E4%BF%9E%E9%A3%9E%E9%B8%BF.jpg",type:"audio",wish:"http://cdn.holdfun.cn/ahtv/audios/%E4%BF%9E%E9%A3%9E%E9%B8%BF.mp3"},{id:3,name:"刘诗诗",avatar:"http://cdn.holdfun.cn/ahtv/images/stars/%E5%88%98%E8%AF%97%E8%AF%97.jpg",type:"audio",wish:"http://cdn.holdfun.cn/ahtv/audios/%E5%88%98%E8%AF%97%E8%AF%97.mp3"},{id:4,name:"吴奇隆",avatar:"http://cdn.holdfun.cn/ahtv/images/stars/%E5%90%B4%E5%A5%87%E9%9A%86.jpg",type:"audio",wish:"http://cdn.holdfun.cn/ahtv/audios/%E5%90%B4%E5%A5%87%E9%9A%86.mp3"},{id:5,name:"孙艺洲",avatar:"http://cdn.holdfun.cn/ahtv/images/stars/%E5%AD%99%E8%89%BA%E6%B4%B2.jpg",type:"audio",wish:"http://cdn.holdfun.cn/ahtv/audios/%E5%AD%99%E8%89%BA%E6%B4%B2.mp3"},{id:6,name:"尚雯婕",avatar:"http://cdn.holdfun.cn/ahtv/images/stars/%E5%B0%9A%E9%9B%AF%E5%A9%95.jpg",type:"audio",wish:"http://cdn.holdfun.cn/ahtv/audios/%E5%B0%9A%E9%9B%AF%E5%A9%95.mp3"},{id:7,name:"徐正曦",avatar:"http://cdn.holdfun.cn/ahtv/images/stars/%E5%BE%90%E6%AD%A3%E6%9B%A6.jpg",type:"audio",wish:"http://cdn.holdfun.cn/ahtv/audios/%E5%BE%90%E6%AD%A3%E6%9B%A6.mp3"},{id:8,name:"李易峰",avatar:"http://cdn.holdfun.cn/ahtv/images/stars/%E6%9D%8E%E6%98%93%E5%B3%B0.jpg",type:"audio",wish:"http://cdn.holdfun.cn/ahtv/audios/%E6%9D%8E%E6%98%93%E5%B3%B0.mp3"},{id:9,name:"胡歌",avatar:"http://cdn.holdfun.cn/ahtv/images/stars/%E8%83%A1%E6%AD%8C.jpg",type:"audio",wish:"http://cdn.holdfun.cn/ahtv/audios/%E8%83%A1%E6%AD%8C.mp3"},{id:10,name:"赵丽颖",avatar:"http://cdn.holdfun.cn/ahtv/images/stars/%E8%B5%B5%E4%B8%BD%E9%A2%96.jpg",type:"audio",wish:"http://cdn.holdfun.cn/ahtv/audios/%E8%B5%B5%E4%B8%BD%E9%A2%96.mp3"},{id:11,name:"钟汉良",avatar:"http://cdn.holdfun.cn/ahtv/images/stars/%E9%92%9F%E6%B1%89%E8%89%AF.jpg",type:"audio",wish:"http://cdn.holdfun.cn/ahtv/audios/%E9%92%9F%E6%B1%89%E8%89%AF.mp3"},{id:12,name:"陈伟霆",avatar:"http://cdn.holdfun.cn/ahtv/images/stars/%E9%99%88%E4%BC%9F%E9%9C%86.jpg",type:"audio",wish:"http://cdn.holdfun.cn/ahtv/audios/%E9%99%88%E4%BC%9F%E9%9C%86.mp3"},{id:13,name:"陈数",avatar:"http://cdn.holdfun.cn/ahtv/images/stars/%E9%99%88%E6%95%B0.jpg",type:"audio",wish:"http://cdn.holdfun.cn/ahtv/audios/%E9%99%88%E6%95%B0.mp3"},{id:14,name:"陈赫",avatar:"http://cdn.holdfun.cn/ahtv/images/stars/%E9%99%88%E8%B5%AB.jpg",type:"audio",wish:"http://cdn.holdfun.cn/ahtv/audios/%E9%99%88%E8%B5%AB.mp3"},{id:15,name:"颖儿",avatar:"http://cdn.holdfun.cn/ahtv/images/stars/%E9%A2%96%E5%84%BF.jpg",type:"audio",wish:"http://cdn.holdfun.cn/ahtv/audios/%E9%A2%96%E5%84%BF.mp3"},{id:16,name:"霍建华",avatar:"http://cdn.holdfun.cn/ahtv/images/stars/%E9%9C%8D%E5%BB%BA%E5%8D%8E.jpg",type:"text",wish:"元宝祝你新年结金玉良缘"},{id:17,name:"周迅",avatar:"http://cdn.holdfun.cn/ahtv/images/stars/%E5%91%A8%E8%BF%85.jpg",type:"text",wish:"九儿祝你新年红似高粱"},{id:18,name:"张歆艺",avatar:"http://cdn.holdfun.cn/ahtv/images/stars/%E5%BC%A0%E6%AD%86%E8%89%BA.jpg",type:"text",wish:"新年和你一起二！"},{id:19,name:"张杰",avatar:"http://cdn.holdfun.cn/ahtv/images/stars/%E5%BC%A0%E6%9D%B0.jpg",type:"text",wish:"新年，和爱的人一起度过"},{id:20,name:"张嘉译",avatar:"http://cdn.holdfun.cn/ahtv/images/stars/%E5%BC%A0%E5%98%89%E8%AF%91.jpg",type:"text",wish:"新年快乐，大叔爱你"}];var virtualDatas=[{id:1,message:" <p>2014年您辛苦了，</p><p>让我给你揉揉肩吧！</p>",priurl:"http://cdn.holdfun.cn/ahtv/images/vartual_prize.png"},{id:2,message:" <p>2014年您辛苦了，</p><p>让我给你按按摩吧！</p>",priurl:"http://cdn.holdfun.cn/ahtv/images/vartual_prize_am.png",},{id:3,message:" <p>2014年您辛苦了，</p><p>让我给你捶捶背吧！</p>",priurl:"http://cdn.holdfun.cn/ahtv/images/vartual_prize_cb.png",},{id:4,message:" <p>2014年您辛苦了，</p><p>让我给你松松腿吧！</p>",priurl:"http://cdn.holdfun.cn/ahtv/images/vartual_prize_st.png",},];WeixinApi.ready(function(a){var b={appId:shaketv_token,imgUrl:share_img,link:add_param(share_url.replace("stars.html","index.html"),"resopenid",hex_md5(openid),true),desc:share_desc,title:share_title};var c={favorite:false,async:true,ready:function(){var d=$("#btn-sendcard");if(d&&!d.hasClass("shared")){d.trigger("click")}this.dataLoaded({title:share_title,link:add_yao_prefix(add_param(share_url.replace("stars.html","index.html"),"resopenid",hex_md5(openid),true)),desc:share_desc,imgUrl:share_img})}};a.shareToFriend(b,c);a.shareToTimeline(b,c);a.generalShare(b,c)});(function(a){H.card={star_id:getQueryString("id"),$btn_send:a("#btn-sendcard"),$btn_award:a("#btn-award"),$btns:a(".btn"),$star:a("#box-star"),$me:a("#box-me"),$mywish:a("#mywish"),$tips:a("#tips"),$audio:null,init:function(){H.utils.resize();this.event();if(!this.star_id){window.location.href="stars.html";return false}this.$btns.addClass("none");if(this.is_view()){this.$btn_award.removeClass("none");H.dialog.guide.open();getResult("ceremony/cardinfo?cu="+this.star_id,{},"callbackCardInfoHandler",true)}else{this.$btn_send.removeClass("none");this.fill_data((parseInt(this.star_id)||1)-1,{name:a.fn.cookie("da-nickname")||"",avatar:a.fn.cookie("da-avatar")?(a.fn.cookie("da-avatar")+"/"+avatar_size):""})}},is_view:function(){return this.star_id.length>2},fill_data:function(b,d){var c=W.stars[b];if(!c){return}this.$star.find(".content").addClass(c.type);this.$star.find("img").attr("src",c.avatar||"");if(c.type=="audio"){this.$audio=a('<audio preload="auto" class="audio none" src="'+c.wish+'"></audio>');this.$star.append(this.$audio);this.audio_ready()}else{this.$star.find(".wish").text(c.wish||"")}this.$star.find(".name").text(c.name||"");this.$tips.find("strong").text(c.name||"");this.$me.find(".name").text(d.name);this.$me.find("img").attr("src",d.avatar);if(d.wish){this.$me.find(".wish").html(d.wish)}},audio_ready:function(){var b=this;this.$audio.on("loadedmetadata",function(){b.$star.find(".wish").text(Math.ceil(a(this).get(0).duration)+"'");this.play()})},text:function(){return this.$mywish.val()||"祝大家2015年万事如意，天天开心～"},event:function(){var b=this;this.$star.find(".wish").click(function(){var d=a(this),c=b.$star.find("audio");if(d.hasClass("scale")){return}d.closest(".content").addClass("scale");c.get(0).play();c.on("playing",function(){console.log("playing")}).on("ended",function(){console.log("ended");c.get(0).pause();d.closest(".content").removeClass("scale")})});this.$btn_send.click(function(c){c.preventDefault();if(b.is_view()){window.location.href="stars.html";return}getResult("ceremony/makecard",{oi:openid,sn:b.star_id,gt:encodeURIComponent(b.text())},"callbackMakeCardHandler",true)});this.$btn_award.click(function(c){c.preventDefault();window.location.href="index.html?award=true"})}};H.utils={$main:a("#main"),resize:function(){var e=this,d=a(window).width(),b=a(window).height(),c="http://cdn.holdfun.cn/ahtv/images/bg-card.jpg";this.$main.css("minHeight",b);showLoading();imgReady(c,function(){hideLoading();e.$main.css("background-image","url("+c+")")})}};W.callbackMakeCardHandler=function(c){if(c&&c.result){var b=share_url;b=add_param(b,"id",c.cu,true);b=add_param(b,"soi",openid,true);b=add_param(b,"sn",H.card.star_id,true);share_desc=H.card.text();share_title="我跟"+a("#tips").find("strong").text()+"在国剧盛典现场给你送贺礼啦";share_url=b;share();H.card.$btn_send.addClass("shared");return}alert("制作贺卡失败,请重试")};W.callbackCardInfoHandler=function(b){if(b&&b.result){H.card.fill_data(b.sn-1,{avatar:b.hi+"/"+avatar_size,name:b.nn,wish:b.gt})}}})(Zepto);H.card.init();