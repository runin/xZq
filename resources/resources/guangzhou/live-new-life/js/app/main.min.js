H.openjs={localId:"",serverId:"",init:function(){window.callbackJsapiTicketHandler=function(a){};$.ajax({type:"GET",url:domain_url+"mp/jsapiticket",data:{appId:shaketv_appid},async:true,dataType:"jsonp",jsonpCallback:"callbackJsapiTicketHandler",success:function(d){if(d.code!==0){return}var e="da7d7ce1f499c4795d7181ff5d045760",c=Math.round(new Date().getTime()/1000),b=window.location.href.split("#")[0],a=hex_sha1("jsapi_ticket="+d.ticket+"&noncestr="+e+"&timestamp="+c+"&url="+b);wx.config({debug:false,appId:shaketv_appid,timestamp:c,nonceStr:e,signature:a,jsApiList:["addCard"]})},error:function(b,a){alert("获取微信授权失败！")}})}};H.openjs.init();$(function(){var a={showPage:function(b,d,e){var c=$(".page");c.addClass("none");c.each(function(g,h){var f=$(h);if(f.attr("id")==b){f.removeClass("none");a.currentPage=f;if(d){d(f)}return false}})},loadData:function(g){var f=$.extend({url:"",type:"get",async:false,dataType:"jsonp",showload:true},g);if(f.showload){W.showLoading()}var c=0;var e="";var b=null;for(var d in g){c++;if(c==2){e=d;b=g[d];break}}$.ajax({type:f.type,data:g.data,async:f.async,url:f.url,dataType:f.dataType,jsonpCallback:e,success:function(h){W.hideLoading();b(h)},error:function(){if(g.error){g.error()}W.hideLoading()}})},loadImg:function(c){if(!this.images){this.images=[]}if(c&&!(c instanceof Array)){c.isLoad=false;this.images.push(c)}else{if((c instanceof Array)){for(var e=0;e<c.length;e++){c[e].isLoad=false;this.images.push(c[e])}}}for(var d=0;d<this.images.length;d++){var f=this;if(!this.images[d].isLoad){var b=new Image();b.src=this.images[d].src;this.images[d].isLoad=true;b.onload=function(){}}}},module:function(d,c,b){!a[d]&&(a[d]=new c());if(b){$(function(){b()})}}};a.module("main",function(){window.judge=true;var b={pdCook:function(){if(getQueryString("rp")==1){d.lyHtml();$("#hb-success").removeClass("none");d.promotion();d.closeBtn();judge=false}}};var f={ruleHtml:function(){var g=simpleTpl();g._('<section class="ruel-pop">');g._('<div class="ruel-con">');g._('<a href="###" class="r-close"></a>');g._('<div class="ruel-text">');g._("<h2>活动规则</h2>");g._('<div class="ruel-list"></div>');g._("</div>");g._("</div>");g._("</section>");$("body").append(g.toString())},ruleBtn:function(){$(".rule-bt").click(function(){f.ruleHtml();judge=false;a.loadData({url:domain_url+"api/common/rule",commonApiRuleHandler:function(g){if(g.code==0){$(".ruel-list").html(g.rule)}}})});$("body").delegate(".r-close","click",function(g){$(".ruel-pop").remove();judge=true})}};var e={shake:function(){W.addEventListener("shake",e.shake_listener,false)},unshake:function(){W.removeEventListener("shake",e.shake_listener,false)},shake_listener:function(){if(judge==false){return}if(!$(".yao-con").hasClass("yaoing")){$("#audio-a").get(0).play();$(".yao-con").addClass("yaoing");setTimeout(function(){$(".yao-con").removeClass("yaoing");e.article()},1000)}},article:function(){a.loadData({url:domain_url+"api/article/list",callbackArticledetailListHandler:function(k){if(k.code==0){var j=k.arts;var h=j.length;var g=Math.floor(Math.random()*h);window.location.href="lottery.html?uid="+j[g].uid+""}}})}};var d={lyHtml:function(){var g=simpleTpl();g._('<section class="main-pop" id="main">');g._('<div class="pop-redbao none" id="hongbao">');g._('<a href="###" class="p-close"></a>');g._('<p id="money"></p>');g._('<a href="" class="btn-a" id="money-btn" data-collect="true" data-collect-flag="live-lqhb" data-collect-desc="领取红包">领 取</a>');g._("</div>");g._('<div class="pop-kj none" id="kajuan">');g._('<a href="###" class="p-close"></a>');g._('<h2 id="kjname"></h2>');g._('<p id="kjimg" data-ci="" data-ts="" data-si=""></p>');g._('<h3 class="none" id="lookkj">( 代金劵已发微信卡包，请查看 )</h3>');g._('<a href="###" class="btn-b" id="addcard" data-collect="true" data-collect-flag="live-lqdjj" data-collect-desc="领取代金劵">领 取</a>');g._('<a href="###" class="btn-b none" id="djjbtn" data-collect="true" data-collect-flag="live-djjbtn" data-collect-desc="代金劵领取成功">确 定</a>');g._("</div>");g._('<div class="pop-kj none" id="error">');g._('<a href="###" class="p-close"></a>');g._('<h4 id="awtext"></h4>');g._('<h5 class="none" id="myf">缘分就这样擦身而过了，啥也没有抽中！</h5>');g._('<p class="none" id="mzjimg"></p>');g._('<a href="###" class="btn-b" id="errorbtn" data-collect="true" data-collect-flag="live-jxjy" data-collect-desc="继续加油">继续加油</a>');g._("</div>");g._('<div class="pop-kj none" id="hb-success">');g._('<a href="###" class="p-close"></a>');g._("<h6>领取成功！</h6>");g._('<a href="" class="xzq-tg" data-collect="true" data-collect-flag="tttj" data-collect-desc="天天淘金"></a>');g._('<a href="###" class="btn-b" id="successbtn">确 定</a>');g._("</div>");g._("</section>");$("body").append(g.toString());d.closeBtn()},lyBtn:function(){$("#lottery-btn").click(function(){d.lyHtml();a.loadData({url:domain_url+"api/lottery/luck",callbackLotteryLuckHandler:function(g){if(g.result==true){judge=false;if(g.pt==4){$("#hongbao").removeClass("none");$("#money").text(g.pn);$("#money-btn").attr("href",g.rp)}else{if(g.pt==7){$("#kajuan").removeClass("none");$("#batchAddCard").removeClass("none");$("#kjname").text(g.pn+"一"+g.pu);$("#kjimg").css("backgroundImage","url('"+g.pi+"')").attr({"data-ci":g.ci,"data-ts":g.ts,"data-si":g.si});d.djjBtn()}else{$("#error").removeClass("none");$("#awtext").text(g.tt);$("#mzjimg").css("backgroundImage","url('"+g.pi+"')").removeClass("none")}}}else{$("#awtext").text("真不好意思！");$("#error").removeClass("none");$("#myf").removeClass("none")}},data:{oi:openid}})})},djjBtn:function(){document.querySelector("#addcard").onclick=function(){var h=$("#kjimg").attr("data-ci");var i=$("#kjimg").attr("data-ts");var g=$("#kjimg").attr("data-si");wx.addCard({cardList:[{cardId:h,cardExt:'{"timestamp":"'+i+'","signature":"'+g+'"}'}],success:function(j){$("#addcard").addClass("none");$("#djjbtn,#lookkj").removeClass("none")},fail:function(j){},complete:function(){}})}},promotion:function(){a.loadData({url:domain_url+"api/common/promotion",commonApiPromotionHandler:function(g){if(g.code==0&&g.desc&&g.url){$(".xzq-tg").text(g.desc||"").attr("href",(g.url||""))}else{$(".xzq-tg").remove()}},data:{oi:openid}})},closeBtn:function(){$("body").delegate(".p-close,#successbtn,#errorbtn,#djjbtn","click",function(g){$("#main").remove();judge=true})}};var c=function(){$("#favourable").click(function(){window.location.href="card.html"});$("#mylk").click(function(){window.location.href="my.html"})};this.init=function(){b.pdCook();e.shake();wx.ready(function(){d.lyBtn()});wx.error(function(g){});c();f.ruleBtn()};this.init()})});