H.openjs={localId:"",serverId:"",init:function(){window.callbackJsapiTicketHandler=function(a){};$.ajax({type:"GET",url:domain_url+"mp/jsapiticket",data:{appId:shaketv_appid},async:true,dataType:"jsonp",jsonpCallback:"callbackJsapiTicketHandler",success:function(d){if(d.code!==0){return}var e="da7d7ce1f499c4795d7181ff5d045760",c=Math.round(new Date().getTime()/1000),b=window.location.href.split("#")[0],a=hex_sha1("jsapi_ticket="+d.ticket+"&noncestr="+e+"&timestamp="+c+"&url="+b);wx.config({debug:false,appId:shaketv_appid,timestamp:c,nonceStr:e,signature:a,jsApiList:["addCard"]})},error:function(b,a){alert("获取微信授权失败！")}})}};H.openjs.init();$(function(){var a={showPage:function(b,d,e){var c=$(".page");c.addClass("none");c.each(function(g,h){var f=$(h);if(f.attr("id")==b){f.removeClass("none");a.currentPage=f;if(d){d(f)}return false}})},loadData:function(g){var f=$.extend({url:"",type:"get",async:false,dataType:"jsonp",showload:true},g);if(f.showload){W.showLoading()}var c=0;var e="";var b=null;for(var d in g){c++;if(c==2){e=d;b=g[d];break}}$.ajax({type:f.type,data:g.data,async:f.async,url:f.url,dataType:f.dataType,jsonpCallback:e,success:function(h){W.hideLoading();b(h)},error:function(){if(g.error){g.error()}W.hideLoading()}})},loadImg:function(c){if(!this.images){this.images=[]}if(c&&!(c instanceof Array)){c.isLoad=false;this.images.push(c)}else{if((c instanceof Array)){for(var e=0;e<c.length;e++){c[e].isLoad=false;this.images.push(c[e])}}}for(var d=0;d<this.images.length;d++){var f=this;if(!this.images[d].isLoad){var b=new Image();b.src=this.images[d].src;this.images[d].isLoad=true;b.onload=function(){}}}},module:function(d,c,b){!a[d]&&(a[d]=new c());if(b){$(function(){b()})}}};a.module("card",function(){var c={cardH:function(){var d=$(window).height();$(".card-box").css("min-height",d-50)}};var b={uuid:null,number:0,pal:8,wxcardList:function(){a.loadData({url:domain_url+"api/lottery/prizes",callbackLotteryPrizesHandler:function(h){if(h.result==true){var f=simpleTpl();var g=h.pa;var d=g.length;if(g.length<=8){for(var e=0;e<d;e++){f._('<li data-ci="'+h.ci+'" data-ts="'+h.ts+'" data-si="'+h.si+'" id="'+g[e].id+'">');f._('<img src="'+g[e].pi+'" />');f._('<span class="none">'+g[e].tp+"</span>");f._('<i class="none">'+g[e].pd+"</i>");f._("</li>")}}else{if(d>b.pal){$(".more-yh").removeClass("none");for(var e=b.number;e<b.pal;e++){f._('<li data-ci="'+h.ci+'" data-ts="'+h.ts+'" data-si="'+h.si+'" id="'+g[e].id+'">');f._('<img src="'+g[e].pi+'" />');f._('<span class="none">'+g[e].tp+"</span>");f._('<i class="none">'+g[e].pd+"</i>");f._("</li>")}b.number+=8;b.pal+=(d-b.pal)}else{for(var e=b.number;e<b.pal;e++){f._('<li data-ci="'+h.ci+'" data-ts="'+h.ts+'" data-si="'+h.si+'" id="'+g[e].id+'">');f._('<img src="'+g[e].pi+'" />');f._('<span class="none">'+g[e].tp+"</span>");f._('<i class="none">'+g[e].pd+"</i>");f._("</li>")}$(".more-yh").addClass("none")}}$("#card-img").append(f.toString());b.cardInfo()}},data:{at:5}})},moreyh:function(){$(".more-yh").click(function(){b.wxcardList()})},cardInfo:function(){$("#card-img>li").click(function(){b.uuid=$(this).attr("id");var g=$(this).find("img").attr("src");var f=$(this).find("span").text();var d=$(this).find("i").text();var e=$(this).attr("data-pt");$(".card-select").find("img").attr("src",g);$(".card-address").empty().text(f);$(".card-time").empty().text(d);$(".card-list").addClass("none");$(".card-details").removeClass("none");$(".go-home").addClass("none");$(".go-return").removeClass("none");b.lqCard()})},lqCard:function(){document.querySelector("#lqcard-a").onclick=function(){a.loadData({url:domain_url+"api/lottery/collect",callbackLotteryCollectHandler:function(d){if(d.result==0){if(d.pt==7){wx.addCard({cardList:[{cardId:d.ci,cardExt:'{"timestamp":"'+d.ts+'","signature":"'+d.si+'"}'}],success:function(e){$(".card-details").addClass("none");$(".card-collect").removeClass("none")},fail:function(e){$(".card-details").addClass("none");$(".card-collect").removeClass("none");$(".card-error").removeClass("none");$(".card-prosit").addClass("none")},complete:function(){}})}else{$(".card-details").addClass("none");$(".card-collect").removeClass("none")}}else{$(".card-details").addClass("none");$(".card-collect").removeClass("none");$(".card-error").removeClass("none");$(".card-prosit").addClass("none")}},data:{oi:openid,pu:b.uuid}})}},goHome:function(){$(".go-home").click(function(){window.location.href="main.html"})},goReturn:function(){$(".go-return").click(function(){$(".card-list").removeClass("none");$(".card-details,.card-collect").addClass("none");$(".go-home").removeClass("none");$(".go-return").addClass("none")})}};this.init=function(){c.cardH();wx.ready(function(){b.wxcardList()});wx.error(function(d){});b.moreyh();b.goHome();b.goReturn()};this.init()})});