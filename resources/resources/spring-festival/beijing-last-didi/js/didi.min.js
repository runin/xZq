(function(a){H.dialog={puid:0,$container:a("body"),REQUEST_CLS:"requesting",iscroll:null,init:function(){var b=this;this.$container.delegate(".btn-rule","click",function(c){c.preventDefault();H.dialog.rule.open()}).delegate(".btn-close","click",function(c){c.preventDefault();a(this).closest(".modal").addClass("none")}).delegate(".btn-result","click",function(c){c.preventDefault();H.dialog.result.open()}).delegate(".btn-lottery","click",function(c){c.preventDefault();H.dialog.lottery.open()}).delegate(".btn-comeon","click",function(c){c.preventDefault();H.dialog.guide.open()}).delegate(".btn-download","click",function(c){c.preventDefault();H.dialog.download.open()})},close:function(){a(".modal").addClass("none")},open:function(){H.dialog.close();if(this.$dialog){this.$dialog.removeClass("none")}else{this.$dialog=a(this.tpl());H.dialog.$container.append(this.$dialog)}H.dialog.relocate()},relocate:function(){var b=a(window).height(),c=a(window).width(),d=a(window).scrollTop()+b*0.06;a(".modal").each(function(){a(this).css({width:c,height:b}).find(".btn-close").css({right:c*0.06-15,top:d-15})});a(".dialog").each(function(){if(a(this).hasClass("relocated")){return}a(this).css({width:c*0.88,height:b*0.88,left:c*0.06,right:c*0.06,top:d,bottom:b*0.06});var e=a(this).find(".box");if(e.length>0){e.css("height",b*0.38)}})},guide:{$dialog:null,open:function(){H.dialog.open.call(this);this.event();var b=this;setTimeout(function(){b.close()},8000)},event:function(){var b=this;this.$dialog.find(".btn-try").click(function(c){c.preventDefault();window.localStorage.bjcwGuided=true;b.close()})},close:function(){this.$dialog&&this.$dialog.addClass("none")},tpl:function(){var b=simpleTpl();b._('<section class="modal modal-guide" id="guide-dialog">')._('<div class="dialog guide-dialog relocated">')._("<h2></h2>")._("<p><label>1.</label>打开电视收看北京电视台春晚</p>")._("<p><label>2.</label>打开微信进入“发现”打开“摇一摇”</p>")._("<p><label>3.</label>选择“电视”，对着电视摇一摇</p>")._("<h3>即有丰厚互动大奖等着您！</h3>")._('<a href="#" class="btn btn-try" data-collect="true" data-collect-flag="yg-guide-trybtn" data-collect-desc="引导弹层-关闭按钮">等下就去试试</a>')._("</div>")._("</section>");return b.toString()}},tips:{$dialog:null,open:function(){H.dialog.open.call(this);this.event()},event:function(){var b=this;this.$dialog.find(".btn-now").click(function(c){c.preventDefault();b.close()})},close:function(){this.$dialog&&this.$dialog.addClass("none")},tpl:function(){var b=simpleTpl();b._('<section class="modal modal-tips" id="tips-dialog">')._('<div class="dialog tips-dialog relocated">')._('<div class="content">摇得很辛苦吧，您小歇一会儿，和家人一起聊聊家常，看看北京春晚吧！</div>')._('<a href="#" class="btn btn-now">马上就去</a>')._("</div>")._("</section>");return b.toString()}},confirm:{$dialog:null,open:function(){H.dialog.open.call(this);this.event();a("#share").trigger("click")},event:function(){var b=this;this.$dialog.find(".btn-now").click(function(c){c.preventDefault();window.location.href="index.html"})},close:function(){this.$dialog&&this.$dialog.addClass("none")},tpl:function(){var b=simpleTpl();b._('<section class="modal modal-tips" id="confirm-dialog">')._('<div class="dialog tips-dialog confirm-dialog relocated">')._('<div class="content">您的贺卡已发送成功！</div>')._('<a href="#" class="btn btn-now">确定</a>')._("</div>")._("</section>");return b.toString()}},didi:{$dialog:null,open:function(){H.dialog.open.call(this);this.event()},event:function(){var b=this;this.$dialog.find(".btn-tomobile").click(function(c){c.preventDefault();b.close();a("#mobile").focus()});this.$dialog.find(".btn-tocard").click(function(c){c.preventDefault();b.close();window.location.href="star.html"})},close:function(){this.$dialog&&this.$dialog.addClass("none")},tpl:function(){var b=simpleTpl();b._('<section class="modal modal-tips" id="didi-dialog">')._('<div class="dialog tips-dialog didi-dialog relocated">')._('<div class="content">您的手机号码尚未填写，滴滴红包领取需提供手机号码，否则视为放弃</div>')._('<a href="#" class="btn btn-tomobile">去填手机号码</a>')._('<a href="#" class="btn btn-tocard">去发明星贺卡</a>')._("</div>")._("</section>");return b.toString()}},download:{$dialog:null,open:function(){H.dialog.open.call(this);this.event();a("body").addClass("noscroll")},event:function(){var b=this;this.$dialog.find(".btn-close").click(function(c){c.preventDefault();b.close()})},close:function(){a("body").removeClass("noscroll");this.$dialog.remove();this.$dialog=null},tpl:function(){var b=simpleTpl();b._('<section class="modal modal-download" id="download-dialog">')._('<a href="#" class="btn-close" data-collect="true" data-collect-flag="yg-ruledialog-closebtn" data-collect-desc="下载弹层-关闭按钮"></a>')._('<div class="dialog download-dialog">')._('<iframe src="http://pay.xiaojukeji.com/share/tmp_download.html?t='+(new Date().getTime())+'"></iframe>')._("</div>")._("</section>");return b.toString()}},rule:{$dialog:null,open:function(){H.dialog.open.call(this);this.event();var b=this;a("body").addClass("noscroll");getResult({url:"common/rule",jsonpCallback:"callbackRuleHandler",success:function(c){if(c.code==0&&c.rule){b.update(c.rule)}},error:function(){H.dialog.tips.open()}})},close:function(){a("body").removeClass("noscroll");this.$dialog&&this.$dialog.addClass("none")},event:function(){var b=this;this.$dialog.find(".btn-close").click(function(c){c.preventDefault();b.close()})},update:function(b){this.$dialog.find(".rule").html(b).removeClass("hidden")},tpl:function(){var b=simpleTpl();b._('<section class="modal" id="rule-dialog">')._('<a href="#" class="btn-close" data-collect="true" data-collect-flag="yg-ruledialog-closebtn" data-collect-desc="规则弹层-关闭按钮"></a>')._('<div class="dialog rule-dialog">')._("<h2></h2>")._('<div class="content border">')._('<div class="hidden rule"></div>')._("</div>")._('<p class="dialog-copyright">本活动最终解释权归“北京电视台”所有</p>')._("</div>")._("</section>");return b.toString()}}};W.callbackRuleHandler=function(b){if(b.code==0&&b.rule){H.dialog.rule.update(b.rule)}}})(Zepto);$(function(){H.dialog.init()});(function(){H.didi={$mobile:$("#mobile"),key:shaketv_appid+"_bjws_lottery",lotteryCount:null,init:function(){if(!openid){return}if(!W.localStorage.cardid){window.location.href="star.html";return}this.lotteryCount=$.fn.cookie(this.key);this.lottery();this.$mobile.val($.fn.cookie(shaketv_appid+"_mobile")||"");this.event()},event:function(){var b=this,a=$("#share");$(".btn-card").click(function(c){c.preventDefault();$(window).scrollTop(0);share()});$("#btn-award").click(function(f){f.preventDefault();var d=b.$mobile,c=$.trim(d.val());if(!c){H.dialog.didi.open();return}else{if(!/^\d{11}$/.test(c)){alert("请先输入正确的手机号码");d.focus();return}}b.award(c,d)})},rate:function(){var a=parseInt(Math.random()*100)+1;return parseInt(lottery_rate)>=a},lottery:function(){var b=this,a=$("#award-num");if(!isNaN(parseInt(b.lotteryCount))&&b.lotteryCount<3){if(!b.rate()){b.nowin();return}}else{if(b.lotteryCount>=3){b.nowin();return}}getResult({url:"ceremony/lottery/bjws",data:{oi:openid},jsonpCallback:"callbackLotteryHandler",loading:true,success:function(c){W.localStorage.removeItem("cardid");if(c.result){$("html").addClass("h-didi").find(".hidden").removeClass("hidden");$.fn.cookie(b.key,++b.lotteryCount,expires_in);$("#award-num").text(c.pn||"")}else{b.nowin()}},error:function(){$("html").addClass("h-didi h-didi-none").find(".hidden").removeClass("hidden");H.dialog.tips.open()}})},nowin:function(){$("html").addClass("h-didi h-didi-none").find(".hidden").removeClass("hidden")},award:function(b,a){getResult({url:"ceremony/award",data:{oi:openid,ph:b},jsonpCallback:"callbackAwardHandler",loading:true,bindUI:a,success:function(c){if(c.result!==1){alert(c.message||"领奖失败，请重试");return}$("#didi-award").addClass("awarded");$(".mobile-text").text(b);$.fn.cookie(shaketv_appid+"_mobile",b,expires_in)},error:function(){H.dialog.tips.open()}})}}})(Zepto);$(function(){H.didi.init()});