var yaoBg=[{id:1,imgurl:"./images/yao_bg01.jpg"},{id:2,imgurl:"./images/yao_bg02.jpg"},{id:3,imgurl:"./images/yao_bg03.jpg"},{id:4,imgurl:"./images/yao_bg04.jpg"}];$(function(){var c={showPage:function(d,f,g){var e=$(".page");e.addClass("none");e.each(function(j,k){var h=$(k);if(h.attr("id")==d){h.removeClass("none");c.currentPage=h;if(f){f(h)}return false}})},loadData:function(j){var h=$.extend({url:"",type:"get",async:false,dataType:"jsonp",showload:true},j);if(h.showload){W.showLoading()}var e=0;var g="";var d=null;for(var f in j){e++;if(e==2){g=f;d=j[f];break}}$.ajax({type:h.type,data:j.data,async:h.async,url:h.url,dataType:h.dataType,jsonpCallback:g,success:function(i){W.hideLoading();d(i)},error:function(){if(j.error){j.error()}W.hideLoading()}})},loadImg:function(e){if(!this.images){this.images=[]}if(e&&!(e instanceof Array)){e.isLoad=false;this.images.push(e)}else{if((e instanceof Array)){for(var g=0;g<e.length;g++){e[g].isLoad=false;this.images.push(e[g])}}}for(var f=0;f<this.images.length;f++){var h=this;if(!this.images[f].isLoad){var d=new Image();d.src=this.images[f].src;this.images[f].isLoad=true;d.onload=function(){}}}},showWin:function(f){var e=$.extend({html:"",beforeOpenFn:null,afterOpenFn:null},f||{});this.winObj=$('<div class="win"><div class="win_contain"><div class="win_html"></div></div></div>');this.close=function(g){this.winObj.remove();if(g){g()}if(this.closeFn){this.closeFn()}};this.setWidth=function(g){this.winObj.css("width",g)};this.setHeight=function(g){this.winObj.css("height",g)};this.setHtml=function(g){this.winObj.find(".win_html").append(g||e.html)};var d=this;this.winObj.find(".win_close").unbind("click").click(function(){d.close()});this.init=function(g){this.setHtml();if(e.beforeOpenFn){e.beforeOpenFn(this.winObj)}$("body").append(this.winObj);this.winObj.find(".win_contain").addClass("show_slow");if(e.afterOpenFn){e.afterOpenFn(this.winObj,this)}if(g){g()}}},module:function(f,e,d){!c[f]&&(c[f]=new e());if(d){$(function(){d()})}}};var b={restJk:function(){c.loadData({url:domain_url+"api/lottery/leftLimitPrize",callbackLeftLimitPrizeHandler:function(d){if(d.result==true){$(".rest-redbao i").text(d.lc)}},data:{},showload:false})},restTimeout:function(){var d=this;setInterval(function(){d.restJk()},5000)}};b.restJk();b.restTimeout();var a={adimg:function(){c.loadData({url:domain_url+"api/ad/get",callbackAdGetHandler:function(e){var d=e.ads;if(d&&e.code==0){$(".attention-top").css("backgroundImage","url('"+d[0].p+"')")}},data:{areaNo:"szws-yao-ewm-001"}})}};a.adimg();c.module("main",function(){window.judge=true;window.pu=null;window.js=0;var j={ruleHtml:function(){var k=simpleTpl();k._('<section class="modal" id="rule-dialog">')._('<div class="dialog rule-dialog">')._('<a href="#" class="btn-close" data-collect="true" data-collect-flag="dn-ruledialog-closebtn" data-collect-desc="规则弹层-关闭按钮"></a>')._("<h2></h2>")._('<div class="content border">')._('<div class="rule-con">')._("</div>")._("</div>")._('<p class="dialog-copyright">页面由深圳卫视提供</p>')._("</div>")._("</section>");$("body").append(k.toString())},ruleBtn:function(){$(".rule-btn").click(function(){j.ruleHtml();c.loadData({url:domain_url+"api/common/rule",commonApiRuleHandler:function(k){if(k.code==0){$(".rule-con").html(k.rule)}}})});$("body").delegate(".btn-close","click",function(k){$("#rule-dialog").remove()})}};var g={pointsHtml:function(){var k=this;c.loadData({url:domain_url+"api/lottery/integral/rank/self",callbackIntegralRankSelfRoundHandler:function(n){var m=[];m.push('<section class="contain_rank"><a href="###" class="win_close"></a><section class="pop-points">');m.push('<div class="rank-tips">累积积分前20名可获得益达礼品套装</div>');m.push('<div class="points-head"><i class="head-img"></i> 我的积分:<span class="my_score">0</span>排名 <span class="my_rank"></span></div><div class="points-list">');m.push('<ul class="points-list-ul"></ul></div></section></section>');var l=$(m.join(""));if(n.result){if(n.rk){l.find(".my_rank").text(n.rk)}if(n["in"]){l.find(".my_score").text(n["in"])}if(headimgurl){l.find(".head-img").css({"background-image":"url('"+headimgurl+"/64')"})}}else{}k.win_rank=new c.showWin({html:l[0].outerHTML,beforeOpenFn:function(o){o.addClass("fadein");o.find(".win_contain").addClass("Transparent")},afterOpenFn:function(){c.loadData({url:domain_url+"api/lottery/integral/rank/top10",callbackIntegralRankTop10RoundHandler:function(q){if(q.result){var o=[];for(var p=0;p<q.top10.length;p++){if(q.top10[p].hi){o.push("<li><i style=\"background-image:url('"+q.top10[p].hi+"')\"></i> "+(q.top10[p]["nn"]?q.top10[p]["nn"]:"匿名")+'</li><li class="right"><span>第'+q.top10[p].rk+"名</span></li>")}else{o.push("<li><i></i> "+(q.top10[p]["nn"]?q.top10[p]["nn"]:"匿名")+'</li><li class="right"><span>第'+q.top10[p].rk+"名</span></li>")}}k.win_rank.winObj.find(".points-list ul").append(o.join(""))}else{}},data:{pu:pu}})}});k.win_rank.init()},data:{pu:pu,oi:openid},showload:false})},pointsBtn:function(){$(".points").click(function(){g.pointsHtml();g.pointsClose()})},pointsClose:function(){$("body").delegate(".win_close","click",function(k){$(".win").remove()})}};var i=function(){var k=simpleTpl();k._('<section class="pop-bg">');k._('<div class="pop-prizes">');k._('<a href="###" class="pop-close" id="pop-close"></a>');k._('<div class="pop-con none" id="pop-a">');k._('<div class="prizes-title">恭喜您获得 <span id="points-number"></span></div>');k._('<div class="red-box">');k._('<p class="prizes-img"></p>');k._('<p class="pop-input none">');k._('<input name="" type="text" class="text-a" id="rn" placeholder="姓名" />');k._('<input name="" type="text" class="text-a" id="ph" placeholder="电话" />');k._('<input name="" type="text" class="text-a" id="ad" placeholder="地址" />');k._("<span>请确认所有信息真实有效以确保奖品准确发放</span>");k._("</p>");k._('<a href="###" class="btn-a none" id="jp-btn" data-collect="true" data-collect-flag="szws-kitchen-secret-jp" data-collect-desc="积分">领 取</a>');k._('<a href="###" class="btn-a pcenter none" id="lqhb-btn" data-collect="true" data-collect-flag="szws-kitchen-secret-lqhb" data-collect-desc="红包">领 取</a>');k._("</div>");k._("</div>");k._('<div class="pop-con success-bg none" id="pop-b">');k._('<h2 class="prizes-success">领取成功</h2>');k._('<a href="" class="xzq-tg" data-collect="true" data-collect-flag="szws-kitchen-secret-tg" data-collect-desc="推广"></a> ');k._('<a href="###" class="btn-b">确 定</a>');k._("</div>");k._("</div>");k._("</section>");$("body").append(k.toString())};var h=function(){var k=Math.floor((Math.random()*yaoBg.length));$("body").css("backgroundImage","url('"+yaoBg[k].imgurl+"')")};var e={pdCook:function(){if(getQueryString("rp")==1){i();f.promotion();$("#pop-b").removeClass("none");f.popcolse();judge=false}}};var f={shake:function(){W.addEventListener("shake",f.shake_listener,false)},unshake:function(){W.removeEventListener("shake",f.shake_listener,false)},shake_listener:function(){if(judge==false){return}if(!$(".home-box").hasClass("yao")){$("#audio-a").get(0).play();$(".home-box").addClass("yao");setTimeout(function(){h();$(".home-box").removeClass("yao");f.lottery()},1050)}},lottery:function(){c.loadData({url:domain_url+"api/lottery/luck",callbackLotteryLuckHandler:function(k){if(k.result==true){judge=false;$("#audio-b").get(0).play();i();var l=$(window).height();$(".pop-prizes").css("height",l*0.85);$("#pop-a").removeClass("none");$("#points-number").text(k.pn);$(".prizes-img").css("backgroundImage","url('"+k.pi+"')");if(k.pt==4){$("#lqhb-btn").attr("href",k.rp).removeClass("none")}else{$("#jp-btn").removeClass("none");$(".pop-input").removeClass("none")}if(k.rn){$("#rn").val(k.rn)}if(k.ph){$("#ph").val(k.ph)}if(k.ad){$("#ad").val(k.ad)}f.promotion();f.recerve();f.popcolse()}},data:{oi:openid,sau:pu},showload:false})},promotion:function(){c.loadData({url:domain_url+"api/common/promotion",commonApiPromotionHandler:function(k){if(k.code==0&&k.desc&&k.url){$(".xzq-tg").text(k.desc||"").attr("href",(k.url||""))}else{$(".xzq-tg").remove()}},data:{oi:openid}})},recerve:function(){$("#jp-btn").click(function(p){p.preventDefault();var m=$("#rn");var n=$.trim($("#rn").val());var o=$("#ph");var q=$.trim($("#ph").val());var k=$("#ad");var l=$.trim($("#ad").val());if(!n){alert("请填写姓名！");m.focus();return false}if(!q){alert("请填写手机号码！");o.focus();return false}if(!/^\d{11}$/.test(q)){alert("这手机号，可打不通...！");o.focus();return false}if(l.length<5||l.length>60){alert("地址长度应在5到60个字！");k.focus();return false}c.loadData({url:domain_url+"api/lottery/award",callbackLotteryAwardHandler:function(r){if(r.result==true){$("#pop-a").addClass("none");$("#pop-b").removeClass("none")}else{alert("提交失败！")}},data:{oi:openid,ph:q,rn:n,ad:l}})})},popcolse:function(){$("body").delegate(".btn-b,#pop-close,#follow","click",function(k){k.preventDefault();k.stopPropagation();$(".pop-bg").remove();judge=true})}};this.down_count=function(r){var q=$.extend({itemObj:"",activity:[],cTime:this.systemTime,eachShowFn:null,canLotteryFn:null,endFn:null},r||{});var o=this;var m=500;var n=q.cTime;window.t_count=0;var k=function(p,v){var u=Math.round((p%60000)/m);u=dateNum(Math.min(Math.floor(u/1000*m),59));var s=dateNum(Math.floor((p%3600000)/60000));var t=dateNum(Math.floor((p%86400000)/3600000));var w=dateNum(Math.floor(p/86400000));q.itemObj.text(v.replace(/%S%/,u).replace(/%M%/,s).replace(/%H%/,t).replace(/%D%/,w))};var l=function(){try{n+=m;if(!q.activity[t_count]){if(window.progressTimeInterval){clearInterval(window.progressTimeInterval)}return}var p=parseInt(timestamp(q.activity[t_count].pd+" "+q.activity[t_count].st));var t=parseInt(timestamp(q.activity[t_count].pd+" "+q.activity[t_count].et));var s=isNaN(p)?0:p-n;var u=isNaN(t)?0:t-n;if(s>0){if(q.eachShowFn){q.eachShowFn(q.itemObj.text())}}else{if(u>0){if(q.canLotteryFn){k(u,"%H%:%M%:%S%");q.canLotteryFn(q.activity[t_count])}}else{t_count++;if(t_count>=q.activity.length){if(q.endFn){q.endFn()}if(window.progressTimeInterval){clearInterval(window.progressTimeInterval)}}}}}catch(v){if(window.progressTimeInterval){clearInterval(window.progressTimeInterval)}}};l();window.progressTimeInterval=setInterval(function(){l()},m)};this.LotteryTag=0;this.load_activity=function(){var k=this;k.activity=[];$.ajax({type:"GET",async:true,url:domain_url+"api/lottery/round",dataType:"jsonp",jsonpCallback:"callbackLotteryRoundHandler",success:function(l){if(l.result){k.systemTime=l.sctm;k.activity=l.la;k.down_count({itemObj:$("#dowmtime"),activity:k.activity,eachShowFn:function(){window.location.href="index.html"},canLotteryFn:function(m){k.au=m.ud;k.tid=m.ud;pu=m.ud;k.LotteryTag++},endFn:function(){window.location.href="index.html"}})}else{setTimeout(function(){k.load_activity()},1000);if(l.message){}}},error:function(){setTimeout(function(){k.load_activity()},1000)}})};this.yuyue=function(){c.loadData({url:domain_url+"program/reserve/get",callbackProgramReserveHandler:function(k){if(!k.reserveId){return}else{$(".order").removeClass("none");$(".points").removeClass("mtop");window.reserveId_t=k.reserveId;window.shaketv&&shaketv.preReserve(yao_tv_id,k.reserveId,function(l){if(l.errorCode==0){}})}}})};var d=function(){$(".order").click(function(){var k=window.reserveId_t;if(!k){return}shaketv.reserve(yao_tv_id,k,function(l){})})};this.init=function(){e.pdCook();this.yuyue();h();d();j.ruleBtn();g.pointsBtn();f.shake();this.load_activity()};this.init()})});